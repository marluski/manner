<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Mon Apr  7 17:32:41 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>ZSHCONTRIB</title>

</head>
<body>

<h1 align="center">ZSHCONTRIB</h1>

<a href="#NAME">NAME</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#UTILITIES">UTILITIES</a><br>
<a href="#Accessing On-Line Help">Accessing On-Line Help</a><br>
<a href="#Recompiling Functions">Recompiling Functions</a><br>
<a href="#Keyboard Definition">Keyboard Definition</a><br>
<a href="#Dumping Shell State">Dumping Shell State</a><br>
<a href="#Manipulating Hook Functions">Manipulating Hook Functions</a><br>
<a href="#REMEMBERING RECENT DIRECTORIES">REMEMBERING RECENT DIRECTORIES</a><br>
<a href="#Installation">Installation</a><br>
<a href="#Use">Use</a><br>
<a href="#Options">Options</a><br>
<a href="#Configuration">Configuration</a><br>
<a href="#Use with dynamic directory naming">Use with dynamic directory naming</a><br>
<a href="#Details of directory handling">Details of directory handling</a><br>
<a href="#ABBREVIATED DYNAMIC REFERENCES TO DIRECTORIES">ABBREVIATED DYNAMIC REFERENCES TO DIRECTORIES</a><br>
<a href="#Usage">Usage</a><br>
<a href="#Configuration">Configuration</a><br>
<a href="#Complete example">Complete example</a><br>
<a href="#GATHERING INFORMATION FROM VERSION CONTROL SYSTEMS">GATHERING INFORMATION FROM VERSION CONTROL SYSTEMS</a><br>
<a href="#Quickstart">Quickstart</a><br>
<a href="#Configuration">Configuration</a><br>
<a href="#Oddities">Oddities</a><br>
<a href="#Quilt Support">Quilt Support</a><br>
<a href="#Function Descriptions (Public API)">Function Descriptions (Public API)</a><br>
<a href="#Variable Description">Variable Description</a><br>
<a href="#Hooks in vcs_info">Hooks in vcs_info</a><br>
<a href="#Examples">Examples</a><br>
<a href="#PROMPT THEMES">PROMPT THEMES</a><br>
<a href="#Installation">Installation</a><br>
<a href="#Theme Selection">Theme Selection</a><br>
<a href="#Utility Themes">Utility Themes</a><br>
<a href="#Writing Themes">Writing Themes</a><br>
<a href="#ZLE FUNCTIONS">ZLE FUNCTIONS</a><br>
<a href="#Widgets">Widgets</a><br>
<a href="#Utility Functions">Utility Functions</a><br>
<a href="#Styles">Styles</a><br>
<a href="#EXCEPTION HANDLING">EXCEPTION HANDLING</a><br>
<a href="#MIME FUNCTIONS">MIME FUNCTIONS</a><br>
<a href="#MATHEMATICAL FUNCTIONS">MATHEMATICAL FUNCTIONS</a><br>
<a href="#USER CONFIGURATION FUNCTIONS">USER CONFIGURATION FUNCTIONS</a><br>
<a href="#OTHER FUNCTIONS">OTHER FUNCTIONS</a><br>
<a href="#Descriptions">Descriptions</a><br>
<a href="#Styles">Styles</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">zshcontrib -
user contributions to zsh</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The Zsh source
distribution includes a number of items contributed by the
user community. These are not inherently a part of the
shell, and some may not be available in every zsh
installation. The most significant of these are documented
here. For documentation on other contributed items such as
shell functions, look for comments in the function source
files.</p>

<h2>UTILITIES
<a name="UTILITIES"></a>
</h2>


<h3>Accessing On-Line Help
<a name="Accessing On-Line Help"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The key sequence
<b>ESC h</b> is normally bound by ZLE to execute the
<b>run-help</b> widget (see <i>zshzle</i>(1)). This invokes
the <b>run-help</b> command with the command word from the
current input line as its argument. By default,
<b>run-help</b> is an alias for the <b>man</b> command, so
this often fails when the command word is a shell builtin or
a user-defined function. By redefining the <b>run-help</b>
alias, one can improve the on-line help provided by the
shell.</p>

<p style="margin-left:9%; margin-top: 1em">The
<b>helpfiles</b> utility, found in the <b>Util</b> directory
of the distribution, is a Perl program that can be used to
process the zsh manual to produce a separate help file for
each shell builtin and for many other shell features as
well. The autoloadable <b>run-help</b> function, found in
<b>Functions/Misc</b>, searches for these helpfiles and
performs several other tests to produce the most complete
help possible for the command.</p>

<p style="margin-left:9%; margin-top: 1em">Help files are
installed by default to a subdirectory of
<b>/usr/share/zsh</b> or <b>/usr/local/share/zsh</b>.</p>

<p style="margin-left:9%; margin-top: 1em">To create your
own help files with <b>helpfiles</b>, choose or create a
directory where the individual command help files will
reside. For example, you might choose
<b>&#732;/zsh_help</b>. If you unpacked the zsh distribution
in your home directory, you would use the commands:</p>

<p style="margin-left:18%; margin-top: 1em"><b>mkdir
&#732;/zsh_help <br>
perl &#732;/zsh-5.9/Util/helpfiles &#732;/zsh_help</b></p>

<p style="margin-left:9%; margin-top: 1em">The
<b>HELPDIR</b> parameter tells <b>run-help</b> where to look
for the help files. When unset, it uses the default
installation path. To use your own set of help files, set
this to the appropriate path in one of your startup
files:</p>


<p style="margin-left:18%; margin-top: 1em"><b>HELPDIR=&#732;/zsh_help</b></p>

<p style="margin-left:9%; margin-top: 1em">To use the
<b>run-help</b> function, you need to add lines something
like the following to your <b>.zshrc</b> or equivalent
startup file:</p>

<p style="margin-left:18%; margin-top: 1em"><b>unalias
run-help <br>
autoload run-help</b></p>

<p style="margin-left:9%; margin-top: 1em">Note that in
order for &lsquo;<b>autoload run-help</b>&rsquo; to work,
the <b>run-help</b> file must be in one of the directories
named in your <b>fpath</b> array (see <i>zshparam</i>(1)).
This should already be the case if you have a standard zsh
installation; if it is not, copy
<b>Functions/Misc/run-help</b> to an appropriate
directory.</p>

<h3>Recompiling Functions
<a name="Recompiling Functions"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">If you
frequently edit your zsh functions, or periodically update
your zsh installation to track the latest developments, you
may find that function digests compiled with the
<b>zcompile</b> builtin are frequently out of date with
respect to the function source files. This is not usually a
problem, because zsh always looks for the newest file when
loading a function, but it may cause slower shell startup
and function loading. Also, if a digest file is explicitly
used as an element of <b>fpath</b>, zsh won&rsquo;t check
whether any of its source files has changed.</p>

<p style="margin-left:9%; margin-top: 1em">The
<b>zrecompile</b> autoloadable function, found in
<b>Functions/Misc</b>, can be used to keep function digests
up to date. <b><br>
zrecompile</b> [ <b>-qt</b> ] [ <i>name</i> ... ] <b><br>
zrecompile</b> [ <b>-qt</b> ] <b>-p</b> <i>arg</i> ... [
<b>--</b> <i>arg</i> ... ]</p>

<p style="margin-left:18%;">This tries to find <b>*.zwc</b>
files and automatically re-compile them if at least one of
the original files is newer than the compiled file. This
works only if the names stored in the compiled files are
full paths or are relative to the directory that contains
the <b>.zwc</b> file.</p>

<p style="margin-left:18%; margin-top: 1em">In the first
form, each <i>name</i> is the name of a compiled file or a
directory containing <b>*.zwc</b> files that should be
checked. If no arguments are given, the directories and
<b>*.zwc</b> files in <b>fpath</b> are used.</p>

<p style="margin-left:18%; margin-top: 1em">When <b>-t</b>
is given, no compilation is performed, but a return status
of zero (true) is set if there are files that need to be
re-compiled and non-zero (false) otherwise. The <b>-q</b>
option quiets the chatty output that describes what
<b>zrecompile</b> is doing.</p>

<p style="margin-left:18%; margin-top: 1em">Without the
<b>-t</b> option, the return status is zero if all files
that needed re-compilation could be compiled and non-zero if
compilation for at least one of the files failed.</p>

<p style="margin-left:18%; margin-top: 1em">If the
<b>-p</b> option is given, the <i>arg</i>s are interpreted
as one or more sets of arguments for <b>zcompile</b>,
separated by &lsquo;<b>--</b>&rsquo;. For example:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zrecompile
-p \ <br>
-R &#732;/.zshrc -- \ <br>
-M &#732;/.zcompdump -- \ <br>
&#732;/zsh/comp.zwc &#732;/zsh/Completion/*/_*</b></p>

<p style="margin-left:18%; margin-top: 1em">This compiles
<b>&#732;/.zshrc</b> into <b>&#732;/.zshrc.zwc</b> if that
doesn&rsquo;t exist or if it is older than
<b>&#732;/.zshrc</b>. The compiled file will be marked for
reading instead of mapping. The same is done for
<b>&#732;/.zcompdump</b> and <b>&#732;/.zcompdump.zwc</b>,
but this compiled file is marked for mapping. The last line
re-creates the file <b>&#732;/zsh/comp.zwc</b> if any of the
files matching the given pattern is newer than it.</p>

<p style="margin-left:18%; margin-top: 1em">Without the
<b>-p</b> option, <b>zrecompile</b> does not create function
digests that do not already exist, nor does it add new
functions to the digest.</p>

<p style="margin-left:9%; margin-top: 1em">The following
shell loop is an example of a method for creating function
digests for all functions in your <b>fpath</b>, assuming
that you have write permission to the directories:</p>

<p style="margin-left:18%; margin-top: 1em"><b>for ((i=1; i
&lt;= $#fpath; ++i)); do <br>
dir=$fpath[i] <br>
zwc=${dir:t}.zwc <br>
if [[ $dir == (.|..) || $dir == (.|..)/* ]]; then <br>
continue <br>
fi <br>
files=($dir/*(N-.)) <br>
if [[ -w $dir:h &amp;&amp; -n $files ]]; then <br>
files=(${${(M)files%/*/*}#/}) <br>
if ( cd $dir:h &amp;&amp; <br>
zrecompile -p -U -z $zwc $files ); then <br>
fpath[i]=$fpath[i].zwc <br>
fi <br>
fi <br>
done</b></p>

<p style="margin-left:9%; margin-top: 1em">The <b>-U</b>
and <b>-z</b> options are appropriate for functions in the
default zsh installation <b>fpath</b>; you may need to use
different options for your personal function
directories.</p>

<p style="margin-left:9%; margin-top: 1em">Once the digests
have been created and your <b>fpath</b> modified to refer to
them, you can keep them up to date by running
<b>zrecompile</b> with no arguments.</p>

<h3>Keyboard Definition
<a name="Keyboard Definition"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The large number
of possible combinations of keyboards, workstations,
terminals, emulators, and window systems makes it impossible
for zsh to have built-in key bindings for every situation.
The <b>zkbd</b> utility, found in <b>Functions/Misc</b>, can
help you quickly create key bindings for your
configuration.</p>

<p style="margin-left:9%; margin-top: 1em">Run <b>zkbd</b>
either as an autoloaded function, or as a shell script:</p>

<p style="margin-left:18%; margin-top: 1em"><b>zsh -f
&#732;/zsh-5.9/Functions/Misc/zkbd</b></p>

<p style="margin-left:9%; margin-top: 1em">When you run
<b>zkbd</b>, it first asks you to enter your terminal type;
if the default it offers is correct, just press return. It
then asks you to press a number of different keys to
determine characteristics of your keyboard and terminal;
<b>zkbd</b> warns you if it finds anything out of the
ordinary, such as a Delete key that sends neither
<b>&#710;H</b> nor <b>&#710;?</b>.</p>

<p style="margin-left:9%; margin-top: 1em">The keystrokes
read by <b>zkbd</b> are recorded as a definition for an
associative array named <b>key</b>, written to a file in the
subdirectory <b>.zkbd</b> within either your <b>HOME</b> or
<b>ZDOTDIR</b> directory. The name of the file is composed
from the <b>TERM</b>, <b>VENDOR</b> and <b>OSTYPE</b>
parameters, joined by hyphens.</p>

<p style="margin-left:9%; margin-top: 1em">You may read
this file into your <b>.zshrc</b> or another startup file
with the &lsquo;<b>source</b>&rsquo; or
&lsquo;<b>.</b>&rsquo; commands, then reference the
<b>key</b> parameter in bindkey commands, like this:</p>

<p style="margin-left:18%; margin-top: 1em"><b>source
${ZDOTDIR:-$HOME}/.zkbd/$TERM-$VENDOR-$OSTYPE <br>
[[ -n ${key[Left]} ]] &amp;&amp; bindkey
&quot;${key[Left]}&quot; backward-char <br>
[[ -n ${key[Right]} ]] &amp;&amp; bindkey
&quot;${key[Right]}&quot; forward-char <br>
# etc.</b></p>

<p style="margin-left:9%; margin-top: 1em">Note that in
order for &lsquo;<b>autoload zkbd</b>&rsquo; to work, the
<b>zkdb</b> file must be in one of the directories named in
your <b>fpath</b> array (see <i>zshparam</i>(1)). This
should already be the case if you have a standard zsh
installation; if it is not, copy <b>Functions/Misc/zkbd</b>
to an appropriate directory.</p>

<h3>Dumping Shell State
<a name="Dumping Shell State"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Occasionally you
may encounter what appears to be a bug in the shell,
particularly if you are using a beta version of zsh or a
development release. Usually it is sufficient to send a
description of the problem to one of the zsh mailing lists
(see <i>zsh</i>(1)), but sometimes one of the zsh developers
will need to recreate your environment in order to track the
problem down.</p>

<p style="margin-left:9%; margin-top: 1em">The script named
<b>reporter</b>, found in the <b>Util</b> directory of the
distribution, is provided for this purpose. (It is also
possible to <b>autoload reporter</b>, but <b>reporter</b> is
not installed in <b>fpath</b> by default.) This script
outputs a detailed dump of the shell state, in the form of
another script that can be read with &lsquo;<b>zsh
-f</b>&rsquo; to recreate that state.</p>

<p style="margin-left:9%; margin-top: 1em">To use
<b>reporter</b>, read the script into your shell with the
&lsquo;<b>.</b>&rsquo; command and redirect the output into
a file:</p>

<p style="margin-left:18%; margin-top: 1em"><b>.
&#732;/zsh-5.9/Util/reporter &gt; zsh.report</b></p>

<p style="margin-left:9%; margin-top: 1em">You should check
the <b>zsh.report</b> file for any sensitive information
such as passwords and delete them by hand before sending the
script to the developers. Also, as the output can be
voluminous, it&rsquo;s best to wait for the developers to
ask for this information before sending it.</p>

<p style="margin-left:9%; margin-top: 1em">You can also use
<b>reporter</b> to dump only a subset of the shell state.
This is sometimes useful for creating startup files for the
first time. Most of the output from reporter is far more
detailed than usually is necessary for a startup file, but
the <b>aliases</b>, <b>options</b>, and <b>zstyles</b>
states may be useful because they include only changes from
the defaults. The <b>bindings</b> state may be useful if you
have created any of your own keymaps, because
<b>reporter</b> arranges to dump the keymap creation
commands as well as the bindings for every keymap.</p>

<p style="margin-left:9%; margin-top: 1em">As is usual with
automated tools, if you create a startup file with
<b>reporter</b>, you should edit the results to remove
unnecessary commands. Note that if you&rsquo;re using the
new completion system, you should <i>not</i> dump the
<b>functions</b> state to your startup files with
<b>reporter</b>; use the <b>compdump</b> function instead
(see <i>zshcompsys</i>(1)). <b><br>
reporter</b> [ <i>state</i> ... ]</p>

<p style="margin-left:18%;">Print to standard output the
indicated subset of the current shell state. The
<i>state</i> arguments may be one or more of:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="4%">


<p><b>all</b></p></td>
<td width="5%"></td>
<td width="40%">


<p>Output everything listed below.</p></td>
<td width="33%">
</td></tr>
</table>

<p style="margin-left:18%;"><b>aliases</b></p>

<p style="margin-left:27%;">Output alias definitions.</p>

<p style="margin-left:18%;"><b>bindings</b></p>

<p style="margin-left:27%;">Output ZLE key maps and
bindings.</p>

<p style="margin-left:18%;"><b>completion</b></p>

<p style="margin-left:27%;">Output old-style <b>compctl</b>
commands. New completion is covered by <b>functions</b> and
<b>zstyles</b>.</p>

<p style="margin-left:18%;"><b>functions</b></p>

<p style="margin-left:27%;">Output autoloads and function
definitions.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>limits</b></p></td>
<td width="1%"></td>
<td width="28%">


<p>Output <b>limit</b> commands.</p></td>
<td width="45%">
</td></tr>
</table>

<p style="margin-left:18%;"><b>options</b></p>

<p style="margin-left:27%;">Output <b>setopt</b>
commands.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>styles</b></p></td>
<td width="1%"></td>
<td width="20%">


<p>Same as <b>zstyles</b>.</p></td>
<td width="53%">
</td></tr>
</table>

<p style="margin-left:18%;"><b>variables</b></p>

<p style="margin-left:27%;">Output shell parameter
assignments, plus <b>export</b> commands for any environment
variables.</p>

<p style="margin-left:18%;"><b>zstyles</b></p>

<p style="margin-left:27%;">Output <b>zstyle</b>
commands.</p>

<p style="margin-left:18%; margin-top: 1em">If the
<i>state</i> is omitted, <b>all</b> is assumed.</p>

<p style="margin-left:9%; margin-top: 1em">With the
exception of &lsquo;<b>all</b>&rsquo;, every <i>state</i>
can be abbreviated by any prefix, even a single letter; thus
<b>a</b> is the same as <b>aliases</b>, <b>z</b> is the same
as <b>zstyles</b>, etc.</p>

<h3>Manipulating Hook Functions
<a name="Manipulating Hook Functions"></a>
</h3>



<p style="margin-left:9%; margin-top: 1em"><b>add-zsh-hook</b>
[ <b>-L</b> | <b>-dD</b> ] [ <b>-Uzk</b> ] <i>hook
function</i></p>

<p style="margin-left:18%;">Several functions are special
to the shell, as described in the section SPECIAL FUNCTIONS,
see <i>zshmisc</i>(1), in that they are automatically called
at specific points during shell execution. Each has an
associated array consisting of names of functions to be
called at the same point; these are so-called &lsquo;hook
functions&rsquo;. The shell function <b>add-zsh-hook</b>
provides a simple way of adding or removing functions from
the array.</p>

<p style="margin-left:18%; margin-top: 1em"><i>hook</i> is
one of <b>chpwd</b>, <b>periodic</b>, <b>precmd</b>,
<b>preexec</b>, <b>zshaddhistory</b>, <b>zshexit</b>, or
<b>zsh_directory_name</b>, the special functions in
question. Note that <b>zsh_directory_name</b> is called in a
different way from the other functions, but may still be
manipulated as a hook.</p>


<p style="margin-left:18%; margin-top: 1em"><i>function</i>
is name of an ordinary shell function. If no options are
given this will be added to the array of functions to be
executed in the given context. Functions are invoked in the
order they were added.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
<b>-L</b> is given, the current values for the hook arrays
are listed with <b>typeset</b>.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
<b>-d</b> is given, the <i>function</i> is removed from the
array of functions to be executed.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
<b>-D</b> is given, the <i>function</i> is treated as a
pattern and any matching names of functions are removed from
the array of functions to be executed.</p>

<p style="margin-left:18%; margin-top: 1em">The options
<b>-U</b>, <b>-z</b> and <b>-k</b> are passed as arguments
to <b>autoload</b> for <i>function</i>. For functions
contributed with zsh, the options <b>-Uz</b> are
appropriate.</p>

<p style="margin-left:9%;"><b>add-zle-hook-widget</b> [
<b>-L</b> | <b>-dD</b> ] [ <b>-Uzk</b> ] <i>hook
widgetname</i></p>

<p style="margin-left:18%;">Several widget names are
special to the line editor, as described in the section
Special Widgets, see <i>zshzle</i>(1), in that they are
automatically called at specific points during editing.
Unlike function hooks, these do not use a predefined array
of other names to call at the same point; the shell function
<b>add-zle-hook-widget</b> maintains a similar array and
arranges for the special widget to invoke those additional
widgets.</p>

<p style="margin-left:18%; margin-top: 1em"><i>hook</i> is
one of <b>isearch-exit</b>, <b>isearch-update</b>,
<b>line-pre-redraw</b>, <b>line-init</b>,
<b>line-finish</b>, <b>history-line-set</b>, or
<b>keymap-select</b>, corresponding to each of the special
widgets <b>zle-isearch-exit</b>, etc. The special widget
names are also accepted as the <i>hook</i> argument.</p>


<p style="margin-left:18%; margin-top: 1em"><i>widgetname</i>
is the name of a ZLE widget. If no options are given this is
added to the array of widgets to be invoked in the given
hook context. Widgets are invoked in the order they were
added, with</p>

<p style="margin-left:27%;"><b>zle</b> <i>widgetname</i>
<b>-Nw -f &quot;nolast&quot; -- &quot;$@&quot;</b></p>

<p style="margin-left:18%; margin-top: 1em">Note that this
means that the &lsquo;<b>WIDGET</b>&rsquo; special parameter
tracks the <i>widgetname</i> when the widget function is
called, rather than tracking the name of the corresponding
special hook widget.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
<b>-d</b> is given, the <i>widgetname</i> is removed from
the array of widgets to be executed.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
<b>-D</b> is given, the <i>widgetname</i> is treated as a
pattern and any matching names of widgets are removed from
the array.</p>

<p style="margin-left:18%; margin-top: 1em">If
<i>widgetname</i> does not name an existing widget when
added to the array, it is assumed that a shell function also
named <i>widgetname</i> is meant to provide the
implementation of the widget. This name is therefore marked
for autoloading, and the options <b>-U</b>, <b>-z</b> and
<b>-k</b> are passed as arguments to <b>autoload</b> as with
<b>add-zsh-hook</b>. The widget is also created with
&lsquo;<b>zle -N</b> <i>widgetname</i>&rsquo; to cause the
corresponding function to be loaded the first time the hook
is called.</p>

<p style="margin-left:18%; margin-top: 1em">The arrays of
<i>widgetname</i> are currently maintained in <b>zstyle</b>
contexts, one for each <i>hook</i> context, with a style of
&lsquo;<b>widgets</b>&rsquo;. If the <b>-L</b> option is
given, this set of styles is listed with &lsquo;<b>zstyle
-L</b>&rsquo;. This implementation may change, and the
special widgets that refer to the styles are created only if
<b>add-zle-hook-widget</b> is called to add at least one
widget, so if this function is used for any hooks, then all
hooks should be managed only via this function.</p>

<h2>REMEMBERING RECENT DIRECTORIES
<a name="REMEMBERING RECENT DIRECTORIES"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The function
<b>cdr</b> allows you to change the working directory to a
previous working directory from a list maintained
automatically. It is similar in concept to the directory
stack controlled by the <b>pushd</b>, <b>popd</b> and
<b>dirs</b> builtins, but is more configurable, and as it
stores all entries in files it is maintained across sessions
and (by default) between terminal emulators in the current
session. Duplicates are automatically removed, so that the
list reflects the single most recent use of each
directory.</p>

<p style="margin-left:9%; margin-top: 1em">Note that the
<b>pushd</b> directory stack is not actually modified or
used by <b>cdr</b> unless you configure it to do so as
described in the configuration section below.</p>

<h3>Installation
<a name="Installation"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The system works
by means of a hook function that is called every time the
directory changes. To install the system, autoload the
required functions and use the <b>add-zsh-hook</b> function
described above:</p>

<p style="margin-left:18%; margin-top: 1em"><b>autoload -Uz
chpwd_recent_dirs cdr add-zsh-hook <br>
add-zsh-hook chpwd chpwd_recent_dirs</b></p>

<p style="margin-left:9%; margin-top: 1em">Now every time
you change directly interactively, no matter which command
you use, the directory to which you change will be
remembered in most-recent-first order.</p>

<h3>Use
<a name="Use"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">All direct user
interaction is via the <b>cdr</b> function.</p>

<p style="margin-left:9%; margin-top: 1em">The argument to
cdr is a number <i>N</i> corresponding to the <i>N</i>th
most recently changed-to directory. 1 is the immediately
preceding directory; the current directory is remembered but
is not offered as a destination. Note that if you have
multiple windows open 1 may refer to a directory changed to
in another window; you can avoid this by having per-terminal
files for storing directory as described for the
<b>recent-dirs-file</b> style below.</p>

<p style="margin-left:9%; margin-top: 1em">If you set the
<b>recent-dirs-default</b> style described below <b>cdr</b>
will behave the same as <b>cd</b> if given a non-numeric
argument, or more than one argument. The recent directory
list is updated just the same however you change
directory.</p>

<p style="margin-left:9%; margin-top: 1em">If the argument
is omitted, 1 is assumed. This is similar to
<b>pushd</b>&rsquo;s behaviour of swapping the two most
recent directories on the stack.</p>

<p style="margin-left:9%; margin-top: 1em">Completion for
the argument to <b>cdr</b> is available if compinit has been
run; menu selection is recommended, using:</p>

<p style="margin-left:18%; margin-top: 1em"><b>zstyle
&rsquo;:completion:*:*:cdr:*:*&rsquo; menu selection</b></p>

<p style="margin-left:9%; margin-top: 1em">to allow you to
cycle through recent directories; the order is preserved, so
the first choice is the most recent directory before the
current one. The verbose style is also recommended to ensure
the directory is shown; this style is on by default so no
action is required unless you have changed it.</p>

<h3>Options
<a name="Options"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The behaviour of
<b>cdr</b> may be modified by the following options.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>-l</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>lists the numbers and the corresponding directories in
abbreviated form (i.e. with <b>&#732;</b> substitution
reapplied), one per line. The directories here are not
quoted (this would only be an issue if a directory name
contained a newline). This is used by the completion
system.</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>-r</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>sets the variable <b>reply</b> to the current set of
directories. Nothing is printed and the directory is not
changed.</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>-e</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>allows you to edit the list of directories, one per
line. The list can be edited to any extent you like; no
sanity checking is performed. Completion is available. No
quoting is necessary (except for newlines, where I have in
any case no sympathy); directories are in unabbreviated form
and contain an absolute path, i.e. they start with <b>/</b>.
Usually the first entry should be left as the current
directory.</p> </td></tr>
</table>

<p style="margin-left:9%;"><b>-p
&rsquo;</b><i>pattern</i><b>&rsquo;</b></p>

<p style="margin-left:18%;">Prunes any items in the
directory list that match the given extended glob pattern;
the pattern needs to be quoted from immediate expansion on
the command line. The pattern is matched against each
completely expanded file name in the list; the full string
must match, so wildcards at the end (e.g.
<b>&rsquo;*removeme*&rsquo;</b>) are needed to remove
entries with a given substring.</p>

<p style="margin-left:18%; margin-top: 1em">If output is to
a terminal, then the function will print the new list after
pruning and prompt for confirmation by the user. This output
and confirmation step can be skipped by using <b>-P</b>
instead of <b>-p</b>.</p>

<h3>Configuration
<a name="Configuration"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Configuration is
by means of the styles mechanism that should be familiar
from completion; if not, see the description of the
<b>zstyle</b> command in see <i>zshmodules</i>(1). The
context for setting styles should be
<b>&rsquo;:chpwd:*&rsquo;</b> in case the meaning of the
context is extended in future, for example:</p>

<p style="margin-left:18%; margin-top: 1em"><b>zstyle
&rsquo;:chpwd:*&rsquo; recent-dirs-max 0</b></p>

<p style="margin-left:9%; margin-top: 1em">sets the value
of the <b>recent-dirs-max</b> style to 0. In practice the
style name is specific enough that a context of
&rsquo;*&rsquo; should be fine.</p>

<p style="margin-left:9%; margin-top: 1em">An exception is
<b>recent-dirs-insert</b>, which is used exclusively by the
completion system and so has the usual completion system
context (<b>&rsquo;:completion:*&rsquo;</b> if nothing more
specific is needed), though again <b>&rsquo;*&rsquo;</b>
should be fine in practice. <b><br>
recent-dirs-default</b></p>

<p style="margin-left:18%;">If true, and the command is
expecting a recent directory index, and either there is more
than one argument or the argument is not an integer, then
fall through to &quot;cd&quot;. This allows the lazy to use
only one command for directory changing. Completion
recognises this, too; see recent-dirs-insert for how to
control completion when this option is in use.</p>

<p style="margin-left:9%;"><b>recent-dirs-file</b></p>

<p style="margin-left:18%;">The file where the list of
directories is saved. The default is
<b>${ZDOTDIR:-$HOME}/.chpwd-recent-dirs</b>, i.e. this is in
your home directory unless you have set the variable
<b>ZDOTDIR</b> to point somewhere else. Directory names are
saved in <b>$&rsquo;</b><i>...</i><b>&rsquo;</b> quoted
form, so each line in the file can be supplied directly to
the shell as an argument.</p>

<p style="margin-left:18%; margin-top: 1em">The value of
this style may be an array. In this case, the first file in
the list will always be used for saving directories while
any other files are left untouched. When reading the recent
directory list, if there are fewer than the maximum number
of entries in the first file, the contents of later files in
the array will be appended with duplicates removed from the
list shown. The contents of the two files are not sorted
together, i.e. all the entries in the first file are shown
first. The special value <b>+</b> can appear in the list to
indicate the default file should be read at that point. This
allows effects like the following:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
&rsquo;:chpwd:*&rsquo; recent-dirs-file \ <br>
&#732;/.chpwd-recent-dirs-${TTY##*/} +</b></p>

<p style="margin-left:18%; margin-top: 1em">Recent
directories are read from a file numbered according to the
terminal. If there are insufficient entries the list is
supplemented from the default file.</p>

<p style="margin-left:18%; margin-top: 1em">It is possible
to use <b>zstyle -e</b> to make the directory configurable
at run time:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle -e
&rsquo;:chpwd:*&rsquo; recent-dirs-file
pick-recent-dirs-file <br>
pick-recent-dirs-file() { <br>
if [[ $PWD = &#732;/text/writing(|/*) ]]; then <br>
reply=(&#732;/.chpwd-recent-dirs-writing) <br>
else <br>
reply=(+) <br>
fi <br>
}</b></p>

<p style="margin-left:18%; margin-top: 1em">In this
example, if the current directory is
<b>&#732;/text/writing</b> or a directory under it, then use
a special file for saving recent directories, else use the
default.</p>

<p style="margin-left:9%;"><b>recent-dirs-insert</b></p>

<p style="margin-left:18%;">Used by completion. If
<b>recent-dirs-default</b> is true, then setting this to
<b>true</b> causes the actual directory, rather than its
index, to be inserted on the command line; this has the same
effect as using the corresponding index, but makes the
history clearer and the line easier to edit. With this
setting, if part of an argument was already typed, normal
directory completion rather than recent directory completion
is done; this is because recent directory completion is
expected to be done by cycling through entries menu
fashion.</p>

<p style="margin-left:18%; margin-top: 1em">If the value of
the style is <b>always</b>, then only recent directories
will be completed; in that case, use the <b>cd</b> command
when you want to complete other directories.</p>

<p style="margin-left:18%; margin-top: 1em">If the value is
<b>fallback</b>, recent directories will be tried first,
then normal directory completion is performed if recent
directory completion failed to find a match.</p>

<p style="margin-left:18%; margin-top: 1em">Finally, if the
value is <b>both</b> then both sets of completions are
presented; the usual tag mechanism can be used to
distinguish results, with recent directories tagged as
<b>recent-dirs</b>. Note that the recent directories
inserted are abbreviated with directory names where
appropriate.</p>

<p style="margin-left:9%;"><b>recent-dirs-max</b></p>

<p style="margin-left:18%;">The maximum number of
directories to save to the file. If this is zero or negative
there is no maximum. The default is 20. Note this includes
the current directory, which isn&rsquo;t offered, so the
highest number of directories you will be offered is one
less than the maximum.</p>

<p style="margin-left:9%;"><b>recent-dirs-prune</b></p>

<p style="margin-left:18%;">This style is an array
determining what directories should (or should not) be added
to the recent list. Elements of the array can include:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>parent</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>Prune parents (more accurately, ancestors) from the
recent list. If present, changing directly down by any
number of directories causes the current directory to be
overwritten. For example, changing from &#732;pws to
&#732;pws/some/other/dir causes &#732;pws not to be left on
the recent directory stack. This only applies to direct
changes to descendant directories; earlier directories on
the list are not pruned. For example, changing from
&#732;pws/yet/another to &#732;pws/some/other/dir does not
cause &#732;pws to be pruned.</p></td></tr>
</table>


<p style="margin-left:18%;"><b>pattern:</b><i>pattern</i></p>

<p style="margin-left:27%;">Gives a zsh pattern for
directories that should not be added to the recent list (if
not already there). This element can be repeated to add
different patterns. For example,
<b>&rsquo;pattern:/tmp(|/*)&rsquo;</b> stops <b>/tmp</b> or
its descendants from being added. The <b>EXTENDED_GLOB</b>
option is always turned on for these patterns.</p>

<p style="margin-left:9%;"><b>recent-dirs-pushd</b></p>

<p style="margin-left:18%;">If set to true, <b>cdr</b> will
use <b>pushd</b> instead of <b>cd</b> to change the
directory, so the directory is saved on the directory stack.
As the directory stack is completely separate from the list
of files saved by the mechanism used in this file there is
no obvious reason to do this.</p>

<h3>Use with dynamic directory naming
<a name="Use with dynamic directory naming"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">It is possible
to refer to recent directories using the dynamic directory
name syntax by using the supplied function
<b>zsh_directory_name_cdr</b> a hook:</p>

<p style="margin-left:18%; margin-top: 1em"><b>autoload -Uz
add-zsh-hook <br>
add-zsh-hook -Uz zsh_directory_name
zsh_directory_name_cdr</b></p>

<p style="margin-left:9%; margin-top: 1em">When this is
done, <b>&#732;[1]</b> will refer to the most recent
directory other than $PWD, and so on. Completion after
<b>&#732;[</b><i>...</i> also works.</p>

<h3>Details of directory handling
<a name="Details of directory handling"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">This section is
for the curious or confused; most users will not need to
know this information.</p>

<p style="margin-left:9%; margin-top: 1em">Recent
directories are saved to a file immediately and hence are
preserved across sessions. Note currently no file locking is
applied: the list is updated immediately on interactive
commands and nowhere else (unlike history), and it is
assumed you are only going to change directory in one window
at once. This is not safe on shared accounts, but in any
case the system has limited utility when someone else is
changing to a different set of directories behind your
back.</p>

<p style="margin-left:9%; margin-top: 1em">To make this a
little safer, only directory changes instituted from the
command line, either directly or indirectly through shell
function calls (but not through subshells, evals, traps,
completion functions and the like) are saved. Shell
functions should use <b>cd -q</b> or <b>pushd -q</b> to
avoid side effects if the change to the directory is to be
invisible at the command line. See the contents of the
function <b>chpwd_recent_dirs</b> for more details.</p>

<h2>ABBREVIATED DYNAMIC REFERENCES TO DIRECTORIES
<a name="ABBREVIATED DYNAMIC REFERENCES TO DIRECTORIES"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The dynamic
directory naming system is described in the subsection
<i>Dynamic named directories</i> of the section <i>Filename
Expansion</i> in <i>zshexpn</i>(1). In this, a reference to
<b>&#732;[</b><i>...</i><b>]</b> is expanded by a function
found by the hooks mechanism.</p>

<p style="margin-left:9%; margin-top: 1em">The contributed
function <b>zsh_directory_name_generic</b> provides a system
allowing the user to refer to directories with only a
limited amount of new code. It supports all three of the
standard interfaces for directory naming: converting from a
name to a directory, converting in the reverse direction to
find a short name, and completion of names.</p>

<p style="margin-left:9%; margin-top: 1em">The main feature
of this function is a path-like syntax, combining
abbreviations at multiple levels separated by &quot;:&quot;.
As an example, &#732;[g:p:s] might specify:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="1%">


<p><b>g</b></p></td>
<td width="8%"></td>
<td width="82%">


<p>The top level directory for your git area. This first
component has to match, or the function will return
indicating another directory name hook function should be
tried.</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="1%">


<p><b>p</b></p></td>
<td width="8%"></td>
<td width="82%">


<p>The name of a project within your git area.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="1%">


<p><b>s</b></p></td>
<td width="8%"></td>
<td width="82%">


<p>The source area within that project. This allows you to
collapse references to long hierarchies to a very compact
form, particularly if the hierarchies are similar across
different areas of the disk.</p></td></tr>
</table>

<p style="margin-left:9%; margin-top: 1em">Name components
may be completed: if a description is shown at the top of
the list of completions, it includes the path to which
previous components expand, while the description for an
individual completion shows the path segment it would add.
No additional configuration is needed for this as the
completion system is aware of the dynamic directory name
mechanism.</p>

<h3>Usage
<a name="Usage"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">To use the
function, first define a wrapper function for your specific
case. We&rsquo;ll assume it&rsquo;s to be autoloaded. This
can have any name but we&rsquo;ll refer to it as
zdn_mywrapper. This wrapper function will define various
variables and then call this function with the same
arguments that the wrapper function gets. This configuration
is described below.</p>

<p style="margin-left:9%; margin-top: 1em">Then arrange for
the wrapper to be run as a zsh_directory_name hook:</p>

<p style="margin-left:18%; margin-top: 1em"><b>autoload -Uz
add-zsh-hook zsh_directory_name_generic zdn_mywrapper <br>
add-zsh-hook -U zsh_directory_name zdn_mywrapper</b></p>

<h3>Configuration
<a name="Configuration"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The wrapper
function should define a local associative array zdn_top.
Alternatively, this can be set with a style called
<b>mapping</b>. The context for the style is
<b>:zdn:</b><i>wrapper-name</i> where <i>wrapper-name</i> is
the function calling zsh_directory_name_generic; for
example:</p>

<p style="margin-left:18%; margin-top: 1em"><b>zstyle
:zdn:zdn_mywrapper: mapping zdn_mywrapper_top</b></p>

<p style="margin-left:9%; margin-top: 1em">The keys in this
associative array correspond to the first component of the
name. The values are matching directories. They may have an
optional suffix with a slash followed by a colon and the
name of a variable in the same format to give the next
component. (The slash before the colon is to disambiguate
the case where a colon is needed in the path for a drive.
There is otherwise no syntax for escaping this, so path
components whose names start with a colon are not
supported.) A special component <b>:default:</b> specifies a
variable in the form <b>/:</b><i>var</i> (the path section
is ignored and so is usually empty) that will be used for
the next component if no variable is given for the path.
Variables referred to within <b>zdn_top</b> have the same
format as <b>zdn_top</b> itself, but contain relative
paths.</p>

<p style="margin-left:9%; margin-top: 1em">For example,</p>

<p style="margin-left:18%; margin-top: 1em"><b>local -A
zdn_top=( <br>
g &#732;/git <br>
ga &#732;/alternate/git <br>
gs /scratch/$USER/git/:second2 <br>
:default: /:second1 <br>
)</b></p>

<p style="margin-left:9%; margin-top: 1em">This specifies
the behaviour of a directory referred to as
<b>&#732;[g:...]</b> or <b>&#732;[ga:...]</b> or
<b>&#732;[gs:...]</b>. Later path components are optional;
in that case <b>&#732;[g]</b> expands to <b>&#732;/git</b>,
and so on. <b>gs</b> expands to <b>/scratch/$USER/git</b>
and uses the associative array <b>second2</b> to match the
second component; <b>g</b> and <b>ga</b> use the associative
array <b>second1</b> to match the second component.</p>

<p style="margin-left:9%; margin-top: 1em">When expanding a
name to a directory, if the first component is not <b>g</b>
or <b>ga</b> or <b>gs</b>, it is not an error; the function
simply returns 1 so that a later hook function can be tried.
However, matching the first component commits the function,
so if a later component does not match, an error is printed
(though this still does not stop later hooks from being
executed).</p>

<p style="margin-left:9%; margin-top: 1em">For components
after the first, a relative path is expected, but note that
multiple levels may still appear. Here is an example of
<b>second1</b>:</p>

<p style="margin-left:18%; margin-top: 1em"><b>local -A
second1=( <br>
p myproject <br>
s somproject <br>
os otherproject/subproject/:third <br>
)</b></p>

<p style="margin-left:9%; margin-top: 1em">The path as
found from <b>zdn_top</b> is extended with the matching
directory, so <b>&#732;[g:p]</b> becomes
<b>&#732;/git/myproject</b>. The slash between is added
automatically (it&rsquo;s not possible to have a later
component modify the name of a directory already matched).
Only <b>os</b> specifies a variable for a third component,
and there&rsquo;s no <b>:default:</b>, so it&rsquo;s an
error to use a name like <b>&#732;[g:p:x]</b> or
<b>&#732;[ga:s:y]</b> because there&rsquo;s nowhere to look
up the <b>x</b> or <b>y</b>.</p>

<p style="margin-left:9%; margin-top: 1em">The associative
arrays need to be visible within this function; the generic
function therefore uses internal variable names beginning
<b>_zdn_</b> in order to avoid clashes. Note that the
variable <b>reply</b> needs to be passed back to the shell,
so should not be local in the calling function.</p>

<p style="margin-left:9%; margin-top: 1em">The function
does not test whether directories assembled by component
actually exist; this allows the system to work across
automounted file systems. The error from the command trying
to use a non-existent directory should be sufficient to
indicate the problem.</p>

<h3>Complete example
<a name="Complete example"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Here is a full
fictitious but usable autoloadable definition of the example
function defined by the code above. So <b>&#732;[gs:p:s]</b>
expands to
<b>/scratch/$USER/git/myscratchproject/top/srcdir</b> (with
<b>$USER</b> also expanded).</p>

<p style="margin-left:18%; margin-top: 1em"><b>local -A
zdn_top=( <br>
g &#732;/git <br>
ga &#732;/alternate/git <br>
gs /scratch/$USER/git/:second2 <br>
:default: /:second1 <br>
)</b></p>

<p style="margin-left:18%; margin-top: 1em"><b>local -A
second1=( <br>
p myproject <br>
s somproject <br>
os otherproject/subproject/:third <br>
)</b></p>

<p style="margin-left:18%; margin-top: 1em"><b>local -A
second2=( <br>
p myscratchproject <br>
s somescratchproject <br>
)</b></p>

<p style="margin-left:18%; margin-top: 1em"><b>local -A
third=( <br>
s top/srcdir <br>
d top/documentation <br>
)</b></p>

<p style="margin-left:18%; margin-top: 1em"><b># autoload
not needed if you did this at initialisation... <br>
autoload -Uz zsh_directory_name_generic <br>
zsh_directory_name_generic &quot;$@</b></p>

<p style="margin-left:9%; margin-top: 1em">It is also
possible to use global associative arrays, suitably named,
and set the style for the context of your wrapper function
to refer to this. Then your set up code would contain the
following:</p>

<p style="margin-left:18%; margin-top: 1em"><b>typeset -A
zdn_mywrapper_top=(...) <br>
# ... and so on for other associative arrays ... <br>
zstyle &rsquo;:zdn:zdn_mywrapper:&rsquo; mapping
zdn_mywrapper_top <br>
autoload -Uz add-zsh-hook zsh_directory_name_generic
zdn_mywrapper <br>
add-zsh-hook -U zsh_directory_name zdn_mywrapper</b></p>

<p style="margin-left:9%; margin-top: 1em">and the function
<b>zdn_mywrapper</b> would contain only the following:</p>


<p style="margin-left:18%; margin-top: 1em"><b>zsh_directory_name_generic
&quot;$@&quot;</b></p>

<h2>GATHERING INFORMATION FROM VERSION CONTROL SYSTEMS
<a name="GATHERING INFORMATION FROM VERSION CONTROL SYSTEMS"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">In a lot of
cases, it is nice to automatically retrieve information from
version control systems (VCSs), such as subversion, CVS or
git, to be able to provide it to the user; possibly in the
user&rsquo;s prompt. So that you can instantly tell which
branch you are currently on, for example.</p>

<p style="margin-left:9%; margin-top: 1em">In order to do
that, you may use the <b>vcs_info</b> function.</p>

<p style="margin-left:9%; margin-top: 1em">The following
VCSs are supported, showing the abbreviated name by which
they are referred to within the system: <br>
Bazaar (<b>bzr</b>)</p>


<p style="margin-left:18%;"><b>https://bazaar.canonical.com/</b></p>

<p style="margin-left:9%;">Codeville (<b>cdv</b>)</p>


<p style="margin-left:18%;"><b>http://freecode.com/projects/codeville/</b></p>

<p style="margin-left:9%;">Concurrent Versioning System
(<b>cvs</b>)</p>


<p style="margin-left:18%;"><b>https://www.nongnu.org/cvs/</b></p>

<p style="margin-left:9%;">Darcs (<b>darcs</b>)</p>

<p style="margin-left:18%;"><b>http://darcs.net/</b></p>

<p style="margin-left:9%;">Fossil (<b>fossil</b>)</p>


<p style="margin-left:18%;"><b>https://fossil-scm.org/</b></p>

<p style="margin-left:9%;">Git (<b>git</b>)</p>


<p style="margin-left:18%;"><b>https://git-scm.com/</b></p>

<p style="margin-left:9%;">GNU arch (<b>tla</b>)</p>


<p style="margin-left:18%;"><b>https://www.gnu.org/software/gnu-arch/</b></p>

<p style="margin-left:9%;">Mercurial (<b>hg</b>)</p>


<p style="margin-left:18%;"><b>https://www.mercurial-scm.org/</b></p>

<p style="margin-left:9%;">Monotone (<b>mtn</b>)</p>


<p style="margin-left:18%;"><b>https://monotone.ca/</b></p>

<p style="margin-left:9%;">Perforce (<b>p4</b>)</p>


<p style="margin-left:18%;"><b>https://www.perforce.com/</b></p>

<p style="margin-left:9%;">Subversion (<b>svn</b>)</p>


<p style="margin-left:18%;"><b>https://subversion.apache.org/</b></p>

<p style="margin-left:9%;">SVK (<b>svk</b>)</p>


<p style="margin-left:18%;"><b>https://svk.bestpractical.com/</b></p>

<p style="margin-left:9%; margin-top: 1em">There is also
support for the patch management system <b>quilt</b>
(<b>https://savannah.nongnu.org/projects/quilt</b>). See
<b>Quilt Support</b> below for details.</p>

<p style="margin-left:9%; margin-top: 1em">To load
<b>vcs_info</b>:</p>

<p style="margin-left:18%; margin-top: 1em"><b>autoload -Uz
vcs_info</b></p>

<p style="margin-left:9%; margin-top: 1em">It can be used
in any existing prompt, because it does not require any
specific <b>$psvar</b> entries to be available.</p>

<h3>Quickstart
<a name="Quickstart"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">To get this
feature working quickly (including colors), you can do the
following (assuming, you loaded <b>vcs_info</b> properly -
see above):</p>

<p style="margin-left:18%; margin-top: 1em"><b>zstyle
&rsquo;:vcs_info:*&rsquo; actionformats \ <br>

&rsquo;%F{5}(%f%s%F{5})%F{3}-%F{5}[%F{2}%b%F{3}|%F{1}%a%F{5}]%f
&rsquo; <br>
zstyle &rsquo;:vcs_info:*&rsquo; formats \ <br>
&rsquo;%F{5}(%f%s%F{5})%F{3}-%F{5}[%F{2}%b%F{5}]%f &rsquo;
<br>
zstyle &rsquo;:vcs_info:(sv[nk]|bzr):*&rsquo; branchformat
&rsquo;%b%F{1}:%F{3}%r&rsquo; <br>
precmd () { vcs_info } <br>
PS1=&rsquo;%F{5}[%F{2}%n%F{5}] %F{3}%3&#732;
${vcs_info_msg_0_}%f%# &rsquo;</b></p>

<p style="margin-left:9%; margin-top: 1em">Obviously, the
last two lines are there for demonstration. You need to call
<b>vcs_info</b> from your <b>precmd</b> function. Once that
is done you need a <i>single quoted</i>
<b>&rsquo;${vcs_info_msg_0_}&rsquo;</b> in your prompt.</p>

<p style="margin-left:9%; margin-top: 1em">To be able to
use <b>&rsquo;${vcs_info_msg_0_}&rsquo;</b> directly in your
prompt like this, you will need to have the
<b>PROMPT_SUBST</b> option enabled.</p>

<p style="margin-left:9%; margin-top: 1em">Now call the
<b>vcs_info_printsys</b> utility from the command line:</p>

<p style="margin-left:18%; margin-top: 1em"><b>%
vcs_info_printsys <br>
## list of supported version control backends: <br>
## disabled systems are prefixed by a hash sign (#) <br>
bzr <br>
cdv <br>
cvs <br>
darcs <br>
fossil <br>
git <br>
hg <br>
mtn <br>
p4 <br>
svk <br>
svn <br>
tla <br>
## flavours (cannot be used in the enable or disable styles;
they <br>
## are enabled and disabled with their master [git-svn -&gt;
git]) <br>
## they *can* be used in contexts:
&rsquo;:vcs_info:git-svn:*&rsquo;. <br>
git-p4 <br>
git-svn <br>
hg-git <br>
hg-hgsubversion <br>
hg-hgsvn</b></p>

<p style="margin-left:9%; margin-top: 1em">You may not want
all of these because there is no point in running the code
to detect systems you do not use. So there is a way to
disable some backends altogether:</p>

<p style="margin-left:18%; margin-top: 1em"><b>zstyle
&rsquo;:vcs_info:*&rsquo; disable bzr cdv darcs mtn svk
tla</b></p>

<p style="margin-left:9%; margin-top: 1em">You may also
pick a few from that list and enable only those:</p>

<p style="margin-left:18%; margin-top: 1em"><b>zstyle
&rsquo;:vcs_info:*&rsquo; enable git cvs svn</b></p>

<p style="margin-left:9%; margin-top: 1em">If you rerun
<b>vcs_info_printsys</b> after one of these commands, you
will see the backends listed in the <b>disable</b> style (or
backends not in the <b>enable</b> style - if you used that)
marked as disabled by a hash sign. That means the detection
of these systems is skipped <i>completely</i>. No wasted
time there.</p>

<h3>Configuration
<a name="Configuration"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The
<b>vcs_info</b> feature can be configured via
<b>zstyle</b>.</p>

<p style="margin-left:9%; margin-top: 1em">First, the
context in which we are working:</p>


<p style="margin-left:18%;"><b>:vcs_info:</b><i>vcs-string</i><b>:</b><i>user-context</i><b>:</b><i>repo-root-name</i></p>

<p style="margin-left:9%;"><i>vcs-string</i></p>

<p style="margin-left:18%;">is one of: <b>git</b>,
<b>git-svn</b>, <b>git-p4</b>, <b>hg</b>, <b>hg-git</b>,
<b>hg-hgsubversion</b>, <b>hg-hgsvn</b>, <b>darcs</b>,
<b>bzr</b>, <b>cdv</b>, <b>mtn</b>, <b>svn</b>, <b>cvs</b>,
<b>svk</b>, <b>tla</b>, <b>p4</b> or <b>fossil</b>. This is
followed by &lsquo;<b>.quilt-</b><i>quilt-mode</i>&rsquo; in
Quilt mode (see <b>Quilt Support</b> for details) and by
&lsquo;<b>+</b><i>hook-name</i>&rsquo; while hooks are
active (see <b>Hooks in vcs_info</b> for details).</p>

<p style="margin-left:18%; margin-top: 1em">Currently,
hooks in quilt mode don&rsquo;t add the
&lsquo;<b>.quilt-</b><i>quilt-mode</i>&rsquo; information.
This may change in the future.</p>

<p style="margin-left:9%;"><i>user-context</i></p>

<p style="margin-left:18%;">is a freely configurable
string, assignable by the user as the first argument to
<b>vcs_info</b> (see its description below).</p>

<p style="margin-left:9%;"><i>repo-root-name</i></p>

<p style="margin-left:18%;">is the name of a repository in
which you want a style to match. So, if you want a setting
specific to <b>/usr/src/zsh</b>, with that being a CVS
checkout, you can set <i>repo-root-name</i> to <b>zsh</b> to
make it so.</p>

<p style="margin-left:9%; margin-top: 1em">There are three
special values for <i>vcs-string</i>: The first is named
<b>-init-</b>, that is in effect as long as there was no
decision what VCS backend to use. The second is
<b>-preinit-</b>; it is used <i>before</i> <b>vcs_info</b>
is run, when initializing the data exporting variables. The
third special value is <b>formats</b> and is used by the
<b>vcs_info_lastmsg</b> for looking up its styles.</p>

<p style="margin-left:9%; margin-top: 1em">The initial
value of <i>repo-root-name</i> is <b>-all-</b> and it is
replaced with the actual name, as soon as it is known. Only
use this part of the context for defining the
<b>formats</b>, <b>actionformats</b> or <b>branchformat</b>
styles, as it is guaranteed that <i>repo-root-name</i> is
set up correctly for these only. For all other styles, just
use <b>&rsquo;*&rsquo;</b> instead.</p>

<p style="margin-left:9%; margin-top: 1em">There are two
pre-defined values for <i>user-context</i>: <b><br>
default</b></p>

<p style="margin-left:18%;">the one used if none is
specified</p>

<p style="margin-left:9%;"><b>command</b></p>

<p style="margin-left:18%;">used by vcs_info_lastmsg to
lookup its styles</p>

<p style="margin-left:9%; margin-top: 1em">You can of
course use <b>&rsquo;:vcs_info:*&rsquo;</b> to match all
VCSs in all user-contexts at once.</p>

<p style="margin-left:9%; margin-top: 1em">This is a
description of all styles that are looked up. <b><br>
formats</b></p>

<p style="margin-left:18%;">A list of formats, used when
actionformats is not used (which is most of the time).</p>

<p style="margin-left:9%;"><b>actionformats</b></p>

<p style="margin-left:18%;">A list of formats, used if
there is a special action going on in your current
repository; like an interactive rebase or a merge
conflict.</p>

<p style="margin-left:9%;"><b>branchformat</b></p>

<p style="margin-left:18%;">Some backends replace <b>%b</b>
in the formats and actionformats styles above, not only by a
branch name but also by a revision number. This style lets
you modify how that string should look.</p>

<p style="margin-left:9%;"><b>nvcsformats</b></p>

<p style="margin-left:18%;">These &quot;formats&quot; are
set when we didn&rsquo;t detect a version control system for
the current directory or <b>vcs_info</b> was disabled. This
is useful if you want <b>vcs_info</b> to completely take
over the generation of your prompt. You would do something
like <b>PS1=&rsquo;${vcs_info_msg_0_}&rsquo;</b> to
accomplish that.</p>

<p style="margin-left:9%;"><b>hgrevformat</b></p>

<p style="margin-left:18%;"><b>hg</b> uses both a hash and
a revision number to reference a specific changeset in a
repository. With this style you can format the revision
string (see <b>branchformat</b>) to include either or both.
It&rsquo;s only useful when <b>get-revision</b> is true.
Note, the full 40-character revision id is not available
(except when using the <b>use-simple</b> option) because
executing hg more than once per prompt is too slow; you may
customize this behavior using hooks.</p>

<p style="margin-left:9%;"><b>max-exports</b></p>

<p style="margin-left:18%;">Defines the maximum number of
<b>vcs_info_msg_*_</b> variables <b>vcs_info</b> will
set.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>enable</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>A list of backends you want to use. Checked in the
<b>-init-</b> context. If this list contains an item called
<b>NONE</b> no backend is used at all and <b>vcs_info</b>
will do nothing. If this list contains <b>ALL</b>,
<b>vcs_info</b> will use all known backends. Only with
<b>ALL</b> in <b>enable</b> will the <b>disable</b> style
have any effect. <b>ALL</b> and <b>NONE</b> are case
insensitive.</p> </td></tr>
</table>

<p style="margin-left:9%;"><b>disable</b></p>

<p style="margin-left:18%;">A list of VCSs you don&rsquo;t
want <b>vcs_info</b> to test for repositories (checked in
the <b>-init-</b> context, too). Only used if <b>enable</b>
contains <b>ALL</b>.</p>

<p style="margin-left:9%;"><b>disable-patterns</b></p>

<p style="margin-left:18%;">A list of patterns that are
checked against <b>$PWD</b>. If a pattern matches,
<b>vcs_info</b> will be disabled. This style is checked in
the <b>:vcs_info:-init-:*:-all-</b> context.</p>

<p style="margin-left:18%; margin-top: 1em">Say,
<b>&#732;/.zsh</b> is a directory under version control, in
which you do not want <b>vcs_info</b> to be active, do:</p>

<p style="margin-left:27%;"><b>zstyle
&rsquo;:vcs_info:*&rsquo; disable-patterns
&quot;${(b)HOME}/.zsh(|/*)&quot;</b></p>

<p style="margin-left:9%;"><b>use-quilt</b></p>

<p style="margin-left:18%;">If enabled, the <b>quilt</b>
support code is active in &lsquo;addon&rsquo; mode. See
<b>Quilt Support</b> for details.</p>

<p style="margin-left:9%;"><b>quilt-standalone</b></p>

<p style="margin-left:18%;">If enabled,
&lsquo;standalone&rsquo; mode detection is attempted if no
VCS is active in a given directory. See <b>Quilt Support</b>
for details.</p>

<p style="margin-left:9%;"><b>quilt-patch-dir</b></p>

<p style="margin-left:18%;">Overwrite the value of the
<b>$QUILT_PATCHES</b> environment variable. See <b>Quilt
Support</b> for details.</p>

<p style="margin-left:9%;"><b>quiltcommand</b></p>

<p style="margin-left:18%;">When <b>quilt</b> itself is
called in quilt support, the value of this style is used as
the command name.</p>

<p style="margin-left:9%;"><b>check-for-changes</b></p>

<p style="margin-left:18%;">If enabled, this style causes
the <b>%c</b> and <b>%u</b> format escapes to show when the
working directory has uncommitted changes. The strings
displayed by these escapes can be controlled via the
<b>stagedstr</b> and <b>unstagedstr</b> styles. The only
backends that currently support this option are <b>git</b>,
<b>hg</b>, and <b>bzr</b> (the latter two only support
unstaged).</p>

<p style="margin-left:18%; margin-top: 1em">For this style
to be evaluated with the <b>hg</b> backend, the
<b>get-revision</b> style needs to be set and the
<b>use-simple</b> style needs to be unset. The latter is the
default; the former is not.</p>

<p style="margin-left:18%; margin-top: 1em">With the
<b>bzr</b> backend, <i>lightweight checkouts</i> only honor
this style if the <b>use-server</b> style is set.</p>

<p style="margin-left:18%; margin-top: 1em">Note, the
actions taken if this style is enabled are potentially
expensive (read: they may be slow, depending on how big the
current repository is). Therefore, it is disabled by
default.</p>


<p style="margin-left:9%;"><b>check-for-staged-changes</b></p>

<p style="margin-left:18%;">This style is like
<b>check-for-changes</b>, but it never checks the worktree
files, only the metadata in the <b>.${vcs}</b> dir.
Therefore, this style initializes only the <b>%c</b> escape
(with <b>stagedstr</b>) but not the <b>%u</b> escape. This
style is faster than <b>check-for-changes</b>.</p>

<p style="margin-left:18%; margin-top: 1em">In the
<b>git</b> backend, this style checks for changes in the
index. Other backends do not currently implement this
style.</p>

<p style="margin-left:18%; margin-top: 1em">This style is
disabled by default.</p>

<p style="margin-left:9%;"><b>stagedstr</b></p>

<p style="margin-left:18%;">This string will be used in the
<b>%c</b> escape if there are staged changes in the
repository.</p>

<p style="margin-left:9%;"><b>unstagedstr</b></p>

<p style="margin-left:18%;">This string will be used in the
<b>%u</b> escape if there are unstaged changes in the
repository.</p>

<p style="margin-left:9%;"><b>command</b></p>

<p style="margin-left:18%;">This style causes
<b>vcs_info</b> to use the supplied string as the command to
use as the VCS&rsquo;s binary. Note, that setting this in
&rsquo;<b>:vcs_info:*</b>&rsquo; is not a good idea.</p>

<p style="margin-left:18%; margin-top: 1em">If the value of
this style is empty (which is the default), the used binary
name is the name of the backend in use (e.g. <b>svn</b> is
used in an <b>svn</b> repository).</p>

<p style="margin-left:18%; margin-top: 1em">The
<b>repo-root-name</b> part in the context is always the
default <b>-all-</b> when this style is looked up.</p>

<p style="margin-left:18%; margin-top: 1em">For example,
this style can be used to use binaries from non-default
installation directories. Assume, <b>git</b> is installed in
/usr/bin but your sysadmin installed a newer version in
/usr/local/bin. Instead of changing the order of your
<b>$PATH</b> parameter, you can do this:</p>

<p style="margin-left:27%;"><b>zstyle
&rsquo;:vcs_info:git:*:-all-&rsquo; command
/usr/local/bin/git</b></p>

<p style="margin-left:9%;"><b>use-server</b></p>

<p style="margin-left:18%;">This is used by the Perforce
backend (<b>p4</b>) to decide if it should contact the
Perforce server to find out if a directory is managed by
Perforce. This is the only reliable way of doing this, but
runs the risk of a delay if the server name cannot be found.
If the server (more specifically, the
<i>host</i><b>:</b><i>port</i> pair describing the server)
cannot be contacted, its name is put into the associative
array <b>vcs_info_p4_dead_servers</b> and is not contacted
again during the session until it is removed by hand. If you
do not set this style, the <b>p4</b> backend is only usable
if you have set the environment variable <b>P4CONFIG</b> to
a file name and have corresponding files in the root
directories of each Perforce client. See comments in the
function <b>VCS_INFO_detect_p4</b> for more detail.</p>

<p style="margin-left:18%; margin-top: 1em">The Bazaar
backend (<b>bzr</b>) uses this to permit contacting the
server about lightweight checkouts, see the
<b>check-for-changes</b> style.</p>

<p style="margin-left:9%;"><b>use-simple</b></p>

<p style="margin-left:18%;">If there are two different ways
of gathering information, you can select the simpler one by
setting this style to true; the default is to use the
not-that-simple code, which is potentially a lot slower but
might be more accurate in all possible cases. This style is
used by the <b>bzr</b>, <b>hg</b>, and <b>git</b> backends.
In the case of <b>hg</b> it will invoke the external hexdump
program to parse the binary dirstate cache file; this method
will not return the local revision number.</p>

<p style="margin-left:9%;"><b>get-revision</b></p>

<p style="margin-left:18%;">If set to true, vcs_info goes
the extra mile to figure out the revision of a
repository&rsquo;s work tree (currently for the <b>git</b>
and <b>hg</b> backends, where this kind of information is
not always vital). For <b>git</b>, the hash value of the
currently checked out commit is available via the <b>%i</b>
expansion. With <b>hg</b>, the local revision number and the
corresponding global hash are available via <b>%i</b>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>get-mq</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>If set to true, the <b>hg</b> backend will look for a
Mercurial Queue (<b>mq</b>) patch directory. Information
will be available via the &lsquo;<b>%m</b>&rsquo;
replacement.</p> </td></tr>
</table>

<p style="margin-left:9%;"><b>get-bookmarks</b></p>

<p style="margin-left:18%;">If set to true, the <b>hg</b>
backend will try to get a list of current bookmarks. They
will be available via the &lsquo;<b>%m</b>&rsquo;
replacement.</p>

<p style="margin-left:18%; margin-top: 1em">The default is
to generate a comma-separated list of all bookmark names
that refer to the currently checked out revision. If a
bookmark is active, its name is suffixed an asterisk and
placed first in the list.</p>

<p style="margin-left:9%;"><b>use-prompt-escapes</b></p>

<p style="margin-left:18%;">Determines if we assume that
the assembled string from <b>vcs_info</b> includes prompt
escapes. (Used by <b>vcs_info_lastmsg</b>.)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="6%">


<p><b>debug</b></p></td>
<td width="3%"></td>
<td width="82%">


<p>Enable debugging output to track possible problems.
Currently this style is only used by <b>vcs_info</b>&rsquo;s
hooks system.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="6%">


<p><b>hooks</b></p></td>
<td width="3%"></td>
<td width="82%">


<p>A list style that defines hook-function names. See
<b>Hooks in vcs_info</b> below for details.</p></td></tr>
</table>

<p style="margin-left:9%;"><b>patch-format <br>
nopatch-format</b></p>

<p style="margin-left:18%;">This pair of styles format the
patch information used by the <b>%m</b> expando in formats
and actionformats for the <b>git</b> and <b>hg</b> backends.
The value is subject to certain <b>%</b>-expansions
described below. The expanded value is made available in the
global <b>backend_misc</b> array as
<b>${backend_misc[patches]}</b> (also if a
<b>set-patch-format</b> hook is used).</p>

<p style="margin-left:9%;"><b>get-unapplied</b></p>

<p style="margin-left:18%;">This boolean style controls
whether a backend should attempt to gather a list of
unapplied patches (for example with Mercurial Queue
patches).</p>

<p style="margin-left:18%; margin-top: 1em">Used by the
<b>quilt</b>, <b>hg</b>, and <b>git</b> backends.</p>

<p style="margin-left:9%; margin-top: 1em">The default
values for these styles in all contexts are: <b><br>
formats</b></p>

<p style="margin-left:18%;">&quot; (%s)-[%b]%u%c-&quot;</p>

<p style="margin-left:9%;"><b>actionformats</b></p>

<p style="margin-left:18%;">&quot;
(%s)-[%b|%a]%u%c-&quot;</p>

<p style="margin-left:9%;"><b>branchformat</b></p>

<p style="margin-left:18%;">&quot;%b:%r&quot; (for bzr,
svn, svk and hg)</p>

<p style="margin-left:9%;"><b>nvcsformats</b></p>

<p style="margin-left:18%;">&quot;&quot;</p>

<p style="margin-left:9%;"><b>hgrevformat</b></p>

<p style="margin-left:18%;">&quot;%r:%h&quot;</p>

<p style="margin-left:9%;"><b>max-exports</b></p>

<p style="margin-left:18%;">2</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>enable</b></p></td>
<td width="1%"></td>
<td width="4%">


<p>ALL</p></td>
<td width="78%">
</td></tr>
</table>

<p style="margin-left:9%;"><b>disable</b></p>

<p style="margin-left:18%;">(empty list)</p>

<p style="margin-left:9%;"><b>disable-patterns</b></p>

<p style="margin-left:18%;">(empty list)</p>

<p style="margin-left:9%;"><b>check-for-changes</b></p>

<p style="margin-left:18%;">false</p>


<p style="margin-left:9%;"><b>check-for-staged-changes</b></p>

<p style="margin-left:18%;">false</p>

<p style="margin-left:9%;"><b>stagedstr</b></p>

<p style="margin-left:18%;">(string: &quot;S&quot;)</p>

<p style="margin-left:9%;"><b>unstagedstr</b></p>

<p style="margin-left:18%;">(string: &quot;U&quot;)</p>

<p style="margin-left:9%;"><b>command</b></p>

<p style="margin-left:18%;">(empty string)</p>

<p style="margin-left:9%;"><b>use-server</b></p>

<p style="margin-left:18%;">false</p>

<p style="margin-left:9%;"><b>use-simple</b></p>

<p style="margin-left:18%;">false</p>

<p style="margin-left:9%;"><b>get-revision</b></p>

<p style="margin-left:18%;">false</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>get-mq</b></p></td>
<td width="1%"></td>
<td width="5%">


<p>true</p></td>
<td width="77%">
</td></tr>
</table>

<p style="margin-left:9%;"><b>get-bookmarks</b></p>

<p style="margin-left:18%;">false</p>

<p style="margin-left:9%;"><b>use-prompt-escapes</b></p>

<p style="margin-left:18%;">true</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="6%">


<p><b>debug</b></p></td>
<td width="3%"></td>
<td width="15%">


<p>false</p></td>
<td width="67%">
</td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="6%">


<p><b>hooks</b></p></td>
<td width="3%"></td>
<td width="15%">


<p>(empty list)</p></td>
<td width="67%">
</td></tr>
</table>

<p style="margin-left:9%;"><b>use-quilt</b></p>

<p style="margin-left:18%;">false</p>

<p style="margin-left:9%;"><b>quilt-standalone</b></p>

<p style="margin-left:18%;">false</p>

<p style="margin-left:9%;"><b>quilt-patch-dir</b></p>

<p style="margin-left:18%;">empty - use
<b>$QUILT_PATCHES</b></p>

<p style="margin-left:9%;"><b>quiltcommand</b></p>

<p style="margin-left:18%;">quilt</p>

<p style="margin-left:9%;"><b>patch-format</b></p>

<p style="margin-left:18%;"><i>backend dependent</i></p>

<p style="margin-left:9%;"><b>nopatch-format</b></p>

<p style="margin-left:18%;"><i>backend dependent</i></p>

<p style="margin-left:9%;"><b>get-unapplied</b></p>

<p style="margin-left:18%;">false</p>

<p style="margin-left:9%; margin-top: 1em">In normal
<b>formats</b> and <b>actionformats</b> the following
replacements are done:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%s</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The VCS in use (git, hg, svn, etc.).</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%b</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>Information about the current branch.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%a</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>An identifier that describes the action. Only makes
sense in <b>actionformats</b>.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%i</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The current revision number or identifier. For <b>hg</b>
the <b>hgrevformat</b> style may be used to customize the
output.</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%c</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The string from the <b>stagedstr</b> style if there are
staged changes in the repository.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%u</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The string from the <b>unstagedstr</b> style if there
are unstaged changes in the repository.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%R</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The base directory of the repository.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%r</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The repository name. If <b>%R</b> is
<b>/foo/bar/repoXY</b>, <b>%r</b> is <b>repoXY</b>.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%S</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>A subdirectory within a repository. If <b>$PWD</b> is
<b>/foo/bar/repoXY/beer/tasty</b>, <b>%S</b> is
<b>beer/tasty</b>.</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%m</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>A &quot;misc&quot; replacement. It is at the discretion
of the backend to decide what this replacement expands
to.</p> </td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">The <b>hg</b>
and <b>git</b> backends use this expando to display patch
information. <b>hg</b> sources patch information from the
<b>mq</b> extensions; <b>git</b> from in-progress
<b>rebase</b> and <b>cherry-pick</b> operations and from the
<b>stgit</b> extension. The <b>patch-format</b> and
<b>nopatch-format</b> styles control the generated string.
The former is used when at least one patch from the patch
queue has been applied, and the latter otherwise.</p>

<p style="margin-left:18%; margin-top: 1em">The <b>hg</b>
backend displays bookmark information in this expando (in
addition to <b>mq</b> information). See the <b>get-mq</b>
and <b>get-bookmarks</b> styles. Both of these styles may be
enabled at the same time. If both are enabled, both
resulting strings will be shown separated by a semicolon
(that cannot currently be customized).</p>

<p style="margin-left:18%; margin-top: 1em">The
<b>quilt</b> &lsquo;standalone&rsquo; backend sets this
expando to the same value as the <b>%Q</b> expando.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p style="margin-top: 1em"><b>%Q</b></p></td>
<td width="6%"></td>
<td width="82%">


<p style="margin-top: 1em">Quilt series information. When
quilt is used (either in &lsquo;addon&rsquo; mode or as a
&lsquo;standalone&rsquo; backend), this expando is set to
the quilt series&rsquo; <b>patch-format</b> string. The
<b>set-patch-format</b> hook and <b>nopatch-format</b> style
are honoured.</p></td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">See <b>Quilt
Support</b> below for details.</p>

<p style="margin-left:9%; margin-top: 1em">In
<b>branchformat</b> these replacements are done:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p style="margin-top: 1em"><b>%b</b></p></td>
<td width="6%"></td>
<td width="82%">


<p style="margin-top: 1em">The branch name. For <b>hg</b>,
the branch name can include a topic name.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%r</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The current revision number or the <b>hgrevformat</b>
style for <b>hg</b>.</p></td></tr>
</table>

<p style="margin-left:9%; margin-top: 1em">In
<b>hgrevformat</b> these replacements are done:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p style="margin-top: 1em"><b>%r</b></p></td>
<td width="6%"></td>
<td width="50%">


<p style="margin-top: 1em">The current local revision
number.</p> </td>
<td width="32%">
</td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%h</b></p></td>
<td width="6%"></td>
<td width="50%">


<p>The current global revision identifier.</p></td>
<td width="32%">
</td></tr>
</table>

<p style="margin-left:9%; margin-top: 1em">In
<b>patch-format</b> and <b>nopatch-format</b> these
replacements are done:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p style="margin-top: 1em"><b>%p</b></p></td>
<td width="6%"></td>
<td width="82%">


<p style="margin-top: 1em">The name of the top-most applied
patch; may be overridden by the <b>applied-string</b>
hook.</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%u</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The number of unapplied patches; may be overridden by
the <b>unapplied-string</b> hook.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%n</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The number of applied patches.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%c</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The number of unapplied patches.</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%a</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The number of all patches (<b>%a = %n + %c</b>).</p></td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%g</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The names of active <b>mq</b> guards (<b>hg</b>
backend).</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="3%">


<p><b>%G</b></p></td>
<td width="6%"></td>
<td width="82%">


<p>The number of active <b>mq</b> guards (<b>hg</b>
backend).</p> </td></tr>
</table>

<p style="margin-left:9%; margin-top: 1em">Not all VCS
backends have to support all replacements. For
<b>nvcsformats</b> no replacements are performed at all, it
is just a string.</p>

<h3>Oddities
<a name="Oddities"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">If you want to
use the <b>%b</b> (bold off) prompt expansion in
<b>formats</b>, which expands <b>%b</b> itself, use
<b>%%b</b>. That will cause the <b>vcs_info</b> expansion to
replace <b>%%b</b> with <b>%b</b>, so that zsh&rsquo;s
prompt expansion mechanism can handle it. Similarly, to hand
down <b>%b</b> from <b>branchformat</b>, use <b>%%%%b</b>.
Sorry for this inconvenience, but it cannot be easily
avoided. Luckily we do not clash with a lot of prompt
expansions and this only needs to be done for those.</p>

<p style="margin-left:9%; margin-top: 1em">When one of the
<b>gen-applied-string</b>, <b>gen-unapplied-string</b>, and
<b>set-patch-format</b> hooks is defined, applying
<b>%</b>-escaping
(&lsquo;<b>foo=${foo//&rsquo;%&rsquo;/%%}</b>&rsquo;) to the
interpolated values for use in the prompt is the
responsibility of those hooks (jointly); when neither of
those hooks is defined, <b>vcs_info</b> handles escaping by
itself. We regret this coupling, but it was required for
backwards compatibility.</p>

<h3>Quilt Support
<a name="Quilt Support"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em"><b>Quilt</b> is
not a version control system, therefore this is not
implemented as a backend. It can help keeping track of a
series of patches. People use it to keep a set of changes
they want to use on top of software packages (which is
tightly integrated into the package build process - the
Debian project does this for a large number of packages).
Quilt can also help individual developers keep track of
their own patches on top of real version control
systems.</p>

<p style="margin-left:9%; margin-top: 1em">The
<b>vcs_info</b> integration tries to support both ways of
using quilt by having two slightly different modes of
operation: &lsquo;addon&rsquo; mode and
&lsquo;standalone&rsquo; mode).</p>

<p style="margin-left:9%; margin-top: 1em">Quilt
integration is off by default; to enable it, set the
<b>use-quilt</b> style, and add <b>%Q</b> to your
<b>formats</b> or <b>actionformats</b> style:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*&rsquo; use-quilt true</b></p>

<p style="margin-left:9%; margin-top: 1em">Styles looked up
from the Quilt support code include
&lsquo;<b>.quilt-</b><i>quilt-mode</i>&rsquo; in the
<i>vcs-string</i> part of the context, where
<i>quilt-mode</i> is either <b>addon</b> or
<b>standalone</b>. Example:
<b>:vcs_info:git.quilt-addon:default:</b><i>repo-root-name</i>.</p>

<p style="margin-left:9%; margin-top: 1em">For
&lsquo;addon&rsquo; mode to become active <b>vcs_info</b>
must have already detected a real version control system
controlling the directory. If that is the case, a directory
that holds quilt&rsquo;s patches needs to be found. That
directory is configurable via the
&lsquo;<b>QUILT_PATCHES</b>&rsquo; environment variable. If
that variable exists its value is used, otherwise the value
&lsquo;<b>patches</b>&rsquo; is assumed. The value from
<b>$QUILT_PATCHES</b> can be overwritten using the
&lsquo;<b>quilt-patch-dir</b>&rsquo; style. (Note: you can
use <b>vcs_info</b> to keep the value of
<b>$QUILT_PATCHES</b> correct all the time via the
<b>post-quilt</b> hook).</p>

<p style="margin-left:9%; margin-top: 1em">When the
directory in question is found, quilt is assumed to be
active. To gather more information, <b>vcs_info</b> looks
for a directory called &lsquo;.pc&rsquo;; Quilt uses that
directory to track its current state. If this directory does
not exist we know that quilt has not done anything to the
working directory (read: no patches have been applied
yet).</p>

<p style="margin-left:9%; margin-top: 1em">If patches are
applied, <b>vcs_info</b> will try to find out which. If you
want to know which patches of a series are not yet applied,
you need to activate the <b>get-unapplied</b> style in the
appropriate context.</p>

<p style="margin-left:9%; margin-top: 1em"><b>vcs_info</b>
allows for very detailed control over how the gathered
information is presented (see the <b>Configuration</b> and
<b>Hooks in vcs_info</b> sections), all of which are
documented below. Note there are a number of other patch
tracking systems that work on top of a certain version
control system (like <b>stgit</b> for <b>git</b>, or
<b>mq</b> for <b>hg</b>); the configuration for systems like
that are generally configured the same way as the
<b>quilt</b> support.</p>

<p style="margin-left:9%; margin-top: 1em">If the
<b>quilt</b> support is working in &lsquo;addon&rsquo; mode,
the produced string is available as a simple format
replacement (<b>%Q</b> to be precise), which can be used in
<b>formats</b> and <b>actionformats</b>; see below for
details).</p>

<p style="margin-left:9%; margin-top: 1em">If, on the other
hand, the support code is working in
&lsquo;standalone&rsquo; mode, <b>vcs_info</b> will pretend
as if <b>quilt</b> were an actual version control system.
That means that the version control system identifier (which
otherwise would be something like &lsquo;svn&rsquo; or
&lsquo;cvs&rsquo;) will be set to
&lsquo;<b>-quilt-</b>&rsquo;. This has implications on the
used style context where this identifier is the second
element. <b>vcs_info</b> will have filled in a proper value
for the &quot;repository&rsquo;s&quot; root directory and
the string containing the information about quilt&rsquo;s
state will be available as the &lsquo;misc&rsquo;
replacement (and <b>%Q</b> for compatibility with
&lsquo;addon&rsquo; mode).</p>

<p style="margin-left:9%; margin-top: 1em">What is left to
discuss is how &lsquo;standalone&rsquo; mode is detected.
The detection itself is a series of searches for
directories. You can have this detection enabled all the
time in every directory that is not otherwise under version
control. If you know there is only a limited set of trees
where you would like <b>vcs_info</b> to try and look for
Quilt in &lsquo;standalone&rsquo; mode to minimise the
amount of searching on every call to <b>vcs_info</b>, there
are a number of ways to do that:</p>

<p style="margin-left:9%; margin-top: 1em">Essentially,
&lsquo;standalone&rsquo; mode detection is controlled by a
style called &lsquo;<b>quilt-standalone</b>&rsquo;. It is a
string style and its value can have different effects. The
simplest values are: &lsquo;<b>always</b>&rsquo; to run
detection every time <b>vcs_info</b> is run, and
&lsquo;<b>never</b>&rsquo; to turn the detection off
entirely.</p>

<p style="margin-left:9%; margin-top: 1em">If the value of
<b>quilt-standalone</b> is something else, it is interpreted
differently. If the value is the name of a scalar variable
the value of that variable is checked and that value is used
in the same &lsquo;always&rsquo;/&lsquo;never&rsquo; way as
described above.</p>

<p style="margin-left:9%; margin-top: 1em">If the value of
<b>quilt-standalone</b> is an array, the elements of that
array are used as directory names under which you want the
detection to be active.</p>

<p style="margin-left:9%; margin-top: 1em">If
<b>quilt-standalone</b> is an associative array, the keys
are taken as directory names under which you want the
detection to be active, but only if the corresponding value
is the string &lsquo;<b>true</b>&rsquo;.</p>

<p style="margin-left:9%; margin-top: 1em">Last, but not
least, if the value of <b>quilt-standalone</b> is the name
of a function, the function is called without arguments and
the return value decides whether detection should be active.
A &lsquo;0&rsquo; return value is true; a non-zero return
value is interpreted as false.</p>

<p style="margin-left:9%; margin-top: 1em">Note, if there
is both a function and a variable by the name of
<b>quilt-standalone</b>, the function will take
precedence.</p>

<h3>Function Descriptions (Public API)
<a name="Function Descriptions (Public API)"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em"><b>vcs_info</b>
[<i>user-context</i>]</p>

<p style="margin-left:18%;">The main function, that runs
all backends and assembles all data into
<b>${vcs_info_msg_*_}</b>. This is the function you want to
call from <b>precmd</b> if you want to include up-to-date
information in your prompt (see <b>Variable Description</b>
below). If an argument is given, that string will be used
instead of <b>default</b> in the <i>user-context</i> field
of the style context.</p>

<p style="margin-left:9%;"><b>vcs_info_hookadd</b></p>

<p style="margin-left:18%;">Statically registers a number
of functions to a given hook. The hook needs to be given as
the first argument; what follows is a list of hook-function
names to register to the hook. The &lsquo;<b>+vi-</b>&rsquo;
prefix needs to be left out here. See <b>Hooks in
vcs_info</b> below for details.</p>

<p style="margin-left:9%;"><b>vcs_info_hookdel</b></p>

<p style="margin-left:18%;">Remove hook-functions from a
given hook. The hook needs to be given as the first
non-option argument; what follows is a list of hook-function
names to un-register from the hook. If
&lsquo;<b>-a</b>&rsquo; is used as the first argument,
<b>all</b> occurrences of the functions are unregistered.
Otherwise only the last occurrence is removed (if a function
was registered to a hook more than once). The
&lsquo;<b>+vi-</b>&rsquo; prefix needs to be left out here.
See <b>Hooks in vcs_info</b> below for details.</p>

<p style="margin-left:9%;"><b>vcs_info_lastmsg</b></p>

<p style="margin-left:18%;">Outputs the current values of
<b>${vcs_info_msg_*_}</b>. Takes into account the value of
the <b>use-prompt-escapes</b> style in
<b>&rsquo;:vcs_info:formats:command:-all-&rsquo;</b>. It
also only prints <b>max-exports</b> values.</p>

<p style="margin-left:9%;"><b>vcs_info_printsys</b>
[<i>user-context</i>]</p>

<p style="margin-left:18%;">Prints a list of all supported
version control systems. Useful to find out possible
contexts (and which of them are enabled) or values for the
<b>disable</b> style.</p>

<p style="margin-left:9%;"><b>vcs_info_setsys</b></p>

<p style="margin-left:18%;">Initializes
<b>vcs_info</b>&rsquo;s internal list of available backends.
With this function, you can add support for new VCSs without
restarting the shell.</p>

<p style="margin-left:9%; margin-top: 1em">All functions
named <b>VCS_INFO_*</b> are for internal use only.</p>

<h3>Variable Description
<a name="Variable Description"></a>
</h3>



<p style="margin-left:9%; margin-top: 1em"><b>${vcs_info_msg_</b><i>N</i><b>_}</b>
(Note the trailing underscore)</p>

<p style="margin-left:18%;">Where <i>N</i> is an integer,
e.g., <b>vcs_info_msg_0_</b>. These variables are the
storage for the informational message the last
<b>vcs_info</b> call has assembled. These are strongly
connected to the <b>formats</b>, <b>actionformats</b> and
<b>nvcsformats</b> styles described above. Those styles are
lists. The first member of that list gets expanded into
<b>${vcs_info_msg_0_}</b>, the second into
<b>${vcs_info_msg_1_}</b> and the Nth into
<b>${vcs_info_msg_N-1_}</b>. (See the <b>max-exports</b>
style above.)</p>

<p style="margin-left:9%; margin-top: 1em">All variables
named <b>VCS_INFO_*</b> are for internal use only.</p>

<h3>Hooks in vcs_info
<a name="Hooks in vcs_info"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Hooks are places
in <b>vcs_info</b> where you can run your own code. That
code can communicate with the code that called it and
through that, change the system&rsquo;s behaviour.</p>

<p style="margin-left:9%; margin-top: 1em">For
configuration, hooks change the style context:</p>


<p style="margin-left:18%;"><b>:vcs_info:</b><i>vcs-string</i><b>+</b><i>hook-name</i><b>:</b><i>user-context</i><b>:</b><i>repo-root-name</i></p>

<p style="margin-left:9%; margin-top: 1em">To register
functions to a hook, you need to list them in the
<b>hooks</b> style in the appropriate context.</p>

<p style="margin-left:9%; margin-top: 1em">Example:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*+foo:*&rsquo; hooks bar baz</b></p>

<p style="margin-left:9%; margin-top: 1em">This registers
functions to the hook &lsquo;foo&rsquo; for all backends. In
order to avoid namespace problems, all registered function
names are prepended by a &lsquo;<b>+vi-</b>&rsquo;, so the
actual functions called for the &lsquo;foo&rsquo; hook are
&lsquo;<b>+vi-bar</b>&rsquo; and
&lsquo;<b>+vi-baz</b>&rsquo;.</p>

<p style="margin-left:9%; margin-top: 1em">If you would
like to register a function to a hook regardless of the
current context, you may use the <b>vcs_info_hookadd</b>
function. To remove a function that was added like that, the
<b>vcs_info_hookdel</b> function can be used.</p>

<p style="margin-left:9%; margin-top: 1em">If something
seems weird, you can enable the &lsquo;debug&rsquo; boolean
style in the proper context and the hook-calling code will
print what it tried to execute and whether the function in
question existed.</p>

<p style="margin-left:9%; margin-top: 1em">When you
register more than one function to a hook, all functions are
executed one after another until one function returns
non-zero or until all functions have been called.
Context-sensitive hook functions are executed <b>before</b>
statically registered ones (the ones added by
<b>vcs_info_hookadd</b>).</p>

<p style="margin-left:9%; margin-top: 1em">You may pass
data between functions via an associative array,
<b>user_data</b>. For example:</p>

<p style="margin-left:18%;"><b>+vi-git-myfirsthook(){ <br>
user_data[myval]=$myval <br>
} <br>
+vi-git-mysecondhook(){ <br>
# do something with ${user_data[myval]} <br>
}</b></p>

<p style="margin-left:9%; margin-top: 1em">There are a
number of variables that are special in hook contexts:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="4%">


<p><b>ret</b></p></td>
<td width="5%"></td>
<td width="82%">


<p>The return value that the hooks system will return to
the caller. The default is an integer &lsquo;zero&rsquo;. If
and how a changed <b>ret</b> value changes the execution of
the caller depends on the specific hook. See the hook
documentation below for details.</p></td></tr>
</table>

<p style="margin-left:9%;"><b>hook_com</b></p>

<p style="margin-left:18%;">An associated array which is
used for bidirectional communication from the caller to hook
functions. The used keys depend on the specific hook.</p>

<p style="margin-left:9%;"><b>context</b></p>

<p style="margin-left:18%;">The active context of the hook.
Functions that wish to change this variable should make it
local scope first.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="4%">


<p><b>vcs</b></p></td>
<td width="5%"></td>
<td width="82%">


<p>The current VCS after it was detected. The same values
as in the enable/disable style are used. Available in all
hooks except <b>start-up</b>.</p></td></tr>
</table>

<p style="margin-left:9%; margin-top: 1em">Finally, the
full list of currently available hooks: <b><br>
start-up</b></p>

<p style="margin-left:18%;">Called after starting
<b>vcs_info</b> but before the VCS in this directory is
determined. It can be used to deactivate <b>vcs_info</b>
temporarily if necessary. When <b>ret</b> is set to
<b>1</b>, <b>vcs_info</b> aborts and does nothing; when set
to <b>2</b>, <b>vcs_info</b> sets up everything as if no
version control were active and exits.</p>

<p style="margin-left:9%;"><b>pre-get-data</b></p>

<p style="margin-left:18%;">Same as <b>start-up</b> but
after the VCS was detected.</p>


<p style="margin-left:9%;"><b>gen-hg-bookmark-string</b></p>

<p style="margin-left:18%;">Called in the Mercurial backend
when a bookmark string is generated; the <b>get-revision</b>
and <b>get-bookmarks</b> styles must be true.</p>

<p style="margin-left:18%; margin-top: 1em">This hook gets
the names of the Mercurial bookmarks that <b>vcs_info</b>
collected from &lsquo;hg&rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">If a bookmark
is active, the key <b>${hook_com[hg-active-bookmark]}</b> is
set to its name. The key is otherwise unset.</p>

<p style="margin-left:18%; margin-top: 1em">When setting
<b>ret</b> to non-zero, the string in
<b>${hook_com[hg-bookmark-string]}</b> will be used in the
<b>%m</b> escape in <b>formats</b> and <b>actionformats</b>
and will be available in the global <b>backend_misc</b>
array as <b>${backend_misc[bookmarks]}</b>.</p>

<p style="margin-left:9%;"><b>gen-applied-string</b></p>

<p style="margin-left:18%;">Called in the <b>git</b> (with
<b>stgit</b> or during rebase or merge), and <b>hg</b> (with
<b>mq</b>) backends and in <b>quilt</b> support when the
<b>applied-string</b> is generated; the <b>use-quilt</b>
zstyle must be true for <b>quilt</b> (the <b>mq</b> and
<b>stgit</b> backends are active by default).</p>

<p style="margin-left:18%; margin-top: 1em">The arguments
to this hook describe applied patches in the opposite order,
which means that the first argument is the top-most patch
and so forth.</p>

<p style="margin-left:18%; margin-top: 1em">When the
patches&rsquo; log messages can be extracted, those are
embedded within each argument after a space, so each
argument is of the form &lsquo;<i>patch-name first line of
the log message</i>&rsquo;, where <i>patch-name</i> contains
no whitespace. The <b>mq</b> backend passes arguments of the
form &lsquo;<i>patch name</i>&rsquo;, with possible embedded
spaces, but without extracting the patch&rsquo;s log
message.</p>

<p style="margin-left:18%; margin-top: 1em">When setting
<b>ret</b> to non-zero, the string in
<b>${hook_com[applied-string]}</b> will be available as
<b>%p</b> in the <b>patch-format</b> and
<b>nopatch-format</b> styles. This hook is, in concert with
<b>set-patch-format</b>, responsible for <b>%</b>-escaping
that value for use in the prompt. (See the <b>Oddities</b>
section.)</p>

<p style="margin-left:18%; margin-top: 1em">The
<b>quilt</b> backend passes to this hook the inputs
<b>${hook_com[quilt-patches-dir]}</b> and, if it has been
determined, <b>${hook_com[quilt-pc-dir]}</b>.</p>

<p style="margin-left:9%;"><b>gen-unapplied-string</b></p>

<p style="margin-left:18%;">Called in the <b>git</b> (with
<b>stgit</b> or during rebase), and <b>hg</b> (with
<b>mq</b>) backend and in <b>quilt</b> support when the
<b>unapplied-string</b> is generated; the
<b>get-unapplied</b> style must be true.</p>

<p style="margin-left:18%; margin-top: 1em">This hook gets
the names of all unapplied patches which <b>vcs_info</b> in
order, which means that the first argument is the patch
next-in-line to be applied and so forth.</p>

<p style="margin-left:18%; margin-top: 1em">The format of
each argument is as for <b>gen-applied-string</b>,
above.</p>

<p style="margin-left:18%; margin-top: 1em">When setting
<b>ret</b> to non-zero, the string in
<b>${hook_com[unapplied-string]}</b> will be available as
<b>%u</b> in the <b>patch-format</b> and
<b>nopatch-format</b> styles. This hook is, in concert with
<b>set-patch-format</b>, responsible for <b>%</b>-escaping
that value for use in the prompt. (See the <b>Oddities</b>
section.)</p>

<p style="margin-left:18%; margin-top: 1em">The
<b>quilt</b> backend passes to this hook the inputs
<b>${hook_com[quilt-patches-dir]}</b> and, if it has been
determined, <b>${hook_com[quilt-pc-dir]}</b>.</p>

<p style="margin-left:9%;"><b>gen-mqguards-string</b></p>

<p style="margin-left:18%;">Called in the <b>hg</b> backend
when <b>guards-string</b> is generated; the <b>get-mq</b>
style must be true (default).</p>

<p style="margin-left:18%; margin-top: 1em">This hook gets
the names of any active <b>mq</b> guards.</p>

<p style="margin-left:18%; margin-top: 1em">When setting
<b>ret</b> to non-zero, the string in
<b>${hook_com[guards-string]}</b> will be used in the
<b>%g</b> escape in the <b>patch-format</b> and
<b>nopatch-format</b> styles.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>no-vcs</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>This hooks is called when no version control system was
detected.</p> </td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">The
&lsquo;<b>hook_com</b>&rsquo; parameter is not used.</p>

<p style="margin-left:9%;"><b>post-backend</b></p>

<p style="margin-left:18%;">Called as soon as the backend
has finished collecting information.</p>

<p style="margin-left:18%; margin-top: 1em">The
&lsquo;<b>hook_com</b>&rsquo; keys available are as for the
<b>set-message</b> hook.</p>

<p style="margin-left:9%;"><b>post-quilt</b></p>

<p style="margin-left:18%;">Called after the <b>quilt</b>
support is done. The following information is passed as
arguments to the hook: 1. the quilt-support mode
(&lsquo;addon&rsquo; or &lsquo;standalone&rsquo;); 2. the
directory that contains the patch series; 3. the directory
that holds quilt&rsquo;s status information (the
&lsquo;.pc&rsquo; directory) or the string
<b>&quot;-nopc-&quot;</b> if that directory wasn&rsquo;t
found.</p>

<p style="margin-left:18%; margin-top: 1em">The
&lsquo;hook_com&rsquo; parameter is not used.</p>

<p style="margin-left:9%;"><b>set-branch-format</b></p>

<p style="margin-left:18%;">Called before
&lsquo;<b>branchformat</b>&rsquo; is set. The only argument
to the hook is the format that is configured at this
point.</p>

<p style="margin-left:18%; margin-top: 1em">The
&lsquo;<b>hook_com</b>&rsquo; keys considered are
&lsquo;<b>branch</b>&rsquo; and
&lsquo;<b>revision</b>&rsquo;. They are set to the values
figured out so far by <b>vcs_info</b> and any change will be
used directly when the actual replacement is done.</p>

<p style="margin-left:18%; margin-top: 1em">If <b>ret</b>
is set to non-zero, the string in
<b>${hook_com[branch-replace]}</b> will be used unchanged as
the &lsquo;<b>%b</b>&rsquo; replacement in the variables set
by <b>vcs_info</b>.</p>

<p style="margin-left:9%;"><b>set-hgrev-format</b></p>

<p style="margin-left:18%;">Called before a
&lsquo;<b>hgrevformat</b>&rsquo; is set. The only argument
to the hook is the format that is configured at this
point.</p>

<p style="margin-left:18%; margin-top: 1em">The
&lsquo;<b>hook_com</b>&rsquo; keys considered are
&lsquo;<b>hash</b>&rsquo; and &lsquo;<b>localrev</b>&rsquo;.
They are set to the values figured out so far by
<b>vcs_info</b> and any change will be used directly when
the actual replacement is done.</p>

<p style="margin-left:18%; margin-top: 1em">If <b>ret</b>
is set to non-zero, the string in
<b>${hook_com[rev-replace]}</b> will be used unchanged as
the &lsquo;<b>%i</b>&rsquo; replacement in the variables set
by <b>vcs_info</b>.</p>

<p style="margin-left:9%;"><b>pre-addon-quilt</b></p>

<p style="margin-left:18%;">This hook is used when
<b>vcs_info</b>&rsquo;s quilt functionality is active in
&quot;addon&quot; mode (quilt used on top of a real version
control system). It is activated right before any quilt
specific action is taken.</p>

<p style="margin-left:18%; margin-top: 1em">Setting the
&lsquo;<b>ret</b>&rsquo; variable in this hook to a non-zero
value avoids any quilt specific actions from being run at
all.</p>

<p style="margin-left:9%;"><b>set-patch-format</b></p>

<p style="margin-left:18%;">This hook is used to control
some of the possible expansions in <b>patch-format</b> and
<b>nopatch-format</b> styles with patch queue systems such
as quilt, mqueue and the like.</p>

<p style="margin-left:18%; margin-top: 1em">This hook is
used in the <b>git</b>, <b>hg</b> and <b>quilt</b>
backends.</p>

<p style="margin-left:18%; margin-top: 1em">The hook allows
the control of the <b>%p</b> (<b>${hook_com[applied]}</b>)
and <b>%u</b> (<b>${hook_com[unapplied]}</b>) expansion in
all backends that use the hook. With the mercurial backend,
the <b>%g</b> (<b>${hook_com[guards]}</b>) expansion is
controllable in addition to that.</p>

<p style="margin-left:18%; margin-top: 1em">If <b>ret</b>
is set to non-zero, the string in
<b>${hook_com[patch-replace]}</b> will be used unchanged
instead of an expanded format from <b>patch-format</b> or
<b>nopatch-format</b>.</p>

<p style="margin-left:18%; margin-top: 1em">This hook is,
in concert with the <b>gen-applied-string</b> or
<b>gen-unapplied-string</b> hooks if they are defined,
responsible for <b>%</b>-escaping the final
<b>patch-format</b> value for use in the prompt. (See the
<b>Oddities</b> section.)</p>

<p style="margin-left:18%; margin-top: 1em">The
<b>quilt</b> backend passes to this hook the inputs
<b>${hook_com[quilt-patches-dir]}</b> and, if it has been
determined, <b>${hook_com[quilt-pc-dir]}</b>.</p>

<p style="margin-left:9%;"><b>set-message</b></p>

<p style="margin-left:18%;">Called each time before a
&lsquo;<b>vcs_info_msg_</b><i>N</i><b>_</b>&rsquo; message
is set. It takes two arguments; the first being the
&lsquo;<i>N</i>&rsquo; in the message variable name, the
second is the currently configured <b>formats</b> or
<b>actionformats</b>.</p>

<p style="margin-left:18%; margin-top: 1em">There are a
number of &lsquo;<b>hook_com</b>&rsquo; keys, that are used
here: &lsquo;<b>action</b>&rsquo;,
&lsquo;<b>branch</b>&rsquo;, &lsquo;<b>base</b>&rsquo;,
&lsquo;<b>base-name</b>&rsquo;, &lsquo;<b>subdir</b>&rsquo;,
&lsquo;<b>staged</b>&rsquo;, &lsquo;<b>unstaged</b>&rsquo;,
&lsquo;<b>revision</b>&rsquo;, &lsquo;<b>misc</b>&rsquo;,
&lsquo;<b>vcs</b>&rsquo; and one &lsquo;<b>miscN</b>&rsquo;
entry for each backend-specific data field (<b>N</b>
starting at zero). They are set to the values figured out so
far by <b>vcs_info</b> and any change will be used directly
when the actual replacement is done.</p>

<p style="margin-left:18%; margin-top: 1em">Since this hook
is triggered multiple times (once for each configured
<b>formats</b> or <b>actionformats</b>), each of the
&lsquo;<b>hook_com</b>&rsquo; keys mentioned above (except
for the <b>miscN</b> entries) has an
&lsquo;<b>_orig</b>&rsquo; counterpart, so even if you
changed a value to your liking you can still get the
original value in the next run. Changing the
&lsquo;<b>_orig</b>&rsquo; values is probably not a good
idea.</p>

<p style="margin-left:18%; margin-top: 1em">If <b>ret</b>
is set to non-zero, the string in
<b>${hook_com[message]}</b> will be used unchanged as the
message by <b>vcs_info</b>.</p>

<p style="margin-left:9%; margin-top: 1em">If all of this
sounds rather confusing, take a look at the <b>Examples</b>
section below and also in the <b>Misc/vcs_info-examples</b>
file in the Zsh source. They contain some explanatory
code.</p>

<h3>Examples
<a name="Examples"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Don&rsquo;t use
<b>vcs_info</b> at all (even though it&rsquo;s in your
prompt):</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*&rsquo; enable NONE</b></p>

<p style="margin-left:9%; margin-top: 1em">Disable the
backends for <b>bzr</b> and <b>svk</b>:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*&rsquo; disable bzr svk</b></p>

<p style="margin-left:9%; margin-top: 1em">Disable
everything <i>but</i> <b>bzr</b> and <b>svk</b>:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*&rsquo; enable bzr svk</b></p>

<p style="margin-left:9%; margin-top: 1em">Provide a
special formats for <b>git</b>:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:git:*&rsquo; formats &rsquo; GIT, BABY!
[%b]&rsquo; <br>
zstyle &rsquo;:vcs_info:git:*&rsquo; actionformats &rsquo;
GIT ACTION! [%b|%a]&rsquo;</b></p>

<p style="margin-left:9%; margin-top: 1em">All <b>%x</b>
expansion in all sorts of formats (<b>formats</b>,
<b>actionformats</b>, <b>branchformat</b>, you name it) are
done using the &lsquo;<b>zformat</b>&rsquo; builtin from the
&lsquo;<b>zsh/zutil</b>&rsquo; module. That means you can do
everything with these <b>%x</b> items what zformat supports.
In particular, if you want something that is really long to
have a fixed width, like a hash in a mercurial branchformat,
you can do this: <b>%12.12i</b>. That&rsquo;ll shrink the 40
character hash to its 12 leading characters. The form is
actually
&lsquo;<b>%</b><i>min</i><b>.</b><i>max</i><b>x</b>&rsquo;.
More is possible. See the section &lsquo;The zsh/zutil
Module&rsquo; in <i>zshmodules</i>(1) for details.</p>

<p style="margin-left:9%; margin-top: 1em">Use the quicker
<b>bzr</b> backend</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:bzr:*&rsquo; use-simple true</b></p>

<p style="margin-left:9%; margin-top: 1em">If you do use
<b>use-simple</b>, please report if it does
&lsquo;the-right-thing[tm]&rsquo;.</p>

<p style="margin-left:9%; margin-top: 1em">Display the
revision number in yellow for <b>bzr</b> and <b>svn</b>:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:(svn|bzr):*&rsquo; \ <br>
branchformat &rsquo;%b%%F{yellow}:%r&rsquo;</b></p>

<p style="margin-left:9%; margin-top: 1em">The doubled
percent sign is explained in the <b>Oddities</b>
section.</p>

<p style="margin-left:9%; margin-top: 1em">Alternatively,
one can use the raw colour codes directly:</p>

<p style="margin-left:18%; margin-top: 1em"><b>zstyle
&rsquo;:vcs_info:(svn|bzr):*&rsquo; \ <br>
branchformat
&rsquo;%b%{&rsquo;${fg[yellow]}&rsquo;%}:%r&rsquo;</b></p>

<p style="margin-left:9%; margin-top: 1em">Normally when a
variable is interpolated into a format string, the variable
needs to be <b>%</b>-escaped. In this example we skipped
that because we assume the value of <b>${fg[yellow]}</b>
doesn&rsquo;t contain any <b>%</b> signs.</p>

<p style="margin-left:9%; margin-top: 1em">Make sure you
enclose the color codes in <b>%{</b><i>...</i><b>%}</b> if
you want to use the string provided by <b>vcs_info</b> in
prompts.</p>

<p style="margin-left:9%; margin-top: 1em">Here is how to
print the VCS information as a command (not in a
prompt):</p>

<p style="margin-left:18%;"><b>vcsi() { vcs_info
interactive; vcs_info_lastmsg }</b></p>

<p style="margin-left:9%; margin-top: 1em">This way, you
can even define different formats for output via
<b>vcs_info_lastmsg</b> in the
&rsquo;<b>:vcs_info:*:interactive:*</b>&rsquo;
namespace.</p>

<p style="margin-left:9%; margin-top: 1em">Now as promised,
some code that uses hooks: say, you&rsquo;d like to replace
the string &lsquo;svn&rsquo; by &lsquo;subversion&rsquo; in
<b>vcs_info</b>&rsquo;s <b>%s formats</b> replacement.</p>

<p style="margin-left:9%; margin-top: 1em">First, we will
tell <b>vcs_info</b> to call a function when populating the
message variables with the gathered information:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*+set-message:*&rsquo; hooks
svn2subversion</b></p>

<p style="margin-left:9%; margin-top: 1em">Nothing happens.
Which is reasonable, since we didn&rsquo;t define the actual
function yet. To see what the hooks subsystem is trying to
do, enable the &lsquo;<b>debug</b>&rsquo; style:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*+*:*&rsquo; debug true</b></p>

<p style="margin-left:9%; margin-top: 1em">That should give
you an idea what is going on. Specifically, the function
that we are looking for is
&lsquo;<b>+vi-svn2subversion</b>&rsquo;. Note, the
&lsquo;<b>+vi-</b>&rsquo; prefix. So, everything is in
order, just as documented. When you are done checking out
the debugging output, disable it again:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:*+*:*&rsquo; debug false</b></p>

<p style="margin-left:9%; margin-top: 1em">Now, let&rsquo;s
define the function:</p>

<p style="margin-left:18%;"><b>function
+vi-svn2subversion() { <br>
[[ ${hook_com[vcs_orig]} == svn ]] &amp;&amp;
hook_com[vcs]=subversion <br>
}</b></p>

<p style="margin-left:9%; margin-top: 1em">Simple enough.
And it could have even been simpler, if only we had
registered our function in a less generic context. If we do
it only in the &lsquo;<b>svn</b>&rsquo; backend&rsquo;s
context, we don&rsquo;t need to test which the active
backend is:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:svn+set-message:*&rsquo; hooks
svn2subversion <br>
function +vi-svn2subversion() { <br>
hook_com[vcs]=subversion <br>
}</b></p>

<p style="margin-left:9%; margin-top: 1em">And finally a
little more elaborate example, that uses a hook to create a
customised bookmark string for the <b>hg</b> backend.</p>

<p style="margin-left:9%; margin-top: 1em">Again, we start
off by registering a function:</p>

<p style="margin-left:18%;"><b>zstyle
&rsquo;:vcs_info:hg+gen-hg-bookmark-string:*&rsquo; hooks
hgbookmarks</b></p>

<p style="margin-left:9%; margin-top: 1em">And then we
define the &lsquo;<b>+vi-hgbookmarks</b>&rsquo;
function:</p>

<p style="margin-left:18%;"><b>function +vi-hgbookmarks() {
<br>
# The default is to connect all bookmark names by <br>
# commas. This mixes things up a little. <br>
# Imagine, there&rsquo;s one type of bookmarks that is <br>
# special to you. Say, because it&rsquo;s *your* work. <br>
# Those bookmarks look always like this: &quot;sh/*&quot;
<br>
# (because your initials are sh, for example). <br>
# This makes the bookmarks string use only those <br>
# bookmarks. If there&rsquo;s more than one, it <br>
# concatenates them using commas. <br>
# The bookmarks returned by &lsquo;hg&rsquo; are available
in <br>
# the function&rsquo;s positional parameters. <br>
local s=&quot;${(Mj:,:)@:#sh/*}&quot; <br>
# Now, the communication with the code that calls <br>
# the hook functions is done via the hook_com[] <br>
# hash. The key at which the
&lsquo;gen-hg-bookmark-string&rsquo; <br>
# hook looks is &lsquo;hg-bookmark-string&rsquo;. So: <br>
hook_com[hg-bookmark-string]=$s <br>
# And to signal that we want to use the string we <br>
# just generated, set the special variable &lsquo;ret&rsquo;
to <br>
# something other than the default zero: <br>
ret=1 <br>
return 0 <br>
}</b></p>

<p style="margin-left:9%; margin-top: 1em">Some longer
examples and code snippets which might be useful are
available in the examples file located at
Misc/vcs_info-examples in the Zsh source directory.</p>

<p style="margin-left:9%; margin-top: 1em">This concludes
our guided tour through zsh&rsquo;s <b>vcs_info</b>.</p>

<h2>PROMPT THEMES
<a name="PROMPT THEMES"></a>
</h2>


<h3>Installation
<a name="Installation"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">You should make
sure all the functions from the <b>Functions/Prompts</b>
directory of the source distribution are available; they all
begin with the string &lsquo;<b>prompt_</b>&rsquo; except
for the special function &lsquo;<b>promptinit</b>&rsquo;.
You also need the &lsquo;<b>colors</b>&rsquo; and
&lsquo;<b>add-zsh-hook</b>&rsquo; functions from
<b>Functions/Misc</b>. All these functions may already be
installed on your system; if not, you will need to find them
and copy them. The directory should appear as one of the
elements of the <b>fpath</b> array (this should already be
the case if they were installed), and at least the function
<b>promptinit</b> should be autoloaded; it will autoload the
rest. Finally, to initialize the use of the system you need
to call the <b>promptinit</b> function. The following code
in your <b>.zshrc</b> will arrange for this; assume the
functions are stored in the directory
<b>&#732;/myfns</b>:</p>


<p style="margin-left:18%; margin-top: 1em"><b>fpath=(&#732;/myfns
$fpath) <br>
autoload -U promptinit <br>
promptinit</b></p>

<h3>Theme Selection
<a name="Theme Selection"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Use the
<b>prompt</b> command to select your preferred theme. This
command may be added to your <b>.zshrc</b> following the
call to <b>promptinit</b> in order to start zsh with a theme
already selected. <b><br>
prompt</b> [ <b>-c</b> | <b>-l</b> ] <b><br>
prompt</b> [ <b>-p</b> | <b>-h</b> ] [ <i>theme</i> ... ]
<b><br>
prompt</b> [ <b>-s</b> ] <i>theme</i> [ <i>arg</i> ... ]</p>

<p style="margin-left:18%;">Set or examine the prompt
theme. With no options and a <i>theme</i> argument, the
theme with that name is set as the current theme. The
available themes are determined at run time; use the
<b>-l</b> option to see a list. The special <i>theme</i>
&lsquo;<b>random</b>&rsquo; selects at random one of the
available themes and sets your prompt to that.</p>

<p style="margin-left:18%; margin-top: 1em">In some cases
the <i>theme</i> may be modified by one or more arguments,
which should be given after the theme name. See the help for
each theme for descriptions of these arguments.</p>

<p style="margin-left:18%; margin-top: 1em">Options
are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-c</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Show the currently selected theme and its parameters, if
any.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-l</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>List all available prompt themes.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-p</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Preview the theme named by <i>theme</i>, or all themes
if no <i>theme</i> is given.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-h</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Show help for the theme named by <i>theme</i>, or for
the <b>prompt</b> function if no <i>theme</i> is given.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-s</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Set <i>theme</i> as the current theme and save
state.</p> </td></tr>
</table>


<p style="margin-left:9%;"><b>prompt_</b><i>theme</i><b>_setup</b></p>

<p style="margin-left:18%;">Each available <i>theme</i> has
a setup function which is called by the <b>prompt</b>
function to install that theme. This function may define
other functions as necessary to maintain the prompt,
including functions used to preview the prompt or provide
help for its use. You should not normally call a
theme&rsquo;s setup function directly.</p>

<h3>Utility Themes
<a name="Utility Themes"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em"><b>prompt
off</b></p>

<p style="margin-left:18%;">The theme
&lsquo;<b>off</b>&rsquo; sets all the prompt variables to
minimal values with no special effects.</p>

<p style="margin-left:9%;"><b>prompt default</b></p>

<p style="margin-left:18%;">The theme
&lsquo;<b>default</b>&rsquo; sets all prompt variables to
the same state as if an interactive zsh was started with no
initialization files.</p>

<p style="margin-left:9%;"><b>prompt restore</b></p>

<p style="margin-left:18%;">The special theme
&lsquo;<b>restore</b>&rsquo; erases all theme settings and
sets prompt variables to their state before the first time
the &lsquo;<b>prompt</b>&rsquo; function was run, provided
each theme has properly defined its cleanup (see below).</p>

<p style="margin-left:18%; margin-top: 1em">Note that you
can undo &lsquo;<b>prompt off</b>&rsquo; and
&lsquo;<b>prompt default</b>&rsquo; with &lsquo;<b>prompt
restore</b>&rsquo;, but a second restore does not undo the
first.</p>

<h3>Writing Themes
<a name="Writing Themes"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The first step
for adding your own theme is to choose a name for it, and
create a file
&lsquo;<b>prompt_</b><i>name</i><b>_setup</b><i>&rsquo; in a
directory in your</i> <b>fpath</b><i>, such as</i>
<b>&#732;/myfns</b> <i>in the example above. The file should
at minimum contain assignments for the prompt variables that
your theme wishes to modify. By convention, themes use</i>
<b>PS1</b><i>,</i> <b>PS2</b><i>,</i> <b>RPS1</b><i>, etc.,
rather than the longer</i> <b>PROMPT</b> <i>and</i>
<b>RPROMPT</b><i>.</i></p>

<p style="margin-left:9%; margin-top: 1em">The file is
autoloaded as a function in the current shell context, so it
may contain any necessary commands to customize your theme,
including defining additional functions. To make some
complex tasks easier, your setup function may also do any of
the following: <br>
Assign <b>prompt_opts</b></p>

<p style="margin-left:18%;">The array <b>prompt_opts</b>
may be assigned any of <b>&quot;bang&quot;</b>,
<b>&quot;cr&quot;</b>, <b>&quot;percent&quot;</b>,
<b>&quot;sp&quot;</b>, and/or <b>&quot;subst&quot;</b> as
values. The corresponding setopts (<b>promptbang</b>, etc.)
are turned on, all other prompt-related options are turned
off. The <b>prompt_opts</b> array preserves setopts even
beyond the scope of <b>localoptions</b>, should your
function need that.</p>

<p style="margin-left:9%;">Modify hooks</p>

<p style="margin-left:18%;">Use of <b>add-zsh-hook</b> and
<b>add-zle-hook-widget</b> is recommended (see the
<b>Manipulating Hook Functions</b> section above). All hooks
that follow the naming pattern
<b>prompt_</b><i>theme</i><b>_</b><i>hook</i> are
automatically removed when the prompt theme changes or is
disabled.</p>

<p style="margin-left:9%;">Declare cleanup</p>

<p style="margin-left:18%;">If your function makes any
other changes that should be undone when the theme is
disabled, your setup function may call</p>


<p style="margin-left:27%; margin-top: 1em"><b>prompt_cleanup</b>
<i>command</i></p>

<p style="margin-left:18%; margin-top: 1em">where
<i>command</i> should be suitably quoted. If your theme is
ever disabled or replaced by another, <i>command</i> is
executed with <b>eval</b>. You may declare more than one
such cleanup hook.</p>

<p style="margin-left:9%;">Define preview</p>

<p style="margin-left:18%;">Define or autoload a function
<b>prompt_</b><i>name</i><b>_preview</b> to display a
simulated version of your prompt. A simple default previewer
is defined by <b>promptinit</b> for themes that do not
define their own. This preview function is called by
&lsquo;<b>prompt -p</b>&rsquo;.</p>

<p style="margin-left:9%;">Provide help</p>

<p style="margin-left:18%;">Define or autoload a function
<b>prompt_</b><i>name</i><b>_help</b> to display
documentation or help text for your theme. This help
function is called by &lsquo;<b>prompt -h</b>&rsquo;.</p>

<h2>ZLE FUNCTIONS
<a name="ZLE FUNCTIONS"></a>
</h2>


<h3>Widgets
<a name="Widgets"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">These functions
all implement user-defined ZLE widgets (see
<i>zshzle</i>(1)) which can be bound to keystrokes in
interactive shells. To use them, your <b>.zshrc</b> should
contain lines of the form</p>


<p style="margin-left:18%; margin-top: 1em"><b>autoload</b>
<i>function</i> <b><br>
zle -N</b> <i>function</i></p>

<p style="margin-left:9%; margin-top: 1em">followed by an
appropriate <b>bindkey</b> command to associate the function
with a key sequence. Suggested bindings are described below.
<br>
bash-style word functions</p>

<p style="margin-left:18%;">If you are looking for
functions to implement moving over and editing words in the
manner of bash, where only alphanumeric characters are
considered word characters, you can use the functions
described in the next section. The following is
sufficient:</p>

<p style="margin-left:27%; margin-top: 1em"><b>autoload -U
select-word-style <br>
select-word-style bash</b></p>

<p style="margin-left:9%;"><b>forward-word-match</b>,
<b>backward-word-match <br>
kill-word-match</b>, <b>backward-kill-word-match <br>
transpose-words-match</b>, <b>capitalize-word-match <br>
up-case-word-match</b>, <b>down-case-word-match <br>
delete-whole-word-match</b>, <b>select-word-match <br>
select-word-style</b>, <b>match-word-context</b>,
<b>match-words-by-style</b></p>

<p style="margin-left:18%;">The first eight
&lsquo;<b>-match</b>&rsquo; functions are drop-in
replacements for the builtin widgets without the suffix. By
default they behave in a similar way. However, by the use of
styles and the function <b>select-word-style</b>, the way
words are matched can be altered. <b>select-word-match</b>
is intended to be used as a text object in vi mode but with
custom word styles. For comparison, the widgets described in
<i>zshzle</i>(1) under Text Objects use fixed definitions of
words, compatible with the <b>vim</b> editor.</p>

<p style="margin-left:18%; margin-top: 1em">The simplest
way of configuring the functions is to use
<b>select-word-style</b>, which can either be called as a
normal function with the appropriate argument, or invoked as
a user-defined widget that will prompt for the first
character of the word style to be used. The first time it is
invoked, the first eight <b>-match</b> functions will
automatically replace the builtin versions, so they do not
need to be loaded explicitly.</p>

<p style="margin-left:18%; margin-top: 1em">The word styles
available are as follows. Only the first character is
examined.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>bash</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>Word characters are alphanumeric characters only.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>normal</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>As in normal shell operation: word characters are
alphanumeric characters plus any characters present in the
string given by the parameter <b>$WORDCHARS</b>.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>shell</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>Words are complete shell command arguments, possibly
including complete quoted strings, or any tokens special to
the shell.</p></td></tr>
</table>

<p style="margin-left:18%;"><b>whitespace</b></p>

<p style="margin-left:27%;">Words are any set of characters
delimited by whitespace.</p>

<p style="margin-left:18%;"><b>default</b></p>

<p style="margin-left:27%;">Restore the default settings;
this is usually the same as &lsquo;<b>normal</b>&rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">All but
&lsquo;<b>default</b>&rsquo; can be input as an upper case
character, which has the same effect but with subword
matching turned on. In this case, words with upper case
characters are treated specially: each separate run of upper
case characters, or an upper case character followed by any
number of other characters, is considered a word. The style
<b>subword-range</b> can supply an alternative character
range to the default &lsquo;<b>[:upper:]</b>&rsquo;; the
value of the style is treated as the contents of a
&lsquo;<b>[</b><i>...</i><b>]</b>&rsquo; pattern (note that
the outer brackets should not be supplied, only those
surrounding named ranges).</p>

<p style="margin-left:18%; margin-top: 1em">More control
can be obtained using the <b>zstyle</b> command, as
described in <i>zshmodules</i>(1). Each style is looked up
in the context <b>:zle:</b><i>widget</i> where <i>widget</i>
is the name of the user-defined widget, not the name of the
function implementing it, so in the case of the definitions
supplied by <b>select-word-style</b> the appropriate
contexts are <b>:zle:forward-word</b>, and so on. The
function <b>select-word-style</b> itself always defines
styles for the context &lsquo;<b>:zle:*</b>&rsquo; which can
be overridden by more specific (longer) patterns as well as
explicit contexts.</p>

<p style="margin-left:18%; margin-top: 1em">The style
<b>word-style</b> specifies the rules to use. This may have
the following values.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>normal</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>Use the standard shell rules, i.e. alphanumerics and
<b>$WORDCHARS</b>, unless overridden by the styles
<b>word-chars</b> or <b>word-class</b>.</p></td></tr>
</table>

<p style="margin-left:18%;"><b>specified</b></p>

<p style="margin-left:27%;">Similar to <b>normal</b>, but
<i>only</i> the specified characters, and not also
alphanumerics, are considered word characters.</p>

<p style="margin-left:18%;"><b>unspecified</b></p>

<p style="margin-left:27%;">The negation of specified. The
given characters are those which will <i>not</i> be
considered part of a word.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="6%">


<p><b>shell</b></p></td>
<td width="3%"></td>
<td width="73%">


<p>Words are obtained by using the syntactic rules for
generating shell command arguments. In addition, special
tokens which are never command arguments such as
&lsquo;<b>()</b>&rsquo; are also treated as words.</p></td></tr>
</table>

<p style="margin-left:18%;"><b>whitespace</b></p>

<p style="margin-left:27%;">Words are whitespace-delimited
strings of characters.</p>

<p style="margin-left:18%; margin-top: 1em">The first three
of those rules usually use <b>$WORDCHARS</b>, but the value
in the parameter can be overridden by the style
<b>word-chars</b>, which works in exactly the same way as
<b>$WORDCHARS</b>. In addition, the style <b>word-class</b>
uses character class syntax to group characters and takes
precedence over <b>word-chars</b> if both are set. The
<b>word-class</b> style does not include the surrounding
brackets of the character class; for example,
&lsquo;<b>-:[:alnum:]</b>&rsquo; is a valid
<b>word-class</b> to include all alphanumerics plus the
characters &lsquo;<b>-</b>&rsquo; and
&lsquo;<b>:</b>&rsquo;. Be careful including
&lsquo;<b>]</b>&rsquo;, &lsquo;<b>&#710;</b>&rsquo; and
&lsquo;<b>-</b>&rsquo; as these are special inside character
classes.</p>


<p style="margin-left:18%; margin-top: 1em"><b>word-style</b>
may also have &lsquo;<b>-subword</b>&rsquo; appended to its
value to turn on subword matching, as described above.</p>

<p style="margin-left:18%; margin-top: 1em">The style
<b>skip-chars</b> is mostly useful for
<b>transpose-words</b> and similar functions. If set, it
gives a count of characters starting at the cursor position
which will not be considered part of the word and are
treated as space, regardless of what they actually are. For
example, if</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
&rsquo;:zle:transpose-words&rsquo; skip-chars 1</b></p>

<p style="margin-left:18%; margin-top: 1em">has been set,
and <b>transpose-words-match</b> is called with the cursor
on the <i>X</i> of <b>foo</b><i>X</i><b>bar</b>, where
<i>X</i> can be any character, then the resulting expression
is <b>bar</b><i>X</i><b>foo</b>.</p>

<p style="margin-left:18%; margin-top: 1em">Finer grained
control can be obtained by setting the style
<b>word-context</b> to an array of pairs of entries. Each
pair of entries consists of a <i>pattern</i> and a
<i>subcontext</i>. The shell argument the cursor is on is
matched against each <i>pattern</i> in turn until one
matches; if it does, the context is extended by a colon and
the corresponding <i>subcontext</i>. Note that the test is
made against the original word on the line, with no
stripping of quotes. Special handling is done between words:
the current context is examined and if it contains the
string <b>between</b> the word is set to a single space;
else if it is contains the string <b>back</b>, the word
before the cursor is considered, else the word after cursor
is considered. Some examples are given below.</p>

<p style="margin-left:18%; margin-top: 1em">The style
<b>skip-whitespace-first</b> is only used with the
<b>forward-word</b> widget. If it is set to true, then
<b>forward-word</b> skips any non-word-characters, followed
by any non-word-characters: this is similar to the behaviour
of other word-orientated widgets, and also that used by
other editors, however it differs from the standard zsh
behaviour. When using <b>select-word-style</b> the widget is
set in the context <b>:zle:*</b> to <b>true</b> if the word
style is <b>bash</b> and <b>false</b> otherwise. It may be
overridden by setting it in the more specific context
<b>:zle:forward-word*</b>.</p>

<p style="margin-left:18%; margin-top: 1em">It is possible
to create widgets with specific behaviour by defining a new
widget implemented by the appropriate generic function, then
setting a style for the context of the specific widget. For
example, the following defines a widget
<b>backward-kill-space-word</b> using
<b>backward-kill-word-match</b>, the generic widget
implementing <b>backward-kill-word</b> behaviour, and
ensures that the new widget always implements
space-delimited behaviour.</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
backward-kill-space-word backward-kill-word-match <br>
zstyle :zle:backward-kill-space-word word-style
space</b></p>

<p style="margin-left:18%; margin-top: 1em">The widget
<b>backward-kill-space-word</b> can now be bound to a
key.</p>

<p style="margin-left:18%; margin-top: 1em">Here are some
further examples of use of the styles, actually taken from
the simplified interface in <b>select-word-style</b>:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
&rsquo;:zle:*&rsquo; word-style standard <br>
zstyle &rsquo;:zle:*&rsquo; word-chars
&rsquo;&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">Implements
bash-style word handling for all widgets, i.e. only
alphanumerics are word characters; equivalent to setting the
parameter <b>WORDCHARS</b> empty for the given context.</p>

<p style="margin-left:27%; margin-top: 1em"><b>style
&rsquo;:zle:*kill*&rsquo; word-style space</b></p>

<p style="margin-left:18%; margin-top: 1em">Uses
space-delimited words for widgets with the word
&lsquo;kill&rsquo; in the name. Neither of the styles
<b>word-chars</b> nor <b>word-class</b> is used in this
case.</p>

<p style="margin-left:18%; margin-top: 1em">Here are some
examples of use of the <b>word-context</b> style to extend
the context.</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
&rsquo;:zle:*&rsquo; word-context \ <br>
&quot;*/*&quot; filename &quot;[[:space:]]&quot; whitespace
<br>
zstyle &rsquo;:zle:transpose-words:whitespace&rsquo;
word-style shell <br>
zstyle &rsquo;:zle:transpose-words:filename&rsquo;
word-style normal <br>
zstyle &rsquo;:zle:transpose-words:filename&rsquo;
word-chars &rsquo;&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">This provides
two different ways of using <b>transpose-words</b> depending
on whether the cursor is on whitespace between words or on a
filename, here any word containing a <b>/</b>. On
whitespace, complete arguments as defined by standard shell
rules will be transposed. In a filename, only alphanumerics
will be transposed. Elsewhere, words will be transposed
using the default style for <b>:zle:transpose-words</b>.</p>

<p style="margin-left:18%; margin-top: 1em">The word
matching and all the handling of <b>zstyle</b> settings is
actually implemented by the function
<b>match-words-by-style</b>. This can be used to create new
user-defined widgets. The calling function should set the
local parameter <b>curcontext</b> to
<b>:zle:</b><i>widget</i>, create the local parameter
<b>matched_words</b> and call <b>match-words-by-style</b>
with no arguments. On return, <b>matched_words</b> will be
set to an array with the elements: (1) the start of the line
(2) the word before the cursor (3) any non-word characters
between that word and the cursor (4) any non-word character
at the cursor position plus any remaining non-word
characters before the next word, including all characters
specified by the <b>skip-chars</b> style, (5) the word at or
following the cursor (6) any non-word characters following
that word (7) the remainder of the line. Any of the elements
may be an empty string; the calling function should test for
this to decide whether it can perform its function.</p>

<p style="margin-left:18%; margin-top: 1em">If the variable
<b>matched_words</b> is defined by the caller to
<b>match-words-by-style</b> as an associative array
(<b>local -A matched_words</b>), then the seven values given
above should be retrieved from it as elements named
<b>start</b>, <b>word-before-cursor</b>,
<b>ws-before-cursor</b>, <b>ws-after-cursor</b>,
<b>word-after-cursor</b>, <b>ws-after-word</b>, and
<b>end</b>. In addition the element <b>is-word-start</b> is
1 if the cursor is on the start of a word or subword, or on
white space before it (the cases can be distinguished by
testing the <b>ws-after-cursor</b> element) and 0 otherwise.
This form is recommended for future compatibility.</p>

<p style="margin-left:18%; margin-top: 1em">It is possible
to pass options with arguments to
<b>match-words-by-style</b> to override the use of styles.
The options are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-w</b></p></td>
<td width="6%"></td>
<td width="17%">


<p><i>word-style</i></p></td>
<td width="56%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-s</b></p></td>
<td width="6%"></td>
<td width="17%">


<p><i>skip-chars</i></p></td>
<td width="56%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-c</b></p></td>
<td width="6%"></td>
<td width="17%">


<p><i>word-class</i></p></td>
<td width="56%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-C</b></p></td>
<td width="6%"></td>
<td width="17%">


<p><i>word-chars</i></p></td>
<td width="56%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-r</b></p></td>
<td width="6%"></td>
<td width="17%">


<p><i>subword-range</i></p></td>
<td width="56%">
</td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">For example,
<b>match-words-by-style -w shell -c 0</b> may be used to
extract the command argument around the cursor.</p>

<p style="margin-left:18%; margin-top: 1em">The
<b>word-context</b> style is implemented by the function
<b>match-word-context</b>. This should not usually need to
be called directly.</p>


<p style="margin-left:9%;"><b>bracketed-paste-magic</b></p>

<p style="margin-left:18%;">The <b>bracketed-paste</b>
widget (see the subsection &lsquo;Miscellaneous&rsquo; in
<i>zshzle</i>(1)) inserts pasted text literally into the
editor buffer rather than interpret it as keystrokes. This
disables some common usages where the self-insert widget is
replaced in order to accomplish some extra processing. An
example is the contributed <b>url-quote-magic</b> widget
described below.</p>

<p style="margin-left:18%; margin-top: 1em">The
<b>bracketed-paste-magic</b> widget is meant to replace
<b>bracketed-paste</b> with a wrapper that re-enables these
self-insert actions, and other actions as selected by
zstyles. Therefore this widget is installed with</p>

<p style="margin-left:27%; margin-top: 1em"><b>autoload -Uz
bracketed-paste-magic <br>
zle -N bracketed-paste bracketed-paste-magic</b></p>

<p style="margin-left:18%; margin-top: 1em">Other than
enabling some widget processing,
<b>bracketed-paste-magic</b> attempts to replicate
<b>bracketed-paste</b> as faithfully as possible.</p>

<p style="margin-left:18%; margin-top: 1em">The following
zstyles may be set to control processing of pasted text. All
are looked up in the context
&lsquo;<b>:bracketed-paste-magic</b>&rsquo;. <b><br>
active-widgets</b></p>

<p style="margin-left:27%;">A list of patterns matching
widget names that should be activated during the paste. All
other key sequences are processed as self-insert-unmeta. The
default is &lsquo;<b>self-*</b>&rsquo; so any user-defined
widgets named with that prefix are active along with the
builtin self-insert.</p>

<p style="margin-left:27%; margin-top: 1em">If this style
is not set (explicitly deleted) or set to an empty value, no
widgets are active and the pasted text is inserted
literally. If the value includes
&lsquo;<b>undefined-key</b>&rsquo;, any unknown sequences
are discarded from the pasted text.</p>

<p style="margin-left:18%;"><b>inactive-keys</b></p>

<p style="margin-left:27%;">The inverse of
<b>active-widgets</b>, a list of key sequences that always
use <b>self-insert-unmeta</b> even when bound to an active
widget. Note that this is a list of literal key sequences,
not patterns.</p>

<p style="margin-left:18%;"><b>paste-init</b></p>

<p style="margin-left:27%;">A list of function names,
called in widget context (but not as widgets). The functions
are called in order until one of them returns a non-zero
status. The parameter &lsquo;<b>PASTED</b>&rsquo; contains
the initial state of the pasted text. All other ZLE
parameters such as &lsquo;<b>BUFFER</b>&rsquo; have their
normal values and side-effects, and full history is
available, so for example <b>paste-init</b> functions may
move words from <b>BUFFER</b> into <b>PASTED</b> to make
those words visible to the <b>active-widgets</b>.</p>

<p style="margin-left:27%; margin-top: 1em">A non-zero
return from a <b>paste-init</b> function does <i>not</i>
prevent the paste itself from proceeding.</p>

<p style="margin-left:27%; margin-top: 1em">Loading
<b>bracketed-paste-magic</b> defines
<b>backward-extend-paste</b>, a helper function for use in
<b>paste-init</b>.</p>

<p style="margin-left:36%; margin-top: 1em"><b>zstyle
:bracketed-paste-magic paste-init \ <br>
backward-extend-paste</b></p>

<p style="margin-left:27%; margin-top: 1em">When a paste
would insert into the middle of a word or append text to a
word already on the line, <b>backward-extend-paste</b> moves
the prefix from <b>LBUFFER</b> into <b>PASTED</b> so that
the <b>active-widgets</b> see the full word so far. This may
be useful with <b>url-quote-magic</b>.</p>

<p style="margin-left:18%;"><b>paste-finish</b></p>

<p style="margin-left:27%;">Another list of function names
called in order until one returns non-zero. These functions
are called <i>after</i> the pasted text has been processed
by the <b>active-widgets</b>, but <i>before</i> it is
inserted into &lsquo;<b>BUFFER</b>&rsquo;. ZLE parameters
have their normal values and side-effects.</p>

<p style="margin-left:27%; margin-top: 1em">A non-zero
return from a <b>paste-finish</b> function does <i>not</i>
prevent the paste itself from proceeding.</p>

<p style="margin-left:27%; margin-top: 1em">Loading
<b>bracketed-paste-magic</b> also defines
<b>quote-paste</b>, a helper function for use in
<b>paste-finish</b>.</p>

<p style="margin-left:36%; margin-top: 1em"><b>zstyle
:bracketed-paste-magic paste-finish \ <br>
quote-paste <br>
zstyle :bracketed-paste-magic:finish quote-style \ <br>
qqq</b></p>

<p style="margin-left:27%; margin-top: 1em">When the pasted
text is inserted into <b>BUFFER</b>, it is quoted per the
<b>quote-style</b> value. To forcibly turn off the built-in
numeric prefix quoting of <b>bracketed-paste</b>, use:</p>

<p style="margin-left:36%; margin-top: 1em"><b>zstyle
:bracketed-paste-magic:finish quote-style \ <br>
none</b></p>


<p style="margin-left:18%; margin-top: 1em"><i>Important:</i>
During <b>active-widgets</b> processing of the paste (after
<b>paste-init</b> and before <b>paste-finish</b>),
<b>BUFFER</b> starts empty and history is restricted, so
cursor motions, etc., may not pass outside of the pasted
content. Text assigned to <b>BUFFER</b> by the active
widgets is copied back into <b>PASTED</b> before
<b>paste-finish</b>.</p>

<p style="margin-left:9%;"><b>copy-earlier-word</b></p>

<p style="margin-left:18%;">This widget works like a
combination of <b>insert-last-word</b> and
<b>copy-prev-shell-word</b>. Repeated invocations of the
widget retrieve earlier words on the relevant history line.
With a numeric argument <i>N</i>, insert the <i>N</i>th word
from the history line; <i>N</i> may be negative to count
from the end of the line.</p>

<p style="margin-left:18%; margin-top: 1em">If
<b>insert-last-word</b> has been used to retrieve the last
word on a previous history line, repeated invocations will
replace that word with earlier words from the same line.</p>

<p style="margin-left:18%; margin-top: 1em">Otherwise, the
widget applies to words on the line currently being edited.
The <b>widget</b> style can be set to the name of another
widget that should be called to retrieve words. This widget
must accept the same three arguments as
<b>insert-last-word</b>.</p>


<p style="margin-left:9%;"><b>cycle-completion-positions</b></p>

<p style="margin-left:18%;">After inserting an unambiguous
string into the command line, the new function based
completion system may know about multiple places in this
string where characters are missing or differ from at least
one of the possible matches. It will then place the cursor
on the position it considers to be the most interesting one,
i.e. the one where one can disambiguate between as many
matches as possible with as little typing as possible.</p>

<p style="margin-left:18%; margin-top: 1em">This widget
allows the cursor to be easily moved to the other
interesting spots. It can be invoked repeatedly to cycle
between all positions reported by the completion system.</p>


<p style="margin-left:9%;"><b>delete-whole-word-match</b></p>

<p style="margin-left:18%;">This is another function which
works like the <b>-match</b> functions described immediately
above, i.e. using styles to decide the word boundaries.
However, it is not a replacement for any existing
function.</p>

<p style="margin-left:18%; margin-top: 1em">The basic
behaviour is to delete the word around the cursor. There is
no numeric argument handling; only the single word around
the cursor is considered. If the widget contains the string
<b>kill</b>, the removed text will be placed in the
cutbuffer for future yanking. This can be obtained by
defining <b>kill-whole-word-match</b> as follows:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
kill-whole-word-match delete-whole-word-match</b></p>

<p style="margin-left:18%; margin-top: 1em">and then
binding the widget <b>kill-whole-word-match</b>.</p>


<p style="margin-left:9%;"><b>up-line-or-beginning-search</b>,
<b>down-line-or-beginning-search</b></p>

<p style="margin-left:18%;">These widgets are similar to
the builtin functions <b>up-line-or-search</b> and
<b>down-line-or-search</b>: if in a multiline buffer they
move up or down within the buffer, otherwise they search for
a history line matching the start of the current line. In
this case, however, they search for a line which matches the
current line up to the current cursor position, in the
manner of <b>history-beginning-search-backward</b> and
<b>-forward</b>, rather than the first word on the line.</p>

<p style="margin-left:9%;"><b>edit-command-line</b></p>

<p style="margin-left:18%;">Edit the command line using
your visual editor, as in <b>ksh</b>.</p>

<p style="margin-left:27%; margin-top: 1em"><b>bindkey -M
vicmd v edit-command-line</b></p>

<p style="margin-left:18%; margin-top: 1em">The editor to
be used can also be specified using the <b>editor</b> style
in the context of the widget. It is specified as an array of
command and arguments:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
:zle:edit-command-line editor gvim -f</b></p>

<p style="margin-left:9%;"><b>expand-absolute-path</b></p>

<p style="margin-left:18%;">Expand the file name under the
cursor to an absolute path, resolving symbolic links. Where
possible, the initial path segment is turned into a named
directory or reference to a user&rsquo;s home directory.</p>

<p style="margin-left:9%;"><b>history-search-end</b></p>

<p style="margin-left:18%;">This function implements the
widgets <b>history-beginning-search-backward-end</b> and
<b>history-beginning-search-forward-end</b>. These commands
work by first calling the corresponding builtin widget (see
&lsquo;History Control&rsquo; in <i>zshzle</i>(1)) and then
moving the cursor to the end of the line. The original
cursor position is remembered and restored before calling
the builtin widget a second time, so that the same search is
repeated to look farther through the history.</p>

<p style="margin-left:18%; margin-top: 1em">Although you
<b>autoload</b> only one function, the commands to use it
are slightly different because it implements two
widgets.</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
history-beginning-search-backward-end \ <br>
history-search-end <br>
zle -N history-beginning-search-forward-end \ <br>
history-search-end <br>
bindkey &rsquo;\e&#710;P&rsquo;
history-beginning-search-backward-end <br>
bindkey &rsquo;\e&#710;N&rsquo;
history-beginning-search-forward-end</b></p>


<p style="margin-left:9%;"><b>history-beginning-search-menu</b></p>

<p style="margin-left:18%;">This function implements yet
another form of history searching. The text before the
cursor is used to select lines from the history, as for
<b>history-beginning-search-backward</b> except that all
matches are shown in a numbered menu. Typing the appropriate
digits inserts the full history line. Note that leading
zeroes must be typed (they are only shown when necessary for
removing ambiguity). The entire history is searched; there
is no distinction between forwards and backwards.</p>

<p style="margin-left:18%; margin-top: 1em">With a numeric
argument, the search is not anchored to the start of the
line; the string typed by the use may appear anywhere in the
line in the history.</p>

<p style="margin-left:18%; margin-top: 1em">If the widget
name contains &lsquo;<b>-end</b>&rsquo; the cursor is moved
to the end of the line inserted. If the widget name contains
&lsquo;<b>-space</b>&rsquo; any space in the text typed is
treated as a wildcard and can match anything (hence a
leading space is equivalent to giving a numeric argument).
Both forms can be combined, for example:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
history-beginning-search-menu-space-end \ <br>
history-beginning-search-menu</b></p>


<p style="margin-left:9%;"><b>history-pattern-search</b></p>

<p style="margin-left:18%;">The function
<b>history-pattern-search</b> implements widgets which
prompt for a pattern with which to search the history
backwards or forwards. The pattern is in the usual zsh
format, however the first character may be <b>&#710;</b> to
anchor the search to the start of the line, and the last
character may be <b>$</b> to anchor the search to the end of
the line. If the search was not anchored to the end of the
line the cursor is positioned just after the pattern
found.</p>

<p style="margin-left:18%; margin-top: 1em">The commands to
create bindable widgets are similar to those in the example
immediately above:</p>

<p style="margin-left:27%; margin-top: 1em"><b>autoload -U
history-pattern-search <br>
zle -N history-pattern-search-backward
history-pattern-search <br>
zle -N history-pattern-search-forward
history-pattern-search</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>incarg</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>Typing the keystrokes for this widget with the cursor
placed on or to the left of an integer causes that integer
to be incremented by one. With a numeric argument, the
number is incremented by the amount of the argument
(decremented if the numeric argument is negative). The shell
parameter <b>incarg</b> may be set to change the default
increment to something other than one.</p></td></tr>
</table>

<p style="margin-left:27%; margin-top: 1em"><b>bindkey
&rsquo;&#710;X+&rsquo; incarg</b></p>


<p style="margin-left:9%;"><b>incremental-complete-word</b></p>

<p style="margin-left:18%;">This allows incremental
completion of a word. After starting this command, a list of
completion choices can be shown after every character you
type, which you can delete with <b>&#710;H</b> or
<b>DEL</b>. Pressing return accepts the completion so far
and returns you to normal editing (that is, the command line
is <i>not</i> immediately executed). You can hit <b>TAB</b>
to do normal completion, <b>&#710;G</b> to abort back to the
state when you started, and <b>&#710;D</b> to list the
matches.</p>

<p style="margin-left:18%; margin-top: 1em">This works only
with the new function based completion system.</p>

<p style="margin-left:27%; margin-top: 1em"><b>bindkey
&rsquo;&#710;Xi&rsquo; incremental-complete-word</b></p>

<p style="margin-left:9%;"><b>insert-composed-char</b></p>

<p style="margin-left:18%;">This function allows you to
compose characters that don&rsquo;t appear on the keyboard
to be inserted into the command line. The command is
followed by two keys corresponding to ASCII characters
(there is no prompt). For accented characters, the two keys
are a base character followed by a code for the accent,
while for other special characters the two characters
together form a mnemonic for the character to be inserted.
The two-character codes are a subset of those given by RFC
1345 (see for example
<b>http://www.faqs.org/rfcs/rfc1345.html</b>).</p>

<p style="margin-left:18%; margin-top: 1em">The function
may optionally be followed by up to two characters which
replace one or both of the characters read from the
keyboard; if both characters are supplied, no input is read.
For example, <b>insert-composed-char a:</b> can be used
within a widget to insert an a with umlaut into the command
line. This has the advantages over use of a literal
character that it is more portable.</p>

<p style="margin-left:18%; margin-top: 1em">For best
results zsh should have been built with support for
multibyte characters (configured with
<b>--enable-multibyte</b>); however, the function works for
the limited range of characters available in single-byte
character sets such as ISO-8859-1.</p>

<p style="margin-left:18%; margin-top: 1em">The character
is converted into the local representation and inserted into
the command line at the cursor position. (The conversion is
done within the shell, using whatever facilities the C
library provides.) With a numeric argument, the character
and its code are previewed in the status line</p>

<p style="margin-left:18%; margin-top: 1em">The function
may be run outside zle in which case it prints the character
(together with a newline) to standard output. Input is still
read from keystrokes.</p>

<p style="margin-left:18%; margin-top: 1em">See
<b>insert-unicode-char</b> for an alternative way of
inserting Unicode characters using their hexadecimal
character number.</p>

<p style="margin-left:18%; margin-top: 1em">The set of
accented characters is reasonably complete up to Unicode
character U+0180, the set of special characters less so.
However, it is very sporadic from that point. Adding new
characters is easy, however; see the function
<b>define-composed-chars</b>. Please send any additions to
<b>zsh-workers@zsh.org</b>.</p>

<p style="margin-left:18%; margin-top: 1em">The codes for
the second character when used to accent the first are as
follows. Note that not every character can take every
accent.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>!</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Grave.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>&rsquo;</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Acute.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>&gt;</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Circumflex.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>?</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Tilde. (This is not <b>&#732;</b> as RFC 1345 does not
assume that character is present on the keyboard.)</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>-</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Macron. (A horizontal bar over the base character.)</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>(</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Breve. (A shallow dish shape over the base
character.)</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>.</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Dot above the base character, or in the case of <b>i</b>
no dot, or in the case of <b>L</b> and <b>l</b> a centered
dot.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>:</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Diaeresis (Umlaut).</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>c</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Cedilla.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>_</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Underline, however there are currently no underlined
characters.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>/</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Stroke through the base character.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>&quot;</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Double acute (only supported on a few letters).</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>;</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Ogonek. (A little forward facing hook at the bottom
right of the character.)</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>&lt;</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Caron. (A little v over the letter.)</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>0</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Circle over the base character.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>2</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Hook over the base character.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="1%">


<p><b>9</b></p></td>
<td width="8%"></td>
<td width="73%">


<p>Horn over the base character.</p></td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">The most common
characters from the Arabic, Cyrillic, Greek and Hebrew
alphabets are available; consult RFC 1345 for the
appropriate sequences. In addition, a set of two letter
codes not in RFC 1345 are available for the double-width
characters corresponding to ASCII characters from <b>!</b>
to <b>&#732;</b> (0x21 to 0x7e) by preceding the character
with <b>&#710;</b>, for example <b>&#710;A</b> for a
double-width <b>A</b>.</p>

<p style="margin-left:18%; margin-top: 1em">The following
other two-character sequences are understood. <br>
ASCII characters</p>

<p style="margin-left:27%;">These are already present on
most keyboards:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&lt;(</b></p></td>
<td width="6%"></td>
<td width="35%">


<p>Left square bracket</p></td>
<td width="38%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>//</b></p></td>
<td width="6%"></td>
<td width="35%">


<p>Backslash (solidus)</p></td>
<td width="38%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>)&gt;</b></p></td>
<td width="6%"></td>
<td width="35%">


<p>Right square bracket</p></td>
<td width="38%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>(!</b></p></td>
<td width="6%"></td>
<td width="35%">


<p>Left brace (curly bracket)</p></td>
<td width="38%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>!!</b></p></td>
<td width="6%"></td>
<td width="35%">


<p>Vertical bar (pipe symbol)</p></td>
<td width="38%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>!)</b></p></td>
<td width="6%"></td>
<td width="35%">


<p>Right brace (curly bracket)</p></td>
<td width="38%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;?</b></p></td>
<td width="6%"></td>
<td width="35%">


<p>Tilde</p></td>
<td width="38%">
</td></tr>
</table>

<p style="margin-left:18%;">Special letters</p>

<p style="margin-left:27%;">Characters found in various
variants of the Latin alphabet:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>ss</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>Eszett (scharfes S)</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>D-</b>, <b>d-</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>Eth</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>TH</b>, <b>th</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>Thorn</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>kk</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>Kra</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>&rsquo;n</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>&rsquo;n</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>NG</b>, <b>ng</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>Ng</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>OI</b>, <b>oi</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>Oi</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>yr</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>yr</p></td>
<td width="49%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>ED</b></p></td>
<td width="1%"></td>
<td width="24%">


<p>ezh</p></td>
<td width="49%">
</td></tr>
</table>

<p style="margin-left:18%;">Currency symbols</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>Ct</b></p></td>
<td width="6%"></td>
<td width="47%">


<p>Cent</p></td>
<td width="26%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>Pd</b></p></td>
<td width="6%"></td>
<td width="47%">


<p>Pound sterling (also lira and others)</p></td>
<td width="26%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>Cu</b></p></td>
<td width="6%"></td>
<td width="47%">


<p>Currency</p></td>
<td width="26%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>Ye</b></p></td>
<td width="6%"></td>
<td width="47%">


<p>Yen</p></td>
<td width="26%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>Eu</b></p></td>
<td width="6%"></td>
<td width="47%">


<p>Euro (N.B. not in RFC 1345)</p></td>
<td width="26%">
</td></tr>
</table>

<p style="margin-left:18%;">Punctuation characters</p>

<p style="margin-left:27%;">References to &quot;right&quot;
quotes indicate the shape (like a 9 rather than 6) rather
than their grammatical use. (For example, a
&quot;right&quot; low double quote is used to open
quotations in German.)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>!I</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Inverted exclamation mark</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>BB</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Broken vertical bar</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>SE</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Section</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>Co</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Copyright</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-a</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Spanish feminine ordinal indicator</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&lt;&lt;</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Left guillemet</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>--</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Soft hyphen</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>Rg</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Registered trade mark</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>PI</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Pilcrow (paragraph)</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-o</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Spanish masculine ordinal indicator</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&gt;&gt;</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Right guillemet</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>?I</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Inverted question mark</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-1</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Hyphen</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-N</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>En dash</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-M</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Em dash</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-3</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Horizontal bar</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>:3</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Vertical ellipsis</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>.3</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Horizontal midline ellipsis</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>!2</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Double vertical line</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>=2</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Double low line</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;6</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Left single quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;9</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Right single quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>.9</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>&quot;Right&quot; low quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>9&rsquo;</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Reversed &quot;right&quot; quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&quot;6</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Left double quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&quot;9</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Right double quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>:9</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>&quot;Right&quot; low double quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>9&quot;</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Reversed &quot;right&quot; double quote</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>/-</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Dagger</p></td>
<td width="28%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>/=</b></p></td>
<td width="6%"></td>
<td width="45%">


<p>Double dagger</p></td>
<td width="28%">
</td></tr>
</table>

<p style="margin-left:18%;">Mathematical symbols</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>DG</b></p></td>
<td width="6%"></td>
<td width="8%">


<p>Degree</p></td>
<td width="65%">
</td></tr>
</table>

<p style="margin-left:18%;"><b>-2</b>, <b>+-</b>,
<b>-+</b></p>

<p style="margin-left:27%;">- sign, +/- sign, -/+ sign</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>2S</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Superscript 2</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>3S</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Superscript 3</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>1S</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Superscript 1</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>My</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Micro</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>.M</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Middle dot</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>14</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Quarter</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>12</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Half</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>34</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Three quarters</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>*X</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Multiplication</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-:</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Division</p></td>
<td width="55%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>%0</b></p></td>
<td width="6%"></td>
<td width="18%">


<p>Per mille</p></td>
<td width="55%">
</td></tr>
</table>

<p style="margin-left:18%;"><b>FA</b>, <b>TE</b>,
<b>/0</b></p>

<p style="margin-left:27%;">For all, there exists, empty
set</p>

<p style="margin-left:18%;"><b>dP</b>, <b>DE</b>,
<b>NB</b></p>

<p style="margin-left:27%;">Partial derivative, delta
(increment), del (nabla)</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>(-</b>, <b>-)</b></p></td>
<td width="1%"></td>
<td width="26%">


<p>Element of, contains</p></td>
<td width="47%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>*P</b>, <b>+Z</b></p></td>
<td width="1%"></td>
<td width="26%">


<p>Product, sum</p></td>
<td width="47%">
</td></tr>
</table>

<p style="margin-left:18%;"><b>*-</b>, <b>Ob</b>,
<b>Sb</b></p>

<p style="margin-left:27%;">Asterisk, ring, bullet</p>

<p style="margin-left:18%;"><b>RT</b>, <b>0(</b>,
<b>00</b></p>

<p style="margin-left:27%;">Root sign, proportional to,
infinity</p>

<p style="margin-left:18%;">Other symbols <b><br>
cS</b>, <b>cH</b>, <b>cD</b>, <b>cC</b></p>

<p style="margin-left:27%;">Card suits: spades, hearts,
diamonds, clubs</p>

<p style="margin-left:18%;"><b>Md</b>, <b>M8</b>,
<b>M2</b>, <b>Mb</b>, <b>Mx</b>, <b>MX</b></p>

<p style="margin-left:27%;">Musical notation: crotchet
(quarter note), quaver (eighth note), semiquavers (sixteenth
notes), flag sign, natural sign, sharp sign</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>Fm</b>, <b>Ml</b></p></td>
<td width="1%"></td>
<td width="15%">


<p>Female, male</p></td>
<td width="58%">
</td></tr>
</table>

<p style="margin-left:18%;">Accents on their own</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;&gt;</b></p></td>
<td width="6%"></td>
<td width="37%">


<p>Circumflex (same as caret, <b>&#710;</b>)</p></td>
<td width="36%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;!</b></p></td>
<td width="6%"></td>
<td width="37%">


<p>Grave (same as backtick, <b>&lsquo;</b>)</p></td>
<td width="36%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;,</b></p></td>
<td width="6%"></td>
<td width="37%">


<p>Cedilla</p></td>
<td width="36%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;:</b></p></td>
<td width="6%"></td>
<td width="37%">


<p>Diaeresis (Umlaut)</p></td>
<td width="36%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;m</b></p></td>
<td width="6%"></td>
<td width="37%">


<p>Macron</p></td>
<td width="36%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>&rsquo;&rsquo;</b></p></td>
<td width="6%"></td>
<td width="37%">


<p>Acute</p></td>
<td width="36%">
</td></tr>
</table>

<p style="margin-left:9%;"><b>insert-files</b></p>

<p style="margin-left:18%;">This function allows you type a
file pattern, and see the results of the expansion at each
step. When you hit return, all expansions are inserted into
the command line.</p>

<p style="margin-left:27%; margin-top: 1em"><b>bindkey
&rsquo;&#710;Xf&rsquo; insert-files</b></p>

<p style="margin-left:9%;"><b>insert-unicode-char</b></p>

<p style="margin-left:18%;">When first executed, the user
inputs a set of hexadecimal digits. This is terminated with
another call to <b>insert-unicode-char</b>. The digits are
then turned into the corresponding Unicode character. For
example, if the widget is bound to <b>&#710;XU</b>, the
character sequence &lsquo;<b>&#710;XU 4 c
&#710;XU</b>&rsquo; inserts <b>L</b> (Unicode U+004c).</p>

<p style="margin-left:18%; margin-top: 1em">See
<b>insert-composed-char</b> for a way of inserting
characters using a two-character mnemonic.</p>

<p style="margin-left:9%;"><b>narrow-to-region</b> [
<b>-p</b> <i>pre</i> ] [ <b>-P</b> <i>post</i> ] <br>
[ <b>-S</b> <i>statepm</i> | <b>-R</b> <i>statepm</i> | [
<b>-l</b> <i>lbufvar</i> ] [ <b>-r</b> <i><br>
rbufvar</i> ] ] <br>
[ <b>-n</b> ] [ <i>start end</i> ] <b><br>
narrow-to-region-invisible</b></p>

<p style="margin-left:18%;">Narrow the editable portion of
the buffer to the region between the cursor and the mark,
which may be in either order. The region may not be
empty.</p>


<p style="margin-left:18%; margin-top: 1em"><b>narrow-to-region</b>
may be used as a widget or called as a function from a
user-defined widget; by default, the text outside the
editable area remains visible. A <b>recursive-edit</b> is
performed and the original widening status is then restored.
Various options and arguments are available when it is
called as a function.</p>

<p style="margin-left:18%; margin-top: 1em">The options
<b>-p</b> <i>pretext</i> and <b>-P</b> <i>posttext</i> may
be used to replace the text before and after the display for
the duration of the function; either or both may be an empty
string.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
<b>-n</b> is also given, <i>pretext</i> or <i>posttext</i>
will only be inserted if there is text before or after the
region respectively which will be made invisible.</p>

<p style="margin-left:18%; margin-top: 1em">Two numeric
arguments may be given which will be used instead of the
cursor and mark positions.</p>

<p style="margin-left:18%; margin-top: 1em">The option
<b>-S</b> <i>statepm</i> is used to narrow according to the
other options while saving the original state in the
parameter with name <i>statepm</i>, while the option
<b>-R</b> <i>statepm</i> is used to restore the state from
the parameter; note in both cases the <i>name</i> of the
parameter is required. In the second case, other options and
arguments are irrelevant. When this method is used, no
<b>recursive-edit</b> is performed; the calling widget
should call this function with the option <b>-S</b>, perform
its own editing on the command line or pass control to the
user via &lsquo;<b>zle recursive-edit</b>&rsquo;, then call
this function with the option <b>-R</b>. The argument
<i>statepm</i> must be a suitable name for an ordinary
parameter, except that parameters beginning with the prefix
<b>_ntr_</b> are reserved for use within
<b>narrow-to-region</b>. Typically the parameter will be
local to the calling function.</p>

<p style="margin-left:18%; margin-top: 1em">The options
<b>-l</b> <i>lbufvar</i> and <b>-r</b> <i>rbufvar</i> may be
used to specify parameters where the widget will store the
resulting text from the operation. The parameter
<i>lbufvar</i> will contain <b>LBUFFER</b> and
<i>rbufvar</i> will contain <b>RBUFFER</b>. Neither of these
two options may be used with <b>-S</b> or <b>-R</b>.</p>


<p style="margin-left:18%; margin-top: 1em"><b>narrow-to-region-invisible</b>
is a simple widget which calls <b>narrow-to-region</b> with
arguments which replace any text outside the region with
&lsquo;<b>...</b>&rsquo;. It does not take any
arguments.</p>

<p style="margin-left:18%; margin-top: 1em">The display is
restored (and the widget returns) upon any zle command which
would usually cause the line to be accepted or aborted.
Hence an additional such command is required to accept or
abort the current line.</p>

<p style="margin-left:18%; margin-top: 1em">The return
status of both widgets is zero if the line was accepted,
else non-zero.</p>

<p style="margin-left:18%; margin-top: 1em">Here is a
trivial example of a widget using this feature.</p>

<p style="margin-left:27%;"><b>local state <br>
narrow-to-region -p $&rsquo;Editing restricted
region\n&rsquo; \ <br>
-P &rsquo;&rsquo; -S state <br>
zle recursive-edit <br>
narrow-to-region -R state</b></p>

<p style="margin-left:9%;"><b>predict-on</b></p>

<p style="margin-left:18%;">This set of functions
implements predictive typing using history search. After
<b>predict-on</b>, typing characters causes the editor to
look backward in the history for the first line beginning
with what you have typed so far. After <b>predict-off</b>,
editing returns to normal for the line found. In fact, you
often don&rsquo;t even need to use <b>predict-off</b>,
because if the line doesn&rsquo;t match something in the
history, adding a key performs standard completion, and then
inserts itself if no completions were found. However,
editing in the middle of a line is liable to confuse
prediction; see the <b>toggle</b> style below.</p>

<p style="margin-left:18%; margin-top: 1em">With the
function based completion system (which is needed for this),
you should be able to type <b>TAB</b> at almost any point to
advance the cursor to the next
&lsquo;&lsquo;interesting&rsquo;&rsquo; character position
(usually the end of the current word, but sometimes
somewhere in the middle of the word). And of course as soon
as the entire line is what you want, you can accept with
return, without needing to move the cursor to the end
first.</p>

<p style="margin-left:18%; margin-top: 1em">The first time
<b>predict-on</b> is used, it creates several additional
widget functions: <b><br>
delete-backward-and-predict</b></p>

<p style="margin-left:27%;">Replaces the
<b>backward-delete-char</b> widget. You do not need to bind
this yourself.</p>

<p style="margin-left:18%;"><b>insert-and-predict</b></p>

<p style="margin-left:27%;">Implements predictive typing by
replacing the <b>self-insert</b> widget. You do not need to
bind this yourself.</p>

<p style="margin-left:18%;"><b>predict-off</b></p>

<p style="margin-left:27%;">Turns off predictive
typing.</p>

<p style="margin-left:18%; margin-top: 1em">Although you
<b>autoload</b> only the <b>predict-on</b> function, it is
necessary to create a keybinding for <b>predict-off</b> as
well.</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
predict-on <br>
zle -N predict-off <br>
bindkey &rsquo;&#710;X&#710;Z&rsquo; predict-on <br>
bindkey &rsquo;&#710;Z&rsquo; predict-off</b></p>

<p style="margin-left:9%;"><b>read-from-minibuffer</b></p>

<p style="margin-left:18%;">This is most useful when called
as a function from inside a widget, but will work correctly
as a widget in its own right. It prompts for a value below
the current command line; a value may be input using all of
the standard zle operations (and not merely the restricted
set available when executing, for example,
<b>execute-named-cmd</b>). The value is then returned to the
calling function in the parameter <b>$REPLY</b> and the
editing buffer restored to its previous state. If the read
was aborted by a keyboard break (typically <b>&#710;G</b>),
the function returns status 1 and <b>$REPLY</b> is not
set.</p>

<p style="margin-left:18%; margin-top: 1em">If one argument
is supplied to the function it is taken as a prompt,
otherwise &lsquo;<b>?</b> &rsquo; is used. If two arguments
are supplied, they are the prompt and the initial value of
<b>$LBUFFER</b>, and if a third argument is given it is the
initial value of <b>$RBUFFER</b>. This provides a default
value and starting cursor placement. Upon return the entire
buffer is the value of <b>$REPLY</b>.</p>

<p style="margin-left:18%; margin-top: 1em">One option is
available: &lsquo;<b>-k</b> <i>num</i>&rsquo; specifies that
<i>num</i> characters are to be read instead of a whole
line. The line editor is not invoked recursively in this
case, so depending on the terminal settings the input may
not be visible, and only the input keys are placed in
<b>$REPLY</b>, not the entire buffer. Note that unlike the
<b>read</b> builtin <i>num</i> must be given; there is no
default.</p>

<p style="margin-left:18%; margin-top: 1em">The name is a
slight misnomer, as in fact the shell&rsquo;s own minibuffer
is not used. Hence it is still possible to call
<b>executed-named-cmd</b> and similar functions while
reading a value.</p>

<p style="margin-left:9%;"><b>replace-argument</b>,
<b>replace-argument-edit</b></p>

<p style="margin-left:18%;">The function
<b>replace-argument</b> can be used to replace a command
line argument in the current command line or, if the current
command line is empty, in the last command line executed
(the new command line is not executed). Arguments are as
delimited by standard shell syntax,</p>

<p style="margin-left:18%; margin-top: 1em">If a numeric
argument is given, that specifies the argument to be
replaced. 0 means the command name, as in history expansion.
A negative numeric argument counts backward from the last
word.</p>

<p style="margin-left:18%; margin-top: 1em">If no numeric
argument is given, the current argument is replaced; this is
the last argument if the previous history line is being
used.</p>

<p style="margin-left:18%; margin-top: 1em">The function
prompts for a replacement argument.</p>

<p style="margin-left:18%; margin-top: 1em">If the widget
contains the string <b>edit</b>, for example is defined
as</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
replace-argument-edit replace-argument</b></p>

<p style="margin-left:18%; margin-top: 1em">then the
function presents the current value of the argument for
editing, otherwise the editing buffer for the replacement is
initially empty.</p>

<p style="margin-left:9%;"><b>replace-string</b>,
<b>replace-pattern <br>
replace-string-again</b>, <b>replace-pattern-again</b></p>

<p style="margin-left:18%;">The function
<b>replace-string</b> implements three widgets. If defined
under the same name as the function, it prompts for two
strings; the first (source) string will be replaced by the
second everywhere it occurs in the line editing buffer.</p>

<p style="margin-left:18%; margin-top: 1em">If the widget
name contains the word &lsquo;<b>pattern</b>&rsquo;, for
example by defining the widget using the command
&lsquo;<b>zle -N replace-pattern replace-string</b>&rsquo;,
then the matching is performed using zsh patterns. All zsh
extended globbing patterns can be used in the source string;
note that unlike filename generation the pattern does not
need to match an entire word, nor do glob qualifiers have
any effect. In addition, the replacement string can contain
parameter or command substitutions. Furthermore, a
&lsquo;<b>&amp;</b>&rsquo; in the replacement string will be
replaced with the matched source string, and a backquoted
digit &lsquo;<b>\</b><i>N</i>&rsquo; will be replaced by the
<i>N</i>th parenthesised expression matched. The form
&lsquo;<b>\{</b><i>N</i><b>}</b>&rsquo; may be used to
protect the digit from following digits.</p>

<p style="margin-left:18%; margin-top: 1em">If the widget
instead contains the word &lsquo;<b>regex</b>&rsquo; (or
&lsquo;<b>regexp</b>&rsquo;), then the matching is performed
using regular expressions, respecting the setting of the
option <b>RE_MATCH_PCRE</b> (see the description of the
function <b>regexp-replace</b> below). The special
replacement facilities described above for pattern matching
are available.</p>

<p style="margin-left:18%; margin-top: 1em">By default the
previous source or replacement string will not be offered
for editing. However, this feature can be activated by
setting the style <b>edit-previous</b> in the context
<b>:zle:</b><i>widget</i> (for example,
<b>:zle:replace-string</b>) to <b>true</b>. In addition, a
positive numeric argument forces the previous values to be
offered, a negative or zero argument forces them not to
be.</p>

<p style="margin-left:18%; margin-top: 1em">The function
<b>replace-string-again</b> can be used to repeat the
previous replacement; no prompting is done. As with
<b>replace-string</b>, if the name of the widget contains
the word &lsquo;<b>pattern</b>&rsquo; or
&lsquo;<b>regex</b>&rsquo;, pattern or regular expression
matching is performed, else a literal string replacement.
Note that the previous source and replacement text are the
same whether pattern, regular expression or string matching
is used.</p>

<p style="margin-left:18%; margin-top: 1em">In addition,
<b>replace-string</b> shows the previous replacement above
the prompt, so long as there was one during the current
session; if the source string is empty, that replacement
will be repeated without the widget prompting for a
replacement string.</p>

<p style="margin-left:18%; margin-top: 1em">For example,
starting from the line:</p>

<p style="margin-left:27%; margin-top: 1em"><b>print This
line contains fan and fond</b></p>

<p style="margin-left:18%; margin-top: 1em">and invoking
<b>replace-pattern</b> with the source string
&lsquo;<b>f(?)n</b>&rsquo; and the replacement string
&lsquo;<b>c\1r</b>&rsquo; produces the not very useful
line:</p>

<p style="margin-left:27%; margin-top: 1em"><b>print This
line contains car and cord</b></p>

<p style="margin-left:18%; margin-top: 1em">The range of
the replacement string can be limited by using the
<b>narrow-to-region-invisible</b> widget. One limitation of
the current version is that <b>undo</b> will cycle through
changes to the replacement and source strings before undoing
the replacement itself.</p>

<p style="margin-left:9%;"><b>send-invisible</b></p>

<p style="margin-left:18%;">This is similar to
read-from-minibuffer in that it may be called as a function
from a widget or as a widget of its own, and interactively
reads input from the keyboard. However, the input being
typed is concealed and a string of asterisks
(&lsquo;<b>*</b>&rsquo;) is shown instead. The value is
saved in the parameter <b>$INVISIBLE</b> to which a
reference is inserted into the editing buffer at the
restored cursor position. If the read was aborted by a
keyboard break (typically <b>&#710;G</b>) or another escape
from editing such as <b>push-line</b>, <b>$INVISIBLE</b> is
set to empty and the original buffer is restored
unchanged.</p>

<p style="margin-left:18%; margin-top: 1em">If one argument
is supplied to the function it is taken as a prompt,
otherwise &lsquo;<b>Non-echoed text:</b> &rsquo; is used (as
in emacs). If a second and third argument are supplied they
are used to begin and end the reference to <b>$INVISIBLE</b>
that is inserted into the buffer. The default is to open
with <b>${</b>, then <b>INVISIBLE</b>, and close with
<b>}</b>, but many other effects are possible.</p>


<p style="margin-left:9%;"><b>smart-insert-last-word</b></p>

<p style="margin-left:18%;">This function may replace the
<b>insert-last-word</b> widget, like so:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
insert-last-word smart-insert-last-word</b></p>

<p style="margin-left:18%; margin-top: 1em">With a numeric
argument, or when passed command line arguments in a call
from another widget, it behaves like
<b>insert-last-word</b>, except that words in comments are
ignored when <b>INTERACTIVE_COMMENTS</b> is set.</p>

<p style="margin-left:18%; margin-top: 1em">Otherwise, the
rightmost &lsquo;&lsquo;interesting&rsquo;&rsquo; word from
the previous command is found and inserted. The default
definition of &lsquo;&lsquo;interesting&rsquo;&rsquo; is
that the word contains at least one alphabetic character,
slash, or backslash. This definition may be overridden by
use of the <b>match</b> style. The context used to look up
the style is the widget name, so usually the context is
<b>:insert-last-word</b>. However, you can bind this
function to different widgets to use different patterns:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zle -N
insert-last-assignment smart-insert-last-word <br>
zstyle :insert-last-assignment match
&rsquo;[[:alpha:]][][[:alnum:]]#=*&rsquo; <br>
bindkey &rsquo;\e=&rsquo; insert-last-assignment</b></p>

<p style="margin-left:18%; margin-top: 1em">If no
interesting word is found and the <b>auto-previous</b> style
is set to a true value, the search continues upward through
the history. When <b>auto-previous</b> is unset or false
(the default), the widget must be invoked repeatedly in
order to search earlier history lines.</p>

<p style="margin-left:9%;"><b>transpose-lines</b></p>

<p style="margin-left:18%;">Only useful with a multi-line
editing buffer; the lines here are lines within the current
on-screen buffer, not history lines. The effect is similar
to the function of the same name in Emacs.</p>

<p style="margin-left:18%; margin-top: 1em">Transpose the
current line with the previous line and move the cursor to
the start of the next line. Repeating this (which can be
done by providing a positive numeric argument) has the
effect of moving the line above the cursor down by a number
of lines.</p>

<p style="margin-left:18%; margin-top: 1em">With a negative
numeric argument, requires two lines above the cursor. These
two lines are transposed and the cursor moved to the start
of the previous line. Using a numeric argument less than -1
has the effect of moving the line above the cursor up by
minus that number of lines.</p>

<p style="margin-left:9%;"><b>url-quote-magic</b></p>

<p style="margin-left:18%;">This widget replaces the
built-in <b>self-insert</b> to make it easier to type URLs
as command line arguments. As you type, the input character
is analyzed and, if it may need quoting, the current word is
checked for a URI scheme. If one is found and the current
word is not already in quotes, a backslash is inserted
before the input character.</p>

<p style="margin-left:18%; margin-top: 1em">Styles to
control quoting behavior: <b><br>
url-metas</b></p>

<p style="margin-left:27%;">This style is looked up in the
context &lsquo;<b>:url-quote-magic:</b><i>scheme</i>&rsquo;
(where <i>scheme</i> is that of the current URL, e.g.
&quot;<b>ftp</b>&quot;). The value is a string listing the
characters to be treated as globbing metacharacters when
appearing in a URL using that scheme. The default is to
quote all zsh extended globbing characters, excluding
&rsquo;<b>&lt;</b>&rsquo; and &rsquo;<b>&gt;</b>&rsquo; but
including braces (as in brace expansion). See also
<b>url-seps</b>.</p>

<p style="margin-left:18%;"><b>url-seps</b></p>

<p style="margin-left:27%;">Like <b>url-metas</b>, but
lists characters that should be considered command
separators, redirections, history references, etc. The
default is to quote the standard set of shell separators,
excluding those that overlap with the extended globbing
characters, but including &rsquo;<b>&lt;</b>&rsquo; and
&rsquo;<b>&gt;</b>&rsquo; and the first character of
<b>$histchars</b>.</p>

<p style="margin-left:18%;"><b>url-globbers</b></p>

<p style="margin-left:27%;">This style is looked up in the
context &lsquo;<b>:url-quote-magic</b>&rsquo;. The values
form a list of command names that are expected to do their
own globbing on the URL string. This implies that they are
aliased to use the &lsquo;<b>noglob</b>&rsquo; modifier.
When the first word on the line matches one of the values
<i>and</i> the URL refers to a local file (see
<b>url-local-schema</b>), only the <b>url-seps</b>
characters are quoted; the <b>url-metas</b> are left alone,
allowing them to affect command-line parsing, completion,
etc. The default values are a literal
&lsquo;<b>noglob</b>&rsquo; plus (when the
<b>zsh/parameter</b> module is available) any commands
aliased to the helper function
&lsquo;<b>urlglobber</b>&rsquo; or its alias
&lsquo;<b>globurl</b>&rsquo;.</p>

<p style="margin-left:18%;"><b>url-local-schema</b></p>

<p style="margin-left:27%;">This style is always looked up
in the context &lsquo;<b>:urlglobber</b>&rsquo;, even though
it is used by both url-quote-magic and urlglobber. The
values form a list of URI schema that should be treated as
referring to local files by their real local path names, as
opposed to files which are specified relative to a
web-server-defined document root. The defaults are
&quot;<b>ftp</b>&quot; and &quot;<b>file</b>&quot;.</p>

<p style="margin-left:18%;"><b>url-other-schema</b></p>

<p style="margin-left:27%;">Like <b>url-local-schema</b>,
but lists all other URI schema upon which <b>urlglobber</b>
and <b>url-quote-magic</b> should act. If the URI on the
command line does not have a scheme appearing either in this
list or in <b>url-local-schema</b>, it is not magically
quoted. The default values are &quot;<b>http</b>&quot;,
&quot;<b>https</b>&quot;, and &quot;<b>ftp</b>&quot;. When a
scheme appears both here and in <b>url-local-schema</b>, it
is quoted differently depending on whether the command name
appears in <b>url-globbers</b>.</p>

<p style="margin-left:18%; margin-top: 1em">Loading
<b>url-quote-magic</b> also defines a helper function
&lsquo;<b>urlglobber</b>&rsquo; and aliases
&lsquo;<b>globurl</b>&rsquo; to &lsquo;<b>noglob
urlglobber</b>&rsquo;. This function takes a local URL
apart, attempts to pattern-match the local file portion of
the URL path, and then puts the results back into URL format
again.</p>

<p style="margin-left:9%;"><b>vi-pipe</b></p>

<p style="margin-left:18%;">This function reads a movement
command from the keyboard and then prompts for an external
command. The part of the buffer covered by the movement is
piped to the external command and then replaced by the
command&rsquo;s output. If the movement command is bound to
vi-pipe, the current line is used.</p>

<p style="margin-left:18%; margin-top: 1em">The function
serves as an example for reading a vi movement command from
within a user-defined widget.</p>

<p style="margin-left:9%;"><b>which-command</b></p>

<p style="margin-left:18%;">This function is a drop-in
replacement for the builtin widget <b>which-command</b>. It
has enhanced behaviour, in that it correctly detects whether
or not the command word needs to be expanded as an alias; if
so, it continues tracing the command word from the expanded
alias until it reaches the command that will be
executed.</p>

<p style="margin-left:18%; margin-top: 1em">The style
<b>whence</b> is available in the context
<b>:zle:$WIDGET</b>; this may be set to an array to give the
command and options that will be used to investigate the
command word found. The default is <b>whence -c</b>.</p>

<p style="margin-left:9%;"><b>zcalc-auto-insert</b></p>

<p style="margin-left:18%;">This function is useful
together with the <b>zcalc</b> function described in the
section &lsquo;Mathematical Functions&rsquo;. It should be
bound to a key representing a binary operator such as
&lsquo;<b>+</b>&rsquo;, &lsquo;<b>-</b>&rsquo;,
&lsquo;<b>*</b>&rsquo; or &lsquo;<b>/</b>&rsquo;. When
running in zcalc, if the key occurs at the start of the line
or immediately following an open parenthesis, the text
<b>&quot;ans &quot;</b> is inserted before the
representation of the key itself. This allows easy use of
the answer from the previous calculation in the current
line. The text to be inserted before the symbol typed can be
modified by setting the variable
<b>ZCALC_AUTO_INSERT_PREFIX</b>.</p>

<p style="margin-left:18%; margin-top: 1em">Hence, for
example, typing &lsquo;<b>+12</b>&rsquo; followed by return
adds 12 to the previous result.</p>

<p style="margin-left:18%; margin-top: 1em">If zcalc is in
RPN mode (<b>-r</b> option) the effect of this binding is
automatically suppressed as operators alone on a line are
meaningful.</p>

<p style="margin-left:18%; margin-top: 1em">When not in
zcalc, the key simply inserts the symbol itself.</p>

<h3>Utility Functions
<a name="Utility Functions"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">These functions
are useful in constructing widgets. They should be loaded
with &lsquo;<b>autoload -U</b> <i>function</i>&rsquo; and
called as indicated from user-defined widgets. <b><br>
split-shell-arguments</b></p>

<p style="margin-left:18%;">This function splits the line
currently being edited into shell arguments and whitespace.
The result is stored in the array <b>reply</b>. The array
contains all the parts of the line in order, starting with
any whitespace before the first argument, and finishing with
any whitespace after the last argument. Hence (so long as
the option <b>KSH_ARRAYS</b> is not set) whitespace is given
by odd indices in the array and arguments by even indices.
Note that no stripping of quotes is done; joining together
all the elements of <b>reply</b> in order is guaranteed to
produce the original line.</p>

<p style="margin-left:18%; margin-top: 1em">The parameter
<b>REPLY</b> is set to the index of the word in <b>reply</b>
which contains the character after the cursor, where the
first element has index 1. The parameter <b>REPLY2</b> is
set to the index of the character under the cursor in that
word, where the first character has index 1.</p>

<p style="margin-left:18%; margin-top: 1em">Hence
<b>reply</b>, <b>REPLY</b> and <b>REPLY2</b> should all be
made local to the enclosing function.</p>

<p style="margin-left:18%; margin-top: 1em">See the
function <b>modify-current-argument</b>, described below,
for an example of how to call this function.</p>

<p style="margin-left:9%;"><b>modify-current-argument</b> [
<i>expr-using-</i><b>$ARG</b> | <i>func</i> ]</p>

<p style="margin-left:18%;">This function provides a simple
method of allowing user-defined widgets to modify the
command line argument under the cursor (or immediately to
the left of the cursor if the cursor is between
arguments).</p>

<p style="margin-left:18%; margin-top: 1em">The argument
can be an expression which when evaluated operates on the
shell parameter <b>ARG</b>, which will have been set to the
command line argument under the cursor. The expression
should be suitably quoted to prevent it being evaluated too
early.</p>

<p style="margin-left:18%; margin-top: 1em">Alternatively,
if the argument does not contain the string <b>ARG</b>, it
is assumed to be a shell function, to which the current
command line argument is passed as the only argument. The
function should set the variable <b>REPLY</b> to the new
value for the command line argument. If the function returns
non-zero status, so does the calling function.</p>

<p style="margin-left:18%; margin-top: 1em">For example, a
user-defined widget containing the following code converts
the characters in the argument under the cursor into all
upper case:</p>


<p style="margin-left:27%; margin-top: 1em"><b>modify-current-argument
&rsquo;${(U)ARG}&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">The following
strips any quoting from the current word (whether
backslashes or one of the styles of quotes), and replaces it
with single quoting throughout:</p>


<p style="margin-left:27%; margin-top: 1em"><b>modify-current-argument
&rsquo;${(qq)${(Q)ARG}}&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">The following
performs directory expansion on the command line argument
and replaces it by the absolute path:</p>


<p style="margin-left:27%; margin-top: 1em"><b>expand-dir()
{ <br>
REPLY=${&#732;1} <br>
REPLY=${REPLY:a} <br>
} <br>
modify-current-argument expand-dir</b></p>

<p style="margin-left:18%; margin-top: 1em">In practice the
function <b>expand-dir</b> would probably not be defined
within the widget where <b>modify-current-argument</b> is
called.</p>

<h3>Styles
<a name="Styles"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The behavior of
several of the above widgets can be controlled by the use of
the <b>zstyle</b> mechanism. In particular, widgets that
interact with the completion system pass along their context
to any completions that they invoke. <b><br>
break-keys</b></p>

<p style="margin-left:18%;">This style is used by the
<b>incremental-complete-word</b> widget. Its value should be
a pattern, and all keys matching this pattern will cause the
widget to stop incremental completion without the key having
any further effect. Like all styles used directly by
<b>incremental-complete-word</b>, this style is looked up
using the context &lsquo;<b>:incremental</b>&rsquo;.</p>

<p style="margin-left:9%;"><b>completer</b></p>

<p style="margin-left:18%;">The
<b>incremental-complete-word</b> and
<b>insert-and-predict</b> widgets set up their top-level
context name before calling completion. This allows one to
define different sets of completer functions for normal
completion and for these widgets. For example, to use
completion, approximation and correction for normal
completion, completion and correction for incremental
completion and only completion for prediction one could
use:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
&rsquo;:completion:*&rsquo; completer \ <br>
_complete _correct _approximate <br>
zstyle &rsquo;:completion:incremental:*&rsquo; completer \
<br>
_complete _correct <br>
zstyle &rsquo;:completion:predict:*&rsquo; completer \ <br>
_complete</b></p>

<p style="margin-left:18%; margin-top: 1em">It is a good
idea to restrict the completers used in prediction, because
they may be automatically invoked as you type. The
<b>_list</b> and <b>_menu</b> completers should never be
used with prediction. The <b>_approximate</b>,
<b>_correct</b>, <b>_expand</b>, and <b>_match</b>
completers may be used, but be aware that they may change
characters anywhere in the word behind the cursor, so you
need to watch carefully that the result is what you
intended.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>cursor</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>The <b>insert-and-predict</b> widget uses this style, in
the context &lsquo;<b>:predict</b>&rsquo;, to decide where
to place the cursor after completion has been tried. Values
are:</p> </td></tr>
</table>

<p style="margin-left:18%;"><b>complete</b></p>

<p style="margin-left:27%;">The cursor is left where it was
when completion finished, but only if it is after a
character equal to the one just inserted by the user. If it
is after another character, this value is the same as
&lsquo;<b>key</b>&rsquo;.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="4%">


<p><b>key</b></p></td>
<td width="5%"></td>
<td width="73%">


<p>The cursor is left after the <i>n</i>th occurrence of
the character just inserted, where <i>n</i> is the number of
times that character appeared in the word before completion
was attempted. In short, this has the effect of leaving the
cursor after the character just typed even if the completion
code found out that no other characters need to be inserted
at that position.</p></td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">Any other value
for this style unconditionally leaves the cursor at the
position where the completion code left it.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="5%">


<p style="margin-top: 1em"><b>list</b></p></td>
<td width="4%"></td>
<td width="82%">


<p style="margin-top: 1em">When using the
<b>incremental-complete-word</b> widget, this style says if
the matches should be listed on every key press (if they fit
on the screen). Use the context prefix
&lsquo;<b>:completion:incremental</b>&rsquo;.</p> </td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">The
<b>insert-and-predict</b> widget uses this style to decide
if the completion should be shown even if there is only one
possible completion. This is done if the value of this style
is the string <b>always</b>. In this case the context is
&lsquo;<b>:predict</b>&rsquo; (<i>not</i>
&lsquo;<b>:completion:predict</b>&rsquo;).</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="6%">


<p style="margin-top: 1em"><b>match</b></p></td>
<td width="3%"></td>
<td width="82%">


<p style="margin-top: 1em">This style is used by
<b>smart-insert-last-word</b> to provide a pattern (using
full <b>EXTENDED_GLOB</b> syntax) that matches an
interesting word. The context is the name of the widget to
which <b>smart-insert-last-word</b> is bound (see above).
The default behavior of <b>smart-insert-last-word</b> is
equivalent to:</p></td></tr>
</table>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
:insert-last-word match
&rsquo;*[[:alpha:]/\\]*&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">However, you
might want to include words that contain spaces:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
:insert-last-word match
&rsquo;*[[:alpha:][:space:]/\\]*&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">Or include
numbers as long as the word is at least two characters
long:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
:insert-last-word match
&rsquo;*([[:digit:]]?|[[:alpha:]/\\])*&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">The above
example causes redirections like &quot;2&gt;&quot; to be
included.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p style="margin-top: 1em"><b>prompt</b></p></td>
<td width="1%"></td>
<td width="82%">


<p style="margin-top: 1em">The
<b>incremental-complete-word</b> widget shows the value of
this style in the status line during incremental completion.
The string value may contain any of the following substrings
in the manner of the <b>PS1</b> and other prompt
parameters:</p> </td></tr>
</table>

<p style="margin-left:18%;"><b>%c</b></p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%"></td>
<td width="6%"></td>
<td width="73%">


<p style="margin-top: 1em">Replaced by the name of the
completer function that generated the matches (without the
leading underscore).</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>%l</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>When the <b>list</b> style is set, replaced by
&lsquo;<b>...</b>&rsquo; if the list of matches is too long
to fit on the screen and with an empty string otherwise. If
the <b>list</b> style is &lsquo;false&rsquo; or not set,
&lsquo;<b>%l</b>&rsquo; is always removed.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>%n</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Replaced by the number of matches generated.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>%s</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Replaced by &lsquo;<b>-no match-</b>&rsquo;,
&lsquo;<b>-no prefix-</b>&rsquo;, or an empty string if
there is no completion matching the word on the line, if the
matches have no common prefix different from the word on the
line, or if there is such a common prefix, respectively.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>%u</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Replaced by the unambiguous part of all matches, if
there is any, and if it is different from the word on the
line.</p> </td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">Like
&lsquo;<b>break-keys</b>&rsquo;, this uses the
&lsquo;<b>:incremental</b>&rsquo; context.</p>

<p style="margin-left:9%;"><b>stop-keys</b></p>

<p style="margin-left:18%;">This style is used by the
<b>incremental-complete-word</b> widget. Its value is
treated similarly to the one for the <b>break-keys</b> style
(and uses the same context:
&lsquo;<b>:incremental</b>&rsquo;). However, in this case
all keys matching the pattern given as its value will stop
incremental completion and will then execute their usual
function.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>toggle</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>This boolean style is used by <b>predict-on</b> and its
related widgets in the context
&lsquo;<b>:predict</b>&rsquo;. If set to one of the standard
&lsquo;true&rsquo; values, predictive typing is
automatically toggled off in situations where it is unlikely
to be useful, such as when editing a multi-line buffer or
after moving into the middle of a line and then deleting a
character. The default is to leave prediction turned on
until an explicit call to <b>predict-off</b>.</p></td></tr>
</table>

<p style="margin-left:9%;"><b>verbose</b></p>

<p style="margin-left:18%;">This boolean style is used by
<b>predict-on</b> and its related widgets in the context
&lsquo;<b>:predict</b>&rsquo;. If set to one of the standard
&lsquo;true&rsquo; values, these widgets display a message
below the prompt when the predictive state is toggled. This
is most useful in combination with the <b>toggle</b> style.
The default does not display these messages.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>widget</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>This style is similar to the <b>command</b> style: For
widget functions that use <b>zle</b> to call other widgets,
this style can sometimes be used to override the widget
which is called. The context for this style is the name of
the calling widget (<i>not</i> the name of the calling
function, because one function may be bound to multiple
widget names).</p></td></tr>
</table>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
:copy-earlier-word widget smart-insert-last-word</b></p>

<p style="margin-left:18%; margin-top: 1em">Check the
documentation for the calling widget or function to
determine whether the <b>widget</b> style is used.</p>

<h2>EXCEPTION HANDLING
<a name="EXCEPTION HANDLING"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">Two functions
are provided to enable zsh to provide exception handling in
a form that should be familiar from other languages. <b><br>
throw</b> <i>exception</i></p>

<p style="margin-left:18%;">The function <b>throw</b>
throws the named <i>exception</i>. The name is an arbitrary
string and is only used by the <b>throw</b> and <b>catch</b>
functions. An exception is for the most part treated the
same as a shell error, i.e. an unhandled exception will
cause the shell to abort all processing in a function or
script and to return to the top level in an interactive
shell.</p>

<p style="margin-left:9%;"><b>catch</b>
<i>exception-pattern</i></p>

<p style="margin-left:18%;">The function <b>catch</b>
returns status zero if an exception was thrown and the
pattern <i>exception-pattern</i> matches its name. Otherwise
it returns status 1. <i>exception-pattern</i> is a standard
shell pattern, respecting the current setting of the
<b>EXTENDED_GLOB</b> option. An alias <b>catch</b> is also
defined to prevent the argument to the function from
matching filenames, so patterns may be used unquoted. Note
that as exceptions are not fundamentally different from
other shell errors it is possible to catch shell errors by
using an empty string as the exception name. The shell
variable <b>CAUGHT</b> is set by <b>catch</b> to the name of
the exception caught. It is possible to rethrow an exception
by calling the <b>throw</b> function again once an exception
has been caught.</p>

<p style="margin-left:9%; margin-top: 1em">The functions
are designed to be used together with the <b>always</b>
construct described in <i>zshmisc</i>(1). This is important
as only this construct provides the required support for
exceptions. A typical example is as follows.</p>

<p style="margin-left:18%; margin-top: 1em"><b>{ <br>
# &quot;try&quot; block <br>
# ... nested code here calls &quot;throw MyExcept&quot; <br>
} always { <br>
# &quot;always&quot; block <br>
if catch MyExcept; then <br>
print &quot;Caught exception MyExcept&quot; <br>
elif catch &rsquo;&rsquo;; then <br>
print &quot;Caught a shell error. Propagating...&quot; <br>
throw &rsquo;&rsquo; <br>
fi <br>
# Other exceptions are not handled but may be caught further
<br>
# up the call stack. <br>
}</b></p>

<p style="margin-left:9%; margin-top: 1em">If all
exceptions should be caught, the following idiom might be
preferable.</p>

<p style="margin-left:18%; margin-top: 1em"><b>{ <br>
# ... nested code here throws an exception <br>
} always { <br>
if catch *; then <br>
case $CAUGHT in <br>
(MyExcept) <br>
print &quot;Caught my own exception&quot; <br>
;; <br>
(*) <br>
print &quot;Caught some other exception&quot; <br>
;; <br>
esac <br>
fi <br>
}</b></p>

<p style="margin-left:9%; margin-top: 1em">In common with
exception handling in other languages, the exception may be
thrown by code deeply nested inside the &lsquo;try&rsquo;
block. However, note that it must be thrown inside the
current shell, not in a subshell forked for a pipeline,
parenthesised current-shell construct, or some form of
command or process substitution.</p>

<p style="margin-left:9%; margin-top: 1em">The system
internally uses the shell variable <b>EXCEPTION</b> to
record the name of the exception between throwing and
catching. One drawback of this scheme is that if the
exception is not handled the variable <b>EXCEPTION</b>
remains set and may be incorrectly recognised as the name of
an exception if a shell error subsequently occurs. Adding
<b>unset EXCEPTION</b> at the start of the outermost layer
of any code that uses exception handling will eliminate this
problem.</p>

<h2>MIME FUNCTIONS
<a name="MIME FUNCTIONS"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">Three functions
are available to provide handling of files recognised by
extension, for example to dispatch a file <b>text.ps</b>
when executed as a command to an appropriate viewer. <b><br>
zsh-mime-setup</b> [ <b>-fv</b> ] [ <b>-l</b> [
<i>suffix</i> ... ] ] <b><br>
zsh-mime-handler</b> [ <b>-l</b> ] <i>command argument</i>
...</p>

<p style="margin-left:18%;">These two functions use the
files <b>&#732;/.mime.types</b> and <b>/etc/mime.types</b>,
which associate types and extensions, as well as
<b>&#732;/.mailcap</b> and <b>/etc/mailcap</b> files, which
associate types and the programs that handle them. These are
provided on many systems with the Multimedia Internet Mail
Extensions.</p>

<p style="margin-left:18%; margin-top: 1em">To enable the
system, the function <b>zsh-mime-setup</b> should be
autoloaded and run. This allows files with extensions to be
treated as executable; such files be completed by the
function completion system. The function
<b>zsh-mime-handler</b> should not need to be called by the
user.</p>

<p style="margin-left:18%; margin-top: 1em">The system
works by setting up suffix aliases with &lsquo;<b>alias
-s</b>&rsquo;. Suffix aliases already installed by the user
will not be overwritten.</p>

<p style="margin-left:18%; margin-top: 1em">For suffixes
defined in lower case, upper case variants will also
automatically be handled (e.g. <b>PDF</b> is automatically
handled if handling for the suffix <b>pdf</b> is defined),
but not vice versa.</p>

<p style="margin-left:18%; margin-top: 1em">Repeated calls
to <b>zsh-mime-setup</b> do not override the existing
mapping between suffixes and executable files unless the
option <b>-f</b> is given. Note, however, that this does not
override existing suffix aliases assigned to handlers other
than <b>zsh-mime-handler</b>.</p>

<p style="margin-left:18%; margin-top: 1em">Calling
<b>zsh-mime-setup</b> with the option <b>-l</b> lists the
existing mappings without altering them. Suffixes to list
(which may contain pattern characters that should be quoted
from immediate interpretation on the command line) may be
given as additional arguments, otherwise all suffixes are
listed.</p>

<p style="margin-left:18%; margin-top: 1em">Calling
<b>zsh-mime-setup</b> with the option <b>-v</b> causes
verbose output to be shown during the setup operation.</p>

<p style="margin-left:18%; margin-top: 1em">The system
respects the <b>mailcap</b> flags <b>needsterminal</b> and
<b>copiousoutput</b>; see <i>mailcap</i>(4) or
<i>mailcap</i>(5) (the man page&rsquo;s name varies across
platforms).</p>

<p style="margin-left:18%; margin-top: 1em">The functions
use the following styles, which are defined with the
<b>zstyle</b> builtin command (see <i>zshmodules</i>(1)).
They should be defined before <b>zsh-mime-setup</b> is run.
The contexts used all start with <b>:mime:</b>, with
additional components in some cases. It is recommended that
a trailing <b>*</b> (suitably quoted) be appended to style
patterns in case the system is extended in future. Some
examples are given below.</p>

<p style="margin-left:18%; margin-top: 1em">For files that
have multiple suffixes, e.g. <b>.pdf.gz</b>, where the
context includes the suffix it will be looked up starting
with the longest possible suffix until a match for the style
is found. For example, if <b>.pdf.gz</b> produces a match
for the handler, that will be used; otherwise the handler
for <b>.gz</b> will be used. Note that, owing to the way
suffix aliases work, it is always required that there be a
handler for the shortest possible suffix, so in this example
<b>.pdf.gz</b> can only be handled if <b>.gz</b> is also
handled (though not necessarily in the same way).
Alternatively, if no handling for <b>.gz</b> on its own is
needed, simply adding the command</p>

<p style="margin-left:27%; margin-top: 1em"><b>alias -s
gz=zsh-mime-handler</b></p>

<p style="margin-left:18%; margin-top: 1em">to the
initialisation code is sufficient; <b>.gz</b> will not be
handled on its own, but may be in combination with other
suffixes. <b><br>
current-shell</b></p>

<p style="margin-left:27%;">If this boolean style is true,
the mailcap handler for the context in question is run using
the <b>eval</b> builtin instead of by starting a new
<b>sh</b> process. This is more efficient, but may not work
in the occasional cases where the mailcap handler uses
strict POSIX syntax.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>disown</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>If this boolean style is true, mailcap handlers started
in the background will be disowned, i.e. not subject to job
control within the parent shell. Such handlers nearly always
produce their own windows, so the only likely harmful side
effect of setting the style is that it becomes harder to
kill jobs from within the shell.</p></td></tr>
</table>

<p style="margin-left:18%;"><b>execute-as-is</b></p>

<p style="margin-left:27%;">This style gives a list of
patterns to be matched against files passed for execution
with a handler program. If the file matches the pattern, the
entire command line is executed in its current form, with no
handler. This is useful for files which might have suffixes
but nonetheless be executable in their own right. If the
style is not set, the pattern <b>*(*) *(/)</b> is used;
hence executable files are executed directly and not passed
to a handler, and the option <b>AUTO_CD</b> may be used to
change to directories that happen to have MIME suffixes.</p>

<p style="margin-left:18%;"><b>execute-never</b></p>

<p style="margin-left:27%;">This style is useful in
combination with <b>execute-as-is</b>. It is set to an array
of patterns corresponding to full paths to files that should
never be treated as executable, even if the file passed to
the MIME handler matches <b>execute-as-is</b>. This is
useful for file systems that don&rsquo;t handle execute
permission or that contain executables from another
operating system. For example, if <b>/mnt/windows</b> is a
Windows mount, then</p>

<p style="margin-left:36%; margin-top: 1em"><b>zstyle
&rsquo;:mime:*&rsquo; execute-never
&rsquo;/mnt/windows/*&rsquo;</b></p>

<p style="margin-left:27%; margin-top: 1em">will ensure
that any files found in that area will be executed as MIME
types even if they are executable. As this example shows,
the complete file name is matched against the pattern,
regardless of how the file was passed to the handler. The
file is resolved to a full path using the <b>:P</b> modifier
described in the subsection &lsquo;Modifiers&rsquo; in
<i>zshexpn</i>(1); this means that symbolic links are
resolved where possible, so that links into other file
systems behave in the correct fashion.</p>

<p style="margin-left:18%;"><b>file-path</b></p>

<p style="margin-left:27%;">Used if the style
<b>find-file-in-path</b> is true for the same context. Set
to an array of directories that are used for searching for
the file to be handled; the default is the command path
given by the special parameter <b>path</b>. The shell option
<b>PATH_DIRS</b> is respected; if that is set, the
appropriate path will be searched even if the name of the
file to be handled as it appears on the command line
contains a &lsquo;<b>/</b>&rsquo;. The full context is
<b>:mime:.</b><i>suffix</i><b>:</b>, as described for the
style <b>handler</b>.</p>

<p style="margin-left:18%;"><b>find-file-in-path</b></p>

<p style="margin-left:27%;">If set, allows files whose
names do not contain absolute paths to be searched for in
the command path or the path specified by the
<b>file-path</b> style. If the file is not found in the
path, it is looked for locally (whether or not the current
directory is in the path); if it is not found locally, the
handler will abort unless the <b>handle-nonexistent</b>
style is set. Files found in the path are tested as
described for the style <b>execute-as-is</b>. The full
context is <b>:mime:.</b><i>suffix</i><b>:</b>, as described
for the style <b>handler</b>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="6%">


<p><b>flags</b></p></td>
<td width="3%"></td>
<td width="73%">


<p>Defines flags to go with a handler; the context is as
for the <b>handler</b> style, and the format is as for the
flags in <b>mailcap</b>.</p></td></tr>
</table>

<p style="margin-left:18%;"><b>handle-nonexistent</b></p>

<p style="margin-left:27%;">By default, arguments that
don&rsquo;t correspond to files are not passed to the MIME
handler in order to prevent it from intercepting commands
found in the path that happen to have suffixes. This style
may be set to an array of extended glob patterns for
arguments that will be passed to the handler even if they
don&rsquo;t exist. If it is not explicitly set it defaults
to <b>[[:alpha:]]#:/*</b> which allows URLs to be passed to
the MIME handler even though they don&rsquo;t exist in that
format in the file system. The full context is
<b>:mime:.</b><i>suffix</i><b>:</b>, as described for the
style <b>handler</b>.</p>

<p style="margin-left:18%;"><b>handler</b></p>

<p style="margin-left:27%;">Specifies a handler for a
suffix; the suffix is given by the context as
<b>:mime:.</b><i>suffix</i><b>:</b>, and the format of the
handler is exactly that in <b>mailcap</b>. Note in
particular the &lsquo;<b>.</b>&rsquo; and trailing colon to
distinguish this use of the context. This overrides any
handler specified by the <b>mailcap</b> files. If the
handler requires a terminal, the <b>flags</b> style should
be set to include the word <b>needsterminal</b>, or if the
output is to be displayed through a pager (but not if the
handler is itself a pager), it should include
<b>copiousoutput</b>.</p>

<p style="margin-left:18%;"><b>mailcap</b></p>

<p style="margin-left:27%;">A list of files in the format
of <b>&#732;/.mailcap</b> and <b>/etc/mailcap</b> to be read
during setup, replacing the default list which consists of
those two files. The context is <b>:mime:</b>. A <b>+</b> in
the list will be replaced by the default files.</p>

<p style="margin-left:18%;"><b>mailcap-priorities</b></p>

<p style="margin-left:27%;">This style is used to resolve
multiple mailcap entries for the same MIME type. It consists
of an array of the following elements, in descending order
of priority; later entries will be used if earlier entries
are unable to resolve the entries being compared. If none of
the tests resolve the entries, the first entry encountered
is retained.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="27%"></td>
<td width="6%">


<p><b>files</b></p></td>
<td width="3%"></td>
<td width="64%">


<p>The order of files (entries in the <b>mailcap</b> style)
read. Earlier files are preferred. (Note this does not
resolve entries in the same file.)</p></td></tr>
</table>

<p style="margin-left:27%;"><b>priority</b></p>

<p style="margin-left:36%;">The priority flag from the
mailcap entry. The priority is an integer from 0 to 9 with
the default value being 5.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="27%"></td>
<td width="6%">


<p><b>flags</b></p></td>
<td width="3%"></td>
<td width="64%">


<p>The test given by the <b>mailcap-prio-flags</b> option
is used to resolve entries.</p></td></tr>
<tr valign="top" align="left">
<td width="27%"></td>
<td width="6%">


<p><b>place</b></p></td>
<td width="3%"></td>
<td width="64%">


<p>Later entries are preferred; as the entries are strictly
ordered, this test always succeeds.</p></td></tr>
</table>

<p style="margin-left:27%; margin-top: 1em">Note that as
this style is handled during initialisation, the context is
always <b>:mime:</b>, with no discrimination by suffix.</p>

<p style="margin-left:18%;"><b>mailcap-prio-flags</b></p>

<p style="margin-left:27%;">This style is used when the
keyword <b>flags</b> is encountered in the list of tests
specified by the <b>mailcap-priorities</b> style. It should
be set to a list of patterns, each of which is tested
against the flags specified in the mailcap entry (in other
words, the sets of assignments found with some entries in
the mailcap file). Earlier patterns in the list are
preferred to later ones, and matched patterns are preferred
to unmatched ones.</p>

<p style="margin-left:18%;"><b>mime-types</b></p>

<p style="margin-left:27%;">A list of files in the format
of <b>&#732;/.mime.types</b> and <b>/etc/mime.types</b> to
be read during setup, replacing the default list which
consists of those two files. The context is <b>:mime:</b>. A
<b>+</b> in the list will be replaced by the default
files.</p>

<p style="margin-left:18%;"><b>never-background</b></p>

<p style="margin-left:27%;">If this boolean style is set,
the handler for the given context is always run in the
foreground, even if the flags provided in the mailcap entry
suggest it need not be (for example, it doesn&rsquo;t
require a terminal).</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="6%">


<p><b>pager</b></p></td>
<td width="3%"></td>
<td width="73%">


<p>If set, will be used instead of <b>$PAGER</b> or
<b>more</b> to handle suffixes where the
<b>copiousoutput</b> flag is set. The context is as for
<b>handler</b>, i.e. <b>:mime:.</b><i>suffix</i><b>:</b> for
handling a file with the given <i>suffix</i>.</p></td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">Examples:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle
&rsquo;:mime:*&rsquo; mailcap &#732;/.mailcap
/usr/local/etc/mailcap <br>
zstyle &rsquo;:mime:.txt:&rsquo; handler less %s <br>
zstyle &rsquo;:mime:.txt:&rsquo; flags needsterminal</b></p>

<p style="margin-left:18%; margin-top: 1em">When
<b>zsh-mime-setup</b> is subsequently run, it will look for
<b>mailcap</b> entries in the two files given. Files of
suffix <b>.txt</b> will be handled by running
&lsquo;<b>less</b> <i>file.txt</i>&rsquo;. The flag
<b>needsterminal</b> is set to show that this program must
run attached to a terminal.</p>

<p style="margin-left:18%; margin-top: 1em">As there are
several steps to dispatching a command, the following should
be checked if attempting to execute a file by extension
<b>.</b><i>ext</i> does not have the expected effect.</p>

<p style="margin-left:18%; margin-top: 1em">The command
&lsquo;<b>alias -s</b> <i>ext</i>&rsquo; should show
&lsquo;<b>ps=zsh-mime-handler</b>&rsquo;. If it shows
something else, another suffix alias was already installed
and was not overwritten. If it shows nothing, no handler was
installed: this is most likely because no handler was found
in the <b>.mime.types</b> and <b>mailcap</b> combination for
<b>.ext</b> files. In that case, appropriate handling should
be added to <b>&#732;/.mime.types</b> and
<b>mailcap</b>.</p>

<p style="margin-left:18%; margin-top: 1em">If the
extension is handled by <b>zsh-mime-handler</b> but the file
is not opened correctly, either the handler defined for the
type is incorrect, or the flags associated with it are in
appropriate. Running <b>zsh-mime-setup -l</b> will show the
handler and, if there are any, the flags. A <b>%s</b> in the
handler is replaced by the file (suitably quoted if
necessary). Check that the handler program listed lists and
can be run in the way shown. Also check that the flags
<b>needsterminal</b> or <b>copiousoutput</b> are set if the
handler needs to be run under a terminal; the second flag is
used if the output should be sent to a pager. An example of
a suitable <b>mailcap</b> entry for such a program is:</p>

<p style="margin-left:27%; margin-top: 1em"><b>text/html;
/usr/bin/lynx &rsquo;%s&rsquo;; needsterminal</b></p>

<p style="margin-left:18%; margin-top: 1em">Running
&lsquo;<b>zsh-mime-handler -l</b> <i>command line</i>&rsquo;
prints the command line that would be executed, simplified
to remove the effect of any flags, and quoted so that the
output can be run as a complete zsh command line. This is
used by the completion system to decide how to complete
after a file handled by <b>zsh-mime-setup</b>.</p>

<p style="margin-left:9%;"><b>pick-web-browser</b></p>

<p style="margin-left:18%;">This function is separate from
the two MIME functions described above and can be assigned
directly to a suffix:</p>

<p style="margin-left:27%; margin-top: 1em"><b>autoload -U
pick-web-browser <br>
alias -s html=pick-web-browser</b></p>

<p style="margin-left:18%; margin-top: 1em">It is provided
as an intelligent front end to dispatch a web browser. It
may be run as either a function or a shell script. The
status 255 is returned if no browser could be started.</p>

<p style="margin-left:18%; margin-top: 1em">Various styles
are available to customize the choice of browsers: <b><br>
browser-style</b></p>

<p style="margin-left:27%;">The value of the style is an
array giving preferences in decreasing order for the type of
browser to use. The values of elements may be <b><br>
running</b></p>

<p style="margin-left:36%;">Use a GUI browser that is
already running when an X Window display is available. The
browsers listed in the <b>x-browsers</b> style are tried in
order until one is found; if it is, the file will be
displayed in that browser, so the user may need to check
whether it has appeared. If no running browser is found, one
is not started. Browsers other than Firefox, Opera and
Konqueror are assumed to understand the Mozilla syntax for
opening a URL remotely.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="27%"></td>
<td width="4%">


<p><b>x</b></p></td>
<td width="5%"></td>
<td width="64%">


<p>Start a new GUI browser when an X Window display is
available. Search for the availability of one of the
browsers listed in the <b>x-browsers</b> style and start the
first one that is found. No check is made for an already
running browser.</p></td></tr>
<tr valign="top" align="left">
<td width="27%"></td>
<td width="4%">


<p><b>tty</b></p></td>
<td width="5%"></td>
<td width="64%">


<p>Start a terminal-based browser. Search for the
availability of one of the browsers listed in the
<b>tty-browsers</b> style and start the first one that is
found.</p> </td></tr>
</table>

<p style="margin-left:27%; margin-top: 1em">If the style is
not set the default <b>running x tty</b> is used.</p>

<p style="margin-left:18%;"><b>x-browsers</b></p>

<p style="margin-left:27%;">An array in decreasing order of
preference of browsers to use when running under the X
Window System. The array consists of the command name under
which to start the browser. They are looked up in the
context <b>:mime:</b> (which may be extended in future, so
appending &lsquo;<b>*</b>&rsquo; is recommended). For
example,</p>

<p style="margin-left:36%; margin-top: 1em"><b>zstyle
&rsquo;:mime:*&rsquo; x-browsers opera konqueror
firefox</b></p>

<p style="margin-left:27%; margin-top: 1em">specifies that
<b>pick-web-browser</b> should first look for a running
instance of Opera, Konqueror or Firefox, in that order, and
if it fails to find any should attempt to start Opera. The
default is <b>firefox mozilla netscape opera
konqueror</b>.</p>

<p style="margin-left:18%;"><b>tty-browsers</b></p>

<p style="margin-left:27%;">An array similar to
<b>x-browsers</b>, except that it gives browsers to use when
no X Window display is available. The default is <b>elinks
links lynx</b>.</p>

<p style="margin-left:18%;"><b>command</b></p>

<p style="margin-left:27%;">If it is set this style is used
to pick the command used to open a page for a browser. The
context is <b>:mime:browser:new:$browser:</b> to start a new
browser or <b>:mime:browser:running:$browser:</b> to open a
URL in a browser already running on the current X display,
where <b>$browser</b> is the value matched in the
<b>x-browsers</b> or <b>tty-browsers</b> style. The escape
sequence <b>%b</b> in the style&rsquo;s value will be
replaced by the browser, while <b>%u</b> will be replaced by
the URL. If the style is not set, the default for all new
instances is equivalent to <b>%b %u</b> and the defaults for
using running browsers are equivalent to the values
<b>kfmclient openURL %u</b> for Konqueror, <b>firefox
-new-tab %u</b> for Firefox, <b>opera -newpage %u</b> for
Opera, and <b>%b -remote &quot;openUrl(%u)&quot;</b> for all
others.</p>

<h2>MATHEMATICAL FUNCTIONS
<a name="MATHEMATICAL FUNCTIONS"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em"><b>zcalc</b> [
<b>-erf</b> ] [ <i>expression</i> ... ]</p>

<p style="margin-left:18%;">A reasonably powerful
calculator based on zsh&rsquo;s arithmetic evaluation
facility. The syntax is similar to that of formulae in most
programming languages; see the section &lsquo;Arithmetic
Evaluation&rsquo; in <i>zshmisc</i>(1) for details.</p>


<p style="margin-left:18%; margin-top: 1em">Non-programmers
should note that, as in many other programming languages,
expressions involving only integers (whether constants
without a &lsquo;<b>.</b>&rsquo;, variables containing such
constants as strings, or variables declared to be integers)
are by default evaluated using integer arithmetic, which is
not how an ordinary desk calculator operates. To force
floating point operation, pass the option <b>-f</b>; see
further notes below.</p>

<p style="margin-left:18%; margin-top: 1em">If the file
<b>&#732;/.zcalcrc</b> exists it will be sourced inside the
function once it is set up and about to process the command
line. This can be used, for example, to set shell options;
<b>emulate -L zsh</b> and <b>setopt extendedglob</b> are in
effect at this point. Any failure to source the file if it
exists is treated as fatal. As with other initialisation
files, the directory <b>$ZDOTDIR</b> is used instead of
<b>$HOME</b> if it is set.</p>

<p style="margin-left:18%; margin-top: 1em">The
mathematical library <b>zsh/mathfunc</b> will be loaded if
it is available; see the section &lsquo;The zsh/mathfunc
Module&rsquo; in <i>zshmodules</i>(1). The mathematical
functions correspond to the raw system libraries, so
trigonometric functions are evaluated using radians, and so
on.</p>

<p style="margin-left:18%; margin-top: 1em">Each line typed
is evaluated as an expression. The prompt shows a number,
which corresponds to a positional parameter where the result
of that calculation is stored. For example, the result of
the calculation on the line preceded by &lsquo;<b>4&gt;</b>
&rsquo; is available as <b>$4</b>. The last value calculated
is available as <b>ans</b>. Full command line editing,
including the history of previous calculations, is
available; the history is saved in the file
<b>&#732;/.zcalc_history</b>. To exit, enter a blank line or
type &lsquo;<b>:q</b>&rsquo; on its own
(&lsquo;<b>q</b>&rsquo; is allowed for historical
compatibility).</p>

<p style="margin-left:18%; margin-top: 1em">A line ending
with a single backslash is treated in the same fashion as it
is in command line editing: the backslash is removed, the
function prompts for more input (the prompt is preceded by
&lsquo;<b>...</b>&rsquo; to indicate this), and the lines
are combined into one to get the final result. In addition,
if the input so far contains more open than close
parentheses <b>zcalc</b> will prompt for more input.</p>

<p style="margin-left:18%; margin-top: 1em">If arguments
are given to <b>zcalc</b> on start up, they are used to
prime the first few positional parameters. A visual
indication of this is given when the calculator starts.</p>

<p style="margin-left:18%; margin-top: 1em">The constants
<b>PI</b> (3.14159...) and <b>E</b> (2.71828...) are
provided. Parameter assignment is possible, but note that
all parameters will be put into the global namespace unless
the <b>:local</b> special command is used. The function
creates local variables whose names start with <b>_</b>, so
users should avoid doing so. The variables <b>ans</b> (the
last answer) and <b>stack</b> (the stack in RPN mode) may be
referred to directly; <b>stack</b> is an array but elements
of it are numeric. Various other special variables are used
locally with their standard meaning, for example
<b>compcontext</b>, <b>match</b>, <b>mbegin</b>,
<b>mend</b>, <b>psvar</b>.</p>

<p style="margin-left:18%; margin-top: 1em">The output base
can be initialised by passing the option
&lsquo;<b>-#</b><i>base</i>&rsquo;, for example
&lsquo;<b>zcalc -#16</b>&rsquo; (the &lsquo;<b>#</b>&rsquo;
may have to be quoted, depending on the globbing options
set).</p>

<p style="margin-left:18%; margin-top: 1em">If the option
&lsquo;<b>-e</b>&rsquo; is set, the function runs
non-interactively: the arguments are treated as expressions
to be evaluated as if entered interactively line by
line.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
&lsquo;<b>-f</b>&rsquo; is set, all numbers are treated as
floating point, hence for example the expression
&lsquo;<b>3/4</b>&rsquo; evaluates to 0.75 rather than 0.
Options must appear in separate words.</p>

<p style="margin-left:18%; margin-top: 1em">If the option
&lsquo;<b>-r</b>&rsquo; is set, RPN (Reverse Polish
Notation) mode is entered. This has various additional
properties:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="6%">


<p>Stack</p></td>
<td width="3%"></td>
<td width="73%">


<p>Evaluated values are maintained in a stack; this is
contained in an array named <b>stack</b> with the most
recent value in <b>${stack[1]}</b>.</p></td></tr>
</table>

<p style="margin-left:18%;">Operators and functions</p>

<p style="margin-left:27%;">If the line entered matches an
operator (<b>+</b>, <b>-</b>, <b>*</b>, <b>/</b>, <b>**</b>,
<b>&#710;</b>, <b>|</b> or <b>&amp;</b>) or a function
supplied by the <b>zsh/mathfunc</b> library, the bottom
element or elements of the stack are popped to use as the
argument or arguments. The higher elements of stack (least
recent) are used as earlier arguments. The result is then
pushed into <b>${stack[1]}</b>.</p>

<p style="margin-left:18%;">Expressions</p>

<p style="margin-left:27%;">Other expressions are evaluated
normally, printed, and added to the stack as numeric values.
The syntax within expressions on a single line is normal
shell arithmetic (not RPN).</p>

<p style="margin-left:18%;">Stack listing</p>

<p style="margin-left:27%;">If an integer follows the
option <b>-r</b> with no space, then on every evaluation
that many elements of the stack, where available, are
printed instead of just the most recent result. Hence, for
example, <b>zcalc -r4</b> shows <b>$stack[4]</b> to
<b>$stack[1]</b> each time results are printed.</p>

<p style="margin-left:18%;">Duplication: <b>=</b></p>

<p style="margin-left:27%;">The pseudo-operator <b>=</b>
causes the most recent element of the stack to be duplicated
onto the stack.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>pop</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>The pseudo-function <b>pop</b> causes the most recent
element of the stack to be popped. A
&lsquo;<b>&gt;</b>&rsquo; on its own has the same
effect.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>&gt;</b><i>ident</i></p></td>
<td width="1%"></td>
<td width="73%">


<p>The expression <b>&gt;</b> followed (with no space) by a
shell identifier causes the most recent element of the stack
to be popped and assigned to the variable with that name.
The variable is local to the <b>zcalc</b> function.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>&lt;</b><i>ident</i></p></td>
<td width="1%"></td>
<td width="73%">


<p>The expression <b>&lt;</b> followed (with no space) by a
shell identifier causes the value of the variable with that
name to be pushed onto the stack. <i>ident</i> may be an
integer, in which case the previous result with that number
(as shown before the <b>&gt;</b> in the standard
<b>zcalc</b> prompt) is put on the stack.</p></td></tr>
</table>

<p style="margin-left:18%;">Exchange: <b>xy</b></p>

<p style="margin-left:27%;">The pseudo-function <b>xy</b>
causes the most recent two elements of the stack to be
exchanged. &lsquo;<b>&lt;&gt;</b>&rsquo; has the same
effect.</p>

<p style="margin-left:18%; margin-top: 1em">The prompt is
configurable via the parameter <b>ZCALCPROMPT</b>, which
undergoes standard prompt expansion. The index of the
current entry is stored locally in the first element of the
array <b>psvar</b>, which can be referred to in
<b>ZCALCPROMPT</b> as &lsquo;<b>%1v</b>&rsquo;. The default
prompt is &lsquo;<b>%1v&gt;</b> &rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">The variable
<b>ZCALC_ACTIVE</b> is set within the function and can be
tested by nested functions; it has the value <b>rpn</b> if
RPN mode is active, else 1.</p>

<p style="margin-left:18%; margin-top: 1em">A few special
commands are available; these are introduced by a colon. For
backward compatibility, the colon may be omitted for certain
commands. Completion is available if <b>compinit</b> has
been run.</p>

<p style="margin-left:18%; margin-top: 1em">The output
precision may be specified within zcalc by special commands
familiar from many calculators.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="6%">


<p><b>:norm</b></p></td>
<td width="3%"></td>
<td width="73%">


<p>The default output format. It corresponds to the printf
<b>%g</b> specification. Typically this shows six decimal
digits.</p> </td></tr>
</table>

<p style="margin-left:18%;"><b>:sci</b> <i>digits</i></p>

<p style="margin-left:27%;">Scientific notation,
corresponding to the printf <b>%g</b> output format with the
precision given by <i>digits</i>. This produces either fixed
point or exponential notation depending on the value
output.</p>

<p style="margin-left:18%;"><b>:fix</b> <i>digits</i></p>

<p style="margin-left:27%;">Fixed point notation,
corresponding to the printf <b>%f</b> output format with the
precision given by <i>digits</i>.</p>

<p style="margin-left:18%;"><b>:eng</b> <i>digits</i></p>

<p style="margin-left:27%;">Exponential notation,
corresponding to the printf <b>%E</b> output format with the
precision given by <i>digits</i>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="5%">


<p><b>:raw</b></p></td>
<td width="4%"></td>
<td width="73%">


<p>Raw output: this is the default form of the output from
a math evaluation. This may show more precision than the
number actually possesses.</p></td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">Other special
commands: <b><br>
:!</b><i>line...</i></p>

<p style="margin-left:27%;">Execute <i>line...</i> as a
normal shell command line. Note that it is executed in the
context of the function, i.e. with local variables. Space is
optional after <b>:!</b>.</p>

<p style="margin-left:18%;"><b>:local</b> <i>arg</i>
...</p>

<p style="margin-left:27%;">Declare variables local to the
function. Other variables may be used, too, but they will be
taken from or put into the global scope.</p>

<p style="margin-left:18%;"><b>:function</b> <i>name</i> [
<i>body</i> ]</p>

<p style="margin-left:27%;">Define a mathematical function
or (with no <i>body</i>) delete it. <b>:function</b> may be
abbreviated to <b>:func</b> or simply <b>:f</b>. The
<i>name</i> may contain the same characters as a shell
function name. The function is defined using
<b>zmathfuncdef</b>, see below.</p>

<p style="margin-left:27%; margin-top: 1em">Note that
<b>zcalc</b> takes care of all quoting. Hence for
example:</p>

<p style="margin-left:36%; margin-top: 1em"><b>:f cube $1 *
$1 * $1</b></p>

<p style="margin-left:27%; margin-top: 1em">defines a
function to cube the sole argument. Functions so defined, or
indeed any functions defined directly or indirectly using
<b>functions -M</b>, are available to execute by typing only
the name on the line in RPN mode; this pops the appropriate
number of arguments off the stack to pass to the function,
i.e. 1 in the case of the example <b>cube</b> function. If
there are optional arguments only the mandatory arguments
are supplied by this means.</p>


<p style="margin-left:18%;"><b>[#</b><i>base</i><b>]</b></p>

<p style="margin-left:27%;">This is not a special command,
rather part of normal arithmetic syntax; however, when this
form appears on a line by itself the default output radix is
set to <i>base</i>. Use, for example,
&lsquo;<b>[#16]</b>&rsquo; to display hexadecimal output
preceded by an indication of the base, or
&lsquo;<b>[##16]</b>&rsquo; just to display the raw number
in the given base. Bases themselves are always specified in
decimal. &lsquo;<b>[#]</b>&rsquo; restores the normal output
format. Note that setting an output base suppresses floating
point output; use &lsquo;<b>[#]</b>&rsquo; to return to
normal operation.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="5%">


<p><b>$</b><i>var</i></p></td>
<td width="4%"></td>
<td width="73%">


<p>Print out the value of var literally; does not affect
the calculation. To use the value of var, omit the leading
&lsquo;<b>$</b>&rsquo;.</p> </td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">See the
comments in the function for a few extra tips.</p>

<p style="margin-left:9%;"><b>min(</b><i>arg</i><b>, ...)
<br>
max(</b><i>arg</i><b>, ...) <br>
sum(</b><i>arg</i><b>, ...) <br>
zmathfunc</b></p>

<p style="margin-left:18%;">The function <b>zmathfunc</b>
defines the three mathematical functions <b>min</b>,
<b>max</b>, and <b>sum</b>. The functions <b>min</b> and
<b>max</b> take one or more arguments. The function
<b>sum</b> takes zero or more arguments. Arguments can be of
different types (ints and floats).</p>

<p style="margin-left:18%; margin-top: 1em">Not to be
confused with the <b>zsh/mathfunc</b> module, described in
the section &lsquo;The zsh/mathfunc Module&rsquo; in
<i>zshmodules</i>(1).</p>

<p style="margin-left:9%;"><b>zmathfuncdef</b> [
<i>mathfunc</i> [ <i>body</i> ] ]</p>

<p style="margin-left:18%;">A convenient front end to
<b>functions -M</b>.</p>

<p style="margin-left:18%; margin-top: 1em">With two
arguments, define a mathematical function named
<i>mathfunc</i> which can be used in any form of arithmetic
evaluation. <i>body</i> is a mathematical expression to
implement the function. It may contain references to
position parameters <b>$1</b>, <b>$2</b>, ... to refer to
mandatory parameters and <b>${1:-</b><i>defvalue</i><b>}</b>
... to refer to optional parameters. Note that the forms
must be strictly adhered to for the function to calculate
the correct number of arguments. The implementation is held
in a shell function named
<b>zsh_math_func_</b><i>mathfunc</i>; usually the user will
not need to refer to the shell function directly. Any
existing function of the same name is silently replaced.</p>

<p style="margin-left:18%; margin-top: 1em">With one
argument, remove the mathematical function <i>mathfunc</i>
as well as the shell function implementation.</p>

<p style="margin-left:18%; margin-top: 1em">With no
arguments, list all <i>mathfunc</i> functions in a form
suitable for restoring the definition. The functions have
not necessarily been defined by <b>zmathfuncdef</b>.</p>

<h2>USER CONFIGURATION FUNCTIONS
<a name="USER CONFIGURATION FUNCTIONS"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The
<b>zsh/newuser</b> module comes with a function to aid in
configuring shell options for new users. If the module is
installed, this function can also be run by hand. It is
available even if the module&rsquo;s default behaviour,
namely running the function for a new user logging in
without startup files, is inhibited. <b><br>
zsh-newuser-install</b> [ <b>-f</b> ]</p>

<p style="margin-left:18%;">The function presents the user
with various options for customizing their initialization
scripts. Currently only <b>&#732;/.zshrc</b> is handled.
<b>$ZDOTDIR/.zshrc</b> is used instead if the parameter
<b>ZDOTDIR</b> is set; this provides a way for the user to
configure a file without altering an existing
<b>.zshrc</b>.</p>

<p style="margin-left:18%; margin-top: 1em">By default the
function exits immediately if it finds any of the files
<b>.zshenv</b>, <b>.zprofile</b>, <b>.zshrc</b>, or
<b>.zlogin</b> in the appropriate directory. The option
<b>-f</b> is required in order to force the function to
continue. Note this may happen even if <b>.zshrc</b> itself
does not exist.</p>

<p style="margin-left:18%; margin-top: 1em">As currently
configured, the function will exit immediately if the user
has root privileges; this behaviour cannot be
overridden.</p>

<p style="margin-left:18%; margin-top: 1em">Once activated,
the function&rsquo;s behaviour is supposed to be
self-explanatory. Menus are present allowing the user to
alter the value of options and parameters. Suggestions for
improvements are always welcome.</p>

<p style="margin-left:18%; margin-top: 1em">When the script
exits, the user is given the opportunity to save the new
file or not; changes are not irreversible until this point.
However, the script is careful to restrict changes to the
file only to a group marked by the lines &lsquo;<b># Lines
configured by zsh-newuser-install</b>&rsquo; and &lsquo;<b>#
End of lines configured by zsh-newuser-install</b>&rsquo;.
In addition, the old version of <b>.zshrc</b> is saved to a
file with the suffix <b>.zni</b> appended.</p>

<p style="margin-left:18%; margin-top: 1em">If the function
edits an existing <b>.zshrc</b>, it is up to the user to
ensure that the changes made will take effect. For example,
if control usually returns early from the existing
<b>.zshrc</b> the lines will not be executed; or a later
initialization file may override options or parameters, and
so on. The function itself does not attempt to detect any
such conflicts.</p>

<h2>OTHER FUNCTIONS
<a name="OTHER FUNCTIONS"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">There are a
large number of helpful functions in the
<b>Functions/Misc</b> directory of the zsh distribution.
Most are very simple and do not require documentation here,
but a few are worthy of special mention.</p>

<h3>Descriptions
<a name="Descriptions"></a>
</h3>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p style="margin-top: 1em"><b>colors</b></p></td>
<td width="1%"></td>
<td width="82%">


<p style="margin-top: 1em">This function initializes
several associative arrays to map color names to (and from)
the ANSI standard eight-color terminal codes. These are used
by the prompt theme system (see above). You seldom should
need to run <b>colors</b> more than once.</p></td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">The eight base
colors are: <b>black</b>, <b>red</b>, <b>green</b>,
<b>yellow</b>, <b>blue</b>, <b>magenta</b>, <b>cyan</b>, and
<b>white</b>. Each of these has codes for foreground and
background. In addition there are seven intensity
attributes: <b>bold</b>, <b>faint</b>, <b>standout</b>,
<b>underline</b>, <b>blink</b>, <b>reverse</b>, and
<b>conceal</b>. Finally, there are seven codes used to
negate attributes: <b>none</b> (reset all attributes to the
defaults), <b>normal</b> (neither bold nor faint),
<b>no-standout</b>, <b>no-underline</b>, <b>no-blink</b>,
<b>no-reverse</b>, and <b>no-conceal</b>.</p>

<p style="margin-left:18%; margin-top: 1em">Some terminals
do not support all combinations of colors and
intensities.</p>

<p style="margin-left:18%; margin-top: 1em">The associative
arrays are:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p style="margin-top: 1em"><b>color</b></p></td>
<td width="1%"></td>
<td width="73%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="8%">


<p><b>colour</b></p></td>
<td width="1%"></td>
<td width="73%">


<p>Map all the color names to their integer codes, and
integer codes to the color names. The eight base names map
to the foreground color codes, as do names prefixed with
&lsquo;<b>fg-</b>&rsquo;, such as
&lsquo;<b>fg-red</b>&rsquo;. Names prefixed with
&lsquo;<b>bg-</b>&rsquo;, such as
&lsquo;<b>bg-blue</b>&rsquo;, refer to the background codes.
The reverse mapping from code to color yields base name for
foreground codes and the <b>bg-</b> form for
backgrounds.</p> </td></tr>
</table>

<p style="margin-left:27%; margin-top: 1em">Although it is
a misnomer to call them &lsquo;colors&rsquo;, these arrays
also map the other fourteen attributes from names to codes
and codes to names.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p style="margin-top: 1em"><b>fg</b></p></td>
<td width="79%">
</td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em"><b>fg_bold <br>
fg_no_bold</b></p>

<p style="margin-left:27%;">Map the eight basic color names
to ANSI terminal escape sequences that set the corresponding
foreground text properties. The <b>fg</b> sequences change
the color without changing the eight intensity
attributes.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>bg</b></p></td>
<td width="79%">
</td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em"><b>bg_bold <br>
bg_no_bold</b></p>

<p style="margin-left:27%;">Map the eight basic color names
to ANSI terminal escape sequences that set the corresponding
background properties. The <b>bg</b> sequences change the
color without changing the eight intensity attributes.</p>

<p style="margin-left:18%; margin-top: 1em">In addition,
the scalar parameters <b>reset_color</b> and
<b>bold_color</b> are set to the ANSI terminal escapes that
turn off all attributes and turn on bold intensity,
respectively.</p>

<p style="margin-left:9%;"><b>fned</b> [ <b>-x</b>
<i>num</i> ] <i>name</i></p>

<p style="margin-left:18%;">Same as <b>zed -f</b>. This
function does not appear in the zsh distribution, but can be
created by linking <b>zed</b> to the name <b>fned</b> in
some directory in your <b>fpath</b>.</p>

<p style="margin-left:9%;"><b>histed</b> [ [ <i>name</i> ]
<i>size</i> ]</p>

<p style="margin-left:18%;">Same as <b>zed -h</b>. This
function does not appear in the zsh distribution, but can be
created by linking <b>zed</b> to the name <b>histed</b> in
some directory in your <b>fpath</b>.</p>

<p style="margin-left:9%;"><b>is-at-least</b> <i>needed</i>
[ <i>present</i> ]</p>

<p style="margin-left:18%;">Perform a
greater-than-or-equal-to comparison of two strings having
the format of a zsh version number; that is, a string of
numbers and text with segments separated by dots or dashes.
If the <i>present</i> string is not provided,
<b>$ZSH_VERSION</b> is used. Segments are paired
left-to-right in the two strings with leading non-number
parts ignored. If one string has fewer segments than the
other, the missing segments are considered zero.</p>

<p style="margin-left:18%; margin-top: 1em">This is useful
in startup files to set options and other state that are not
available in all versions of zsh.</p>

<p style="margin-left:27%; margin-top: 1em"><b>is-at-least
3.1.6-15 &amp;&amp; setopt NO_GLOBAL_RCS <br>
is-at-least 3.1.0 &amp;&amp; setopt HIST_REDUCE_BLANKS <br>
is-at-least 2.6-17 || print &quot;You can&rsquo;t use
is-at-least here.&quot;</b></p>

<p style="margin-left:9%;"><b>nslookup</b> [ <i>arg</i> ...
]</p>

<p style="margin-left:18%;">This wrapper function for the
<b>nslookup</b> command requires the <b>zsh/zpty</b> module
(see <i>zshmodules</i>(1)). It behaves exactly like the
standard <b>nslookup</b> except that it provides
customizable prompts (including a right-side prompt) and
completion of nslookup commands, host names, etc. (if you
use the function-based completion system). Completion styles
may be set with the context prefix
&lsquo;<b>:completion:nslookup</b>&rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">See also the
<b>pager</b>, <b>prompt</b> and <b>rprompt</b> styles
below.</p>

<p style="margin-left:9%;"><b>regexp-replace</b> <i>var
regexp replace</i></p>

<p style="margin-left:18%;">Use regular expressions to
perform a global search and replace operation on a variable.
POSIX extended regular expressions (ERE) are used, unless
the option <b>RE_MATCH_PCRE</b> has been set, in which case
Perl-compatible regular expressions are used (this requires
the shell to be linked against the <b>pcre</b> library).</p>

<p style="margin-left:18%; margin-top: 1em"><i>var</i> is
the name of the variable containing the string to be
matched. The variable will be modified directly by the
function. The variables <b>MATCH</b>, <b>MBEGIN</b>,
<b>MEND</b>, <b>match</b>, <b>mbegin</b>, <b>mend</b> should
be avoided as these are used by the regular expression
code.</p>

<p style="margin-left:18%; margin-top: 1em"><i>regexp</i>
is the regular expression to match against the string.</p>

<p style="margin-left:18%; margin-top: 1em"><i>replace</i>
is the replacement text. This can contain parameter, command
and arithmetic expressions which will be replaced: in
particular, a reference to <b>$MATCH</b> will be replaced by
the text matched by the pattern.</p>

<p style="margin-left:18%; margin-top: 1em">The return
status is 0 if at least one match was performed, else 1.</p>

<p style="margin-left:18%; margin-top: 1em">Note that if
using POSIX EREs, the <b>&#710;</b> or word boundary
operators (where available) may not work properly.</p>

<p style="margin-left:9%;"><b>run-help</b> <i>cmd</i></p>

<p style="margin-left:18%;">This function is designed to be
invoked by the <b>run-help</b> ZLE widget, in place of the
default alias. See &lsquo;Accessing On-Line Help&rsquo;
above for setup instructions.</p>

<p style="margin-left:18%; margin-top: 1em">In the
discussion which follows, if <i>cmd</i> is a file system
path, it is first reduced to its rightmost component (the
file name).</p>

<p style="margin-left:18%; margin-top: 1em">Help is first
sought by looking for a file named <i>cmd</i> in the
directory named by the <b>HELPDIR</b> parameter. If no file
is found, an assistant function, alias, or command named
<b>run-help-</b><i>cmd is sought. If found, the assistant is
executed with the rest of the current command line
(everything after the command name cmd) as its arguments.
When neither file nor assistant is found, the external
command &lsquo;</i><b>man</b> <i>cmd&rsquo; is run.</i></p>

<p style="margin-left:18%; margin-top: 1em">An example
assistant for the &quot;ssh&quot; command:</p>


<p style="margin-left:27%; margin-top: 1em"><b>run-help-ssh()
{ <br>
emulate -LR zsh <br>
local -a args <br>
# Delete the &quot;-l username&quot; option <br>
zparseopts -D -E -a args l: <br>
# Delete other options, leaving: host command <br>
args=(${@:#-*}) <br>
if [[ ${#args} -lt 2 ]]; then <br>
man ssh <br>
else <br>
run-help $args[2] <br>
fi <br>
}</b></p>

<p style="margin-left:18%; margin-top: 1em">Several of
these assistants are provided in the <b>Functions/Misc</b>
directory. These must be autoloaded, or placed as executable
scripts in your search path, in order to be found and used
by <b>run-help</b>. <b><br>
run-help-btrfs <br>
run-help-git <br>
run-help-ip <br>
run-help-openssl <br>
run-help-p4 <br>
run-help-sudo <br>
run-help-svk <br>
run-help-svn</b></p>

<p style="margin-left:27%;">Assistant functions for the
<b>btrfs</b>, <b>git</b>, <b>ip</b>, <b>openssl</b>,
<b>p4</b>, <b>sudo</b>, <b>svk</b>, and <b>svn</b>,
commands.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>tetris</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>Zsh was once accused of not being as complete as Emacs,
because it lacked a Tetris game. This function was written
to refute this vicious slander.</p></td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">This function
must be used as a ZLE widget:</p>

<p style="margin-left:27%; margin-top: 1em"><b>autoload -U
tetris <br>
zle -N tetris <br>
bindkey</b> <i>keys</i> <b>tetris</b></p>

<p style="margin-left:18%; margin-top: 1em">To start a
game, execute the widget by typing the <i>keys</i>. Whatever
command line you were editing disappears temporarily, and
your keymap is also temporarily replaced by the Tetris
control keys. The previous editor state is restored when you
quit the game (by pressing &lsquo;<b>q</b>&rsquo;) or when
you lose.</p>

<p style="margin-left:18%; margin-top: 1em">If you quit in
the middle of a game, the next invocation of the
<b>tetris</b> widget will continue where you left off. If
you lost, it will start a new game.</p>

<p style="margin-left:9%;"><b>tetriscurses</b></p>

<p style="margin-left:18%;">This is a port of the above to
zcurses. The input handling is improved a bit so that moving
a block sideways doesn&rsquo;t automatically advance a
timestep, and the graphics use unicode block graphics.</p>

<p style="margin-left:18%; margin-top: 1em">This version
does not save the game state between invocations, and is not
invoked as a widget, but rather as:</p>

<p style="margin-left:27%; margin-top: 1em"><b>autoload -U
tetriscurses <br>
tetriscurses</b></p>

<p style="margin-left:9%;"><b>zargs</b> [ <i>option</i> ...
<b>--</b> ] [ <i>input</i> ... ] [ <b>--</b> <i>command</i>
[ <i>arg</i> ... ] ]</p>

<p style="margin-left:18%;">This function has a similar
purpose to GNU xargs. Instead of reading lines of arguments
from the standard input, it takes them from the command
line. This is useful because zsh, especially with recursive
glob operators, often can construct a command line for a
shell function that is longer than can be accepted by an
external command.</p>

<p style="margin-left:18%; margin-top: 1em">The
<i>option</i> list represents options of the <b>zargs</b>
command itself, which are the same as those of <b>xargs</b>.
The <i>input</i> list is the collection of strings (often
file names) that become the arguments of the <b>command</b>,
analogous to the standard input of <b>xargs</b>. Finally,
the <i>arg</i> list consists of those arguments (usually
options) that are passed to the <i>command</i> each time it
runs. The <i>arg</i> list precedes the elements from the
<b>input</b> list in each run. If no <i>command</i> is
provided, then no <i>arg</i> list may be provided, and in
that event the default command is &lsquo;<b>print</b>&rsquo;
with arguments &lsquo;<b>-r --</b>&rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">For example, to
get a long <b>ls</b> listing of all non-hidden plain files
in the current directory or its subdirectories:</p>

<p style="margin-left:27%; margin-top: 1em"><b>autoload -U
zargs <br>
zargs -- **/*(.) -- ls -ld --</b></p>

<p style="margin-left:18%; margin-top: 1em">The first and
third occurrences of &lsquo;<b>--</b>&rsquo; are used to
mark the end of options for <b>zargs</b> and <b>ls</b>
respectively to guard against filenames starting with
&lsquo;<b>-</b>&rsquo;, while the second is used to separate
the list of files from the command to run (&lsquo;<b>ls -ld
--</b>&rsquo;).</p>

<p style="margin-left:18%; margin-top: 1em">The first
&lsquo;<b>--</b>&rsquo; would also be needed if there was a
chance the list might be empty as in:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zargs -r --
./*.back(#qN) -- rm -f</b></p>

<p style="margin-left:18%; margin-top: 1em">In the event
that the string &lsquo;<b>--</b>&rsquo; is or may be an
<i>input</i>, the <b>-e</b> option may be used to change the
end-of-inputs marker. Note that this does <i>not</i> change
the end-of-options marker. For example, to use
&lsquo;<b>..</b>&rsquo; as the marker:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zargs -e..
-- **/*(.) .. ls -ld --</b></p>

<p style="margin-left:18%; margin-top: 1em">This is a good
choice in that example because no plain file can be named
&lsquo;<b>..</b>&rsquo;, but the best end-marker depends on
the circumstances.</p>

<p style="margin-left:18%; margin-top: 1em">The options
<b>-i</b>, <b>-I</b>, <b>-l</b>, <b>-L</b>, and <b>-n</b>
differ slightly from their usage in <b>xargs</b>. There are
no input lines for <b>zargs</b> to count, so <b>-l</b> and
<b>-L</b> count through the <i>input</i> list, and <b>-n</b>
counts the number of arguments passed to each execution of
<i>command</i>, <i>including</i> any <i>arg</i> list. Also,
any time <b>-i</b> or <b>-I</b> is used, each <i>input</i>
is processed separately as if by &lsquo;<b>-L
1</b>&rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">For details of
the other <b>zargs</b> options, see the <i>xargs</i>(1) man
page (but note the difference in function between
<b>zargs</b> and <b>xargs</b>) or run <b>zargs</b> with the
<b>--help</b> option.</p>

<p style="margin-left:9%;"><b>zed</b> [ <b>-f</b> [
<b>-x</b> <i>num</i> ] ] <i>name</i> <b><br>
zed</b> [ <b>-h</b> [ <i>name</i> ] <i>size</i> ]</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>zed -b</b></p></td>
<td width="1%"></td>
<td width="78%">


<p>This function uses the ZLE editor to edit a file or
function.</p> </td>
<td width="4%">
</td></tr>
</table>

<p style="margin-left:18%; margin-top: 1em">Only one
<i>name</i> argument is allowed. If the <b>-f</b> option is
given, the name is taken to be that of a function; if the
function is marked for autoloading, <b>zed</b> searches for
it in the <b>fpath</b> and loads it. Note that functions
edited this way are installed into the current shell, but
<i>not</i> written back to the autoload file. In this case
the <b>-x</b> option specifies that leading tabs indenting
the function according to syntax should be converted into
the given number of spaces; &lsquo;<b>-x 2</b>&rsquo; is
consistent with the layout of functions distributed with the
shell.</p>

<p style="margin-left:18%; margin-top: 1em">Without
<b>-f</b>, <i>name</i> is the path name of the file to edit,
which need not exist; it is created on write, if necessary.
With <b>-h</b>, the file is presumed to contain history
events.</p>

<p style="margin-left:18%; margin-top: 1em">When no file
name is provided for <b>-h</b> the current shell history is
edited in place. The history is renumbered when zed exits
successfully.</p>

<p style="margin-left:18%; margin-top: 1em">When editing
history, multi-line events must have a trailing backslash on
every line before the last.</p>

<p style="margin-left:18%; margin-top: 1em">While editing,
the function sets the main keymap to <b>zed</b> and the vi
command keymap to <b>zed-vicmd</b>. These will be copied
from the existing <b>main</b> and <b>vicmd</b> keymaps if
they do not exist the first time <b>zed</b> is run. They can
be used to provide special key bindings used only in
zed.</p>

<p style="margin-left:18%; margin-top: 1em">If it creates
the keymap, <b>zed</b> rebinds the return key to insert a
line break and &lsquo;<b>&#710;X&#710;W</b>&rsquo; to accept
the edit in the <b>zed</b> keymap, and binds
&lsquo;<b>ZZ</b>&rsquo; to accept the edit in the
<b>zed-vicmd</b> keymap.</p>

<p style="margin-left:18%; margin-top: 1em">The bindings
alone can be installed by running &lsquo;<b>zed
-b</b>&rsquo;. This is suitable for putting into a startup
file. Note that, if rerun, this will overwrite the existing
<b>zed</b> and <b>zed-vicmd</b> keymaps.</p>

<p style="margin-left:18%; margin-top: 1em">Completion is
available, and styles may be set with the context prefix
&lsquo;<b>:completion:zed:</b>&rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">A zle widget
<b>zed-set-file-name</b> is available. This can be called by
name from within zed using &lsquo;<b>\ex
zed-set-file-name</b>&rsquo; or can be bound to a key in
either of the <b>zed</b> or <b>zed-vicmd</b> keymaps after
&lsquo;<b>zed -b</b>&rsquo; has been run. When the widget is
called, it prompts for a new name for the file being edited.
When zed exits the file will be written under that name and
the original file will be left alone. The widget has no
effect when invoked from &lsquo;<b>zed -f</b>&rsquo;. The
completion context is changed to
&lsquo;<b>:completion:zed-set-file-name:</b>&rsquo;. When
editing the current history with &lsquo;<b>zed
-h</b>&rsquo;, the history is first updated and then the
file is written, but the global setting of <b>HISTFILE</b>
is not altered.</p>

<p style="margin-left:18%; margin-top: 1em">While
<b>zed-set-file-name</b> is running, zed uses the keymap
<b>zed-normal-keymap</b>, which is linked from the main
keymap in effect at the time zed initialised its bindings.
(This is to make the return key operate normally.) The
result is that if the main keymap has been changed, the
widget won&rsquo;t notice. This is not a concern for most
users.</p>

<p style="margin-left:9%;"><b>zcp</b> [ <b>-finqQvwW</b> ]
<i>srcpat dest</i> <b><br>
zln</b> [ <b>-finqQsvwW</b> ] <i>srcpat dest</i></p>

<p style="margin-left:18%;">Same as <b>zmv -C</b> and
<b>zmv -L</b>, respectively. These functions do not appear
in the zsh distribution, but can be created by linking
<b>zmv</b> to the names <b>zcp</b> and <b>zln</b> in some
directory in your <b>fpath</b>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="5%">


<p><b>zkbd</b></p></td>
<td width="4%"></td>
<td width="41%">


<p>See &lsquo;Keyboard Definition&rsquo; above.</p></td>
<td width="41%">
</td></tr>
</table>

<p style="margin-left:9%;"><b>zmv</b> [ <b>-finqQsvwW</b> ]
[ <b>-C</b> | <b>-L</b> | <b>-M</b> | -{<b>p</b>|<b>P</b>}
<i>program</i> ] [ <b>-o</b> <i>optstring</i> ] <i><br>
srcpat dest</i></p>

<p style="margin-left:18%;">Move (usually, rename) files
matching the pattern <i>srcpat</i> to corresponding files
having names of the form given by <i>dest</i>, where
<i>srcpat</i> contains parentheses surrounding patterns
which will be replaced in turn by <b>$1</b>, <b>$2</b>, ...
in <i>dest</i>. For example,</p>

<p style="margin-left:27%; margin-top: 1em"><b>zmv
&rsquo;(*).lis&rsquo; &rsquo;$1.txt&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">renames
&lsquo;<b>foo.lis</b>&rsquo; to
&lsquo;<b>foo.txt</b>&rsquo;,
&lsquo;<b>my.old.stuff.lis</b>&rsquo; to
&lsquo;<b>my.old.stuff.txt</b>&rsquo;, and so on.</p>

<p style="margin-left:18%; margin-top: 1em">The pattern is
always treated as an <b>EXTENDED_GLOB</b> pattern. Any file
whose name is not changed by the substitution is simply
ignored. Any error (a substitution resulted in an empty
string, two substitutions gave the same result, the
destination was an existing regular file and <b>-f</b> was
not given) causes the entire function to abort without doing
anything.</p>

<p style="margin-left:18%; margin-top: 1em">In addition to
pattern replacement, the variable <b>$f</b> can be referred
to in the second (replacement) argument. This makes it
possible to use variable substitution to alter the argument;
see examples below.</p>

<p style="margin-left:18%; margin-top: 1em">Options:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-f</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Force overwriting of destination files. Not currently
passed down to the <b>mv</b>/<b>cp</b>/<b>ln</b> command due
to vagaries of implementations (but you can use <b>-o-f</b>
to do that).</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-i</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Interactive: show each line to be executed and ask the
user whether to execute it. &lsquo;<b>Y</b>&rsquo; or
&lsquo;<b>y</b>&rsquo; will execute it, anything else will
skip it. Note that you just need to type one character.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-n</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>No execution: print what would happen, but don&rsquo;t
do it.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-q</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Turn bare glob qualifiers off: now assumed by default,
so this has no effect.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-Q</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Force bare glob qualifiers on. Don&rsquo;t turn this on
unless you are actually using glob qualifiers in a
pattern.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-s</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Symbolic, passed down to <b>ln</b>; only works with
<b>-L</b>.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-v</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Verbose: print each command as it&rsquo;s being
executed.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-w</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Pick out wildcard parts of the pattern, as described
above, and implicitly add parentheses for referring to
them.</p> </td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-W</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Just like <b>-w</b>, with the addition of turning
wildcards in the replacement pattern into sequential
<b>${1}</b> .. <b>${N}</b> references.</p></td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-C</b></p></td>
<td width="6%"></td>
<td width="73%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-L</b></p></td>
<td width="6%"></td>
<td width="73%">
</td></tr>
<tr valign="top" align="left">
<td width="18%"></td>
<td width="3%">


<p><b>-M</b></p></td>
<td width="6%"></td>
<td width="73%">


<p>Force <b>cp</b>, <b>ln</b> or <b>mv</b>, respectively,
regardless of the name of the function.</p></td></tr>
</table>

<p style="margin-left:18%;"><b>-p</b> <i>program</i></p>

<p style="margin-left:27%;">Call <i>program</i> instead of
<b>cp</b>, <b>ln</b> or <b>mv</b>. Whatever it does, it
should at least understand the form &lsquo;<i>program</i>
<b>--</b> <i>oldname newname</i>&rsquo; where <i>oldname</i>
and <i>newname</i> are filenames generated by <b>zmv</b>.
<i>program</i> will be split into words, so might be e.g.
the name of an archive tool plus a copy or rename
subcommand.</p>

<p style="margin-left:18%;"><b>-P</b> <i>program</i></p>

<p style="margin-left:27%;">As <b>-p</b> <i>program</i>,
except that <i>program</i> does not accept a following
<b>--</b> to indicate the end of options. In this case
filenames must already be in a sane form for the program in
question.</p>

<p style="margin-left:18%;"><b>-o</b> <i>optstring</i></p>

<p style="margin-left:27%;">The <i>optstring</i> is split
into words and passed down verbatim to the <b>cp</b>,
<b>ln</b> or <b>mv</b> command called to perform the work.
It should probably begin with a &lsquo;<b>-</b>&rsquo;.</p>

<p style="margin-left:18%; margin-top: 1em">Further
examples:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zmv -v
&rsquo;(* *)&rsquo; &rsquo;${1// /_}&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">For any file in
the current directory with at least one space in the name,
replace every space by an underscore and display the
commands executed.</p>

<p style="margin-left:27%; margin-top: 1em"><b>zmv -v
&rsquo;* *&rsquo; &rsquo;${f// /_}&rsquo;</b></p>

<p style="margin-left:18%; margin-top: 1em">This does
exactly the same by referring to the file name stored in
<b>$f</b>.</p>

<p style="margin-left:18%; margin-top: 1em">For more
complete examples and other implementation details, see the
<b>zmv</b> source file, usually located in one of the
directories named in your <b>fpath</b>, or in
<b>Functions/Misc/zmv</b> in the zsh distribution.</p>

<p style="margin-left:9%;"><b>zrecompile</b></p>

<p style="margin-left:18%;">See &lsquo;Recompiling
Functions&rsquo; above.</p>

<p style="margin-left:9%;"><b>zstyle+</b> <i>context style
value</i> [ <b>+</b> <i>subcontext style value</i> ... ]</p>

<p style="margin-left:18%;">This makes defining styles a
bit simpler by using a single &lsquo;<b>+</b>&rsquo; as a
special token that allows you to append a context name to
the previously used context name. Like this:</p>

<p style="margin-left:27%; margin-top: 1em"><b>zstyle+
&rsquo;:foo:bar&rsquo;</b> <i>style1 value1</i> <b>\ <br>
+&rsquo;:baz&rsquo;</b> <i>style2 value2</i> <b>\ <br>
+&rsquo;:frob&rsquo;</b> <i>style3 value3</i></p>

<p style="margin-left:18%; margin-top: 1em">This defines
<i>style1</i> with <i>value1</i> for the context
<b>:foo:bar</b> as usual, but it also defines <i>style2</i>
with <i>value2</i> for the context <b>:foo:bar:baz</b> and
<i>style3</i> with <i>value3</i> for <b>:foo:bar:frob</b>.
Any <i>subcontext</i> may be the empty string to re-use the
first context unchanged.</p>

<h3>Styles
<a name="Styles"></a>
</h3>



<p style="margin-left:9%; margin-top: 1em"><b>insert-tab</b></p>

<p style="margin-left:18%;">The <b>zed</b> function
<i>sets</i> this style in context
&lsquo;<b>:completion:zed:*</b>&rsquo; to turn off
completion when <b>TAB</b> is typed at the beginning of a
line. You may override this by setting your own value for
this context and style.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>pager</b></p></td>
<td width="1%"></td>
<td width="82%">


<p>The <b>nslookup</b> function looks up this style in the
context &lsquo;<b>:nslookup</b>&rsquo; to determine the
program used to display output that does not fit on a single
screen.</p> </td></tr>
<tr valign="top" align="left">
<td width="9%"></td>
<td width="8%">


<p><b>prompt</b></p></td>
<td width="1%"></td>
<td width="82%">
</td></tr>
</table>


<p style="margin-left:9%; margin-top: 1em"><b>rprompt</b></p>

<p style="margin-left:18%;">The <b>nslookup</b> function
looks up this style in the context
&lsquo;<b>:nslookup</b>&rsquo; to set the prompt and the
right-side prompt, respectively. The usual expansions for
the <b>PS1</b> and <b>RPS1</b> parameters may be used (see
EXPANSION OF PROMPT SEQUENCES in <i>zshmisc</i>(1)).</p>
<hr>
</body>
</html>
