<!-- Creator     : groff version 1.23.0 -->
<!-- CreationDate: Mon Apr  7 17:26:10 2025 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>GIT-P4</title>

</head>
<body>

<h1 align="center">GIT-P4</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#COMMANDS">COMMANDS</a><br>
<a href="#Clone">Clone</a><br>
<a href="#Sync">Sync</a><br>
<a href="#Rebase">Rebase</a><br>
<a href="#Submit">Submit</a><br>
<a href="#Unshelve">Unshelve</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#General options">General options</a><br>
<a href="#Sync options">Sync options</a><br>
<a href="#Clone options">Clone options</a><br>
<a href="#Submit options">Submit options</a><br>
<a href="#HOOKS FOR SUBMIT">HOOKS FOR SUBMIT</a><br>
<a href="#p4-pre-submit">p4-pre-submit</a><br>
<a href="#p4-prepare-changelist">p4-prepare-changelist</a><br>
<a href="#p4-changelist">p4-changelist</a><br>
<a href="#p4-post-changelist">p4-post-changelist</a><br>
<a href="#Rebase options">Rebase options</a><br>
<a href="#Unshelve options">Unshelve options</a><br>
<a href="#DEPOT PATH SYNTAX">DEPOT PATH SYNTAX</a><br>
<a href="#CLIENT SPEC">CLIENT SPEC</a><br>
<a href="#BRANCH DETECTION">BRANCH DETECTION</a><br>
<a href="#PERFORMANCE">PERFORMANCE</a><br>
<a href="#CONFIGURATION VARIABLES">CONFIGURATION VARIABLES</a><br>
<a href="#General variables">General variables</a><br>
<a href="#Clone and sync variables">Clone and sync variables</a><br>
<a href="#Submit variables">Submit variables</a><br>
<a href="#IMPLEMENTATION DETAILS">IMPLEMENTATION DETAILS</a><br>
<a href="#GIT">GIT</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">git-p4 - Import
from and submit to Perforce repositories</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em"><i>git p4
clone</i> [&lt;sync-options&gt;] [&lt;clone-options&gt;]
&lt;p4-depot-path&gt;... <i><br>
git p4 sync</i> [&lt;sync-options&gt;]
[&lt;p4-depot-path&gt;...] <i><br>
git p4 rebase <br>
git p4 submit</i> [&lt;submit-options&gt;]
[&lt;master-branch-name&gt;]</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">This command
provides a way to interact with p4 repositories using
Git.</p>

<p style="margin-left:9%; margin-top: 1em">Create a new Git
repository from an existing p4 repository using <i>git p4
clone</i>, giving it one or more p4 depot paths. Incorporate
new commits from p4 changes with <i>git p4 sync</i>. The
<i>sync</i> command is also used to include new branches
from other p4 depot paths. Submit Git changes back to p4
using <i>git p4 submit</i>. The command <i>git p4 rebase</i>
does a sync plus rebases the current branch onto the updated
p4 remote branch.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:14%; margin-top: 1em">&bull; Clone a
repository:</p>

<p style="margin-left:19%; margin-top: 1em">$ git p4 clone
//depot/path/project</p>

<p style="margin-left:14%; margin-top: 1em">&bull; Do some
work in the newly created Git repository:</p>

<p style="margin-left:19%; margin-top: 1em">$ cd project
<br>
$ vi foo.h <br>
$ git commit -a -m &quot;edited foo.h&quot;</p>

<p style="margin-left:14%; margin-top: 1em">&bull; Update
the Git repository with recent changes from p4, rebasing
your work on top:</p>

<p style="margin-left:19%; margin-top: 1em">$ git p4
rebase</p>

<p style="margin-left:14%; margin-top: 1em">&bull; Submit
your commits back to p4:</p>

<p style="margin-left:19%; margin-top: 1em">$ git p4
submit</p>

<h2>COMMANDS
<a name="COMMANDS"></a>
</h2>


<h3>Clone
<a name="Clone"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Generally,
<i>git p4 clone</i> is used to create a new Git directory
from an existing p4 repository:</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4 clone
//depot/path/project</p>

<p style="margin-left:9%; margin-top: 1em">This:</p>

<p style="margin-left:14%; margin-top: 1em">1. Creates an
empty Git repository in a subdirectory called
<i>project</i>.</p>

<p style="margin-left:14%; margin-top: 1em">2. Imports the
full contents of the head revision from the given p4 depot
path into a single commit in the Git branch
<i>refs/remotes/p4/master</i>.</p>

<p style="margin-left:14%; margin-top: 1em">3. Creates a
local branch, <i>master</i> from this remote and checks it
out.</p>

<p style="margin-left:9%; margin-top: 1em">To reproduce the
entire p4 history in Git, use the <i>@all</i> modifier on
the depot path:</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4 clone
//depot/path/project@all</p>

<h3>Sync
<a name="Sync"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">As development
continues in the p4 repository, those changes can be
included in the Git repository using:</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4
sync</p>

<p style="margin-left:9%; margin-top: 1em">This command
finds new changes in p4 and imports them as Git commits.</p>

<p style="margin-left:9%; margin-top: 1em">P4 repositories
can be added to an existing Git repository using <i>git p4
sync</i> too:</p>

<p style="margin-left:14%; margin-top: 1em">$ mkdir
repo-git <br>
$ cd repo-git <br>
$ git init <br>
$ git p4 sync //path/in/your/perforce/depot</p>

<p style="margin-left:9%; margin-top: 1em">This imports the
specified depot into <i>refs/remotes/p4/master</i> in an
existing Git repository. The <b>--branch</b> option can be
used to specify a different branch to be used for the p4
content.</p>

<p style="margin-left:9%; margin-top: 1em">If a Git
repository includes branches <i>refs/remotes/origin/p4</i>,
these will be fetched and consulted first during a <i>git p4
sync</i>. Since importing directly from p4 is considerably
slower than pulling changes from a Git remote, this can be
useful in a multi-developer environment.</p>

<p style="margin-left:9%; margin-top: 1em">If there are
multiple branches, doing <i>git p4 sync</i> will
automatically use the &quot;BRANCH DETECTION&quot; algorithm
to try to partition new changes into the right branch. This
can be overridden with the <b>--branch</b> option to specify
just a single branch to update.</p>

<h3>Rebase
<a name="Rebase"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">A common working
pattern is to fetch the latest changes from the p4 depot and
merge them with local uncommitted changes. Often, the p4
repository is the ultimate location for all code, thus a
rebase workflow makes sense. This command does <i>git p4
sync</i> followed by <i>git rebase</i> to move local commits
on top of updated p4 changes.</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4
rebase</p>

<h3>Submit
<a name="Submit"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Submitting
changes from a Git repository back to the p4 repository
requires a separate p4 client workspace. This should be
specified using the <b>P4CLIENT</b> environment variable or
the Git configuration variable <i>git-p4.client</i>. The p4
client must exist, but the client root will be created and
populated if it does not already exist.</p>

<p style="margin-left:9%; margin-top: 1em">To submit all
changes that are in the current Git branch but not in the
<i>p4/master</i> branch, use:</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4
submit</p>

<p style="margin-left:9%; margin-top: 1em">To specify a
branch other than the current one, use:</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4 submit
topicbranch</p>

<p style="margin-left:9%; margin-top: 1em">To specify a
single commit or a range of commits, use:</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4 submit
--commit &lt;sha1&gt; <br>
$ git p4 submit --commit &lt;sha1..sha1&gt;</p>

<p style="margin-left:9%; margin-top: 1em">The upstream
reference is generally <i>refs/remotes/p4/master</i>, but
can be overridden using the <b>--origin=</b> command-line
option.</p>

<p style="margin-left:9%; margin-top: 1em">The p4 changes
will be created as the user invoking <i>git p4 submit</i>.
The <b>--preserve-user</b> option will cause ownership to be
modified according to the author of the Git commit. This
option requires admin privileges in p4, which can be granted
using <i>p4 protect</i>.</p>

<p style="margin-left:9%; margin-top: 1em">To shelve
changes instead of submitting, use <b>--shelve</b> and
<b>--update-shelve</b>:</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4 submit
--shelve <br>
$ git p4 submit --update-shelve 1234 --update-shelve
2345</p>

<h3>Unshelve
<a name="Unshelve"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">Unshelving will
take a shelved P4 changelist, and produce the equivalent git
commit in the branch
refs/remotes/p4-unshelved/&lt;changelist&gt;.</p>

<p style="margin-left:9%; margin-top: 1em">The git commit
is created relative to the current origin revision (HEAD by
default). A parent commit is created based on the origin,
and then the unshelve commit is created based on that.</p>

<p style="margin-left:9%; margin-top: 1em">The origin
revision can be changed with the &quot;--origin&quot;
option.</p>

<p style="margin-left:9%; margin-top: 1em">If the target
branch in refs/remotes/p4-unshelved already exists, the old
one will be renamed.</p>

<p style="margin-left:14%; margin-top: 1em">$ git p4 sync
<br>
$ git p4 unshelve 12345 <br>
$ git show p4-unshelved/12345 <br>
&lt;submit more changes via p4 to the same files&gt; <br>
$ git p4 unshelve 12345 <br>
&lt;refuses to unshelve until git is in sync with p4
again&gt;</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>


<h3>General options
<a name="General options"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">All commands
except clone accept these options.</p>

<p style="margin-left:9%; margin-top: 1em">--git-dir
&lt;dir&gt;</p>

<p style="margin-left:14%;">Set the <b>GIT_DIR</b>
environment variable. See <b>git</b>(1).</p>

<p style="margin-left:9%; margin-top: 1em">-v,
--verbose</p>

<p style="margin-left:14%;">Provide more progress
information.</p>

<h3>Sync options
<a name="Sync options"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">These options
can be used in the initial <i>clone</i> as well as in
subsequent <i>sync</i> operations.</p>

<p style="margin-left:9%; margin-top: 1em">--branch
&lt;ref&gt;</p>

<p style="margin-left:14%;">Import changes into &lt;ref&gt;
instead of refs/remotes/p4/master. If &lt;ref&gt; starts
with refs/, it is used as is. Otherwise, if it does not
start with p4/, that prefix is added.</p>

<p style="margin-left:14%; margin-top: 1em">By default a
&lt;ref&gt; not starting with refs/ is treated as the name
of a remote-tracking branch (under refs/remotes/). This
behavior can be modified using the --import-local
option.</p>

<p style="margin-left:14%; margin-top: 1em">The default
&lt;ref&gt; is &quot;master&quot;.</p>

<p style="margin-left:14%; margin-top: 1em">This example
imports a new remote &quot;p4/proj2&quot; into an existing
Git repository:</p>

<p style="margin-left:19%; margin-top: 1em">$ git init <br>
$ git p4 sync --branch=refs/remotes/p4/proj2
//depot/proj2</p>


<p style="margin-left:9%; margin-top: 1em">--detect-branches</p>

<p style="margin-left:14%;">Use the branch detection
algorithm to find new paths in p4. It is documented below in
&quot;BRANCH DETECTION&quot;.</p>

<p style="margin-left:9%; margin-top: 1em">--changesfile
&lt;file&gt;</p>

<p style="margin-left:14%;">Import exactly the p4 change
numbers listed in <i>file</i>, one per line. Normally,
<i>git p4</i> inspects the current p4 repository state and
detects the changes it should import.</p>

<p style="margin-left:9%; margin-top: 1em">--silent</p>

<p style="margin-left:14%;">Do not print any progress
information.</p>


<p style="margin-left:9%; margin-top: 1em">--detect-labels</p>

<p style="margin-left:14%;">Query p4 for labels associated
with the depot paths, and add them as tags in Git. Limited
usefulness as only imports labels associated with new
changelists. Deprecated.</p>


<p style="margin-left:9%; margin-top: 1em">--import-labels</p>

<p style="margin-left:14%;">Import labels from p4 into
Git.</p>


<p style="margin-left:9%; margin-top: 1em">--import-local</p>

<p style="margin-left:14%;">By default, p4 branches are
stored in <i>refs/remotes/p4/</i>, where they will be
treated as remote-tracking branches by <b>git-branch</b>(1)
and other commands. This option instead puts p4 branches in
<i>refs/heads/p4/</i>. Note that future sync operations must
specify <b>--import-local</b> as well so that they can find
the p4 branches in refs/heads.</p>

<p style="margin-left:9%; margin-top: 1em">--max-changes
&lt;n&gt;</p>

<p style="margin-left:14%;">Import at most <i>n</i>
changes, rather than the entire range of changes included in
the given revision specifier. A typical usage would be use
<i>@all</i> as the revision specifier, but then to use
<i>--max-changes 1000</i> to import only the last 1000
revisions rather than the entire revision history.</p>


<p style="margin-left:9%; margin-top: 1em">--changes-block-size
&lt;n&gt;</p>

<p style="margin-left:14%;">The internal block size to use
when converting a revision specifier such as <i>@all</i>
into a list of specific change numbers. Instead of using a
single call to <i>p4 changes</i> to find the full list of
changes for the conversion, there are a sequence of calls to
<i>p4 changes -m</i>, each of which requests one block of
changes of the given size. The default block size is 500,
which should usually be suitable.</p>

<p style="margin-left:9%; margin-top: 1em">--keep-path</p>

<p style="margin-left:14%;">The mapping of file names from
the p4 depot path to Git, by default, involves removing the
entire depot path. With this option, the full p4 depot path
is retained in Git. For example, path
<i>//depot/main/foo/bar.c</i>, when imported from
<i>//depot/main/</i>, becomes <i>foo/bar.c</i>. With
<b>--keep-path</b>, the Git path is instead
<i>depot/main/foo/bar.c</i>.</p>


<p style="margin-left:9%; margin-top: 1em">--use-client-spec</p>

<p style="margin-left:14%;">Use a client spec to find the
list of interesting files in p4. See the &quot;CLIENT
SPEC&quot; section below.</p>

<p style="margin-left:9%; margin-top: 1em">-/
&lt;path&gt;</p>

<p style="margin-left:14%;">Exclude selected depot paths
when cloning or syncing.</p>

<h3>Clone options
<a name="Clone options"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">These options
can be used in an initial <i>clone</i>, along with the
<i>sync</i> options described above.</p>

<p style="margin-left:9%; margin-top: 1em">--destination
&lt;directory&gt;</p>

<p style="margin-left:14%;">Where to create the Git
repository. If not provided, the last component in the p4
depot path is used to create a new directory.</p>

<p style="margin-left:9%; margin-top: 1em">--bare</p>

<p style="margin-left:14%;">Perform a bare clone. See
<b>git-clone</b>(1).</p>

<h3>Submit options
<a name="Submit options"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">These options
can be used to modify <i>git p4 submit</i> behavior.</p>

<p style="margin-left:9%; margin-top: 1em">--origin
&lt;commit&gt;</p>

<p style="margin-left:14%;">Upstream location from which
commits are identified to submit to p4. By default, this is
the most recent p4 commit reachable from <b>HEAD</b>.</p>

<p style="margin-left:9%; margin-top: 1em">-M</p>

<p style="margin-left:14%;">Detect renames. See
<b>git-diff</b>(1). Renames will be represented in p4 using
explicit <i>move</i> operations. There is no corresponding
option to detect copies, but there are variables for both
moves and copies.</p>


<p style="margin-left:9%; margin-top: 1em">--preserve-user</p>

<p style="margin-left:14%;">Re-author p4 changes before
submitting to p4. This option requires p4 admin
privileges.</p>


<p style="margin-left:9%; margin-top: 1em">--export-labels</p>

<p style="margin-left:14%;">Export tags from Git as p4
labels. Tags found in Git are applied to the perforce
working directory.</p>

<p style="margin-left:9%; margin-top: 1em">-n,
--dry-run</p>

<p style="margin-left:14%;">Show just what commits would be
submitted to p4; do not change state in Git or p4.</p>


<p style="margin-left:9%; margin-top: 1em">--prepare-p4-only</p>

<p style="margin-left:14%;">Apply a commit to the p4
workspace, opening, adding and deleting files in p4 as for a
normal submit operation. Do not issue the final &quot;p4
submit&quot;, but instead print a message about how to
submit manually or revert. This option always stops after
the first (oldest) commit. Git tags are not exported to
p4.</p>

<p style="margin-left:9%; margin-top: 1em">--shelve</p>

<p style="margin-left:14%;">Instead of submitting create a
series of shelved changelists. After creating each shelve,
the relevant files are reverted/deleted. If you have
multiple commits pending multiple shelves will be
created.</p>

<p style="margin-left:9%; margin-top: 1em">--update-shelve
CHANGELIST</p>

<p style="margin-left:14%;">Update an existing shelved
changelist with this commit. Implies --shelve. Repeat for
multiple shelved changelists.</p>


<p style="margin-left:9%; margin-top: 1em">--conflict=(ask|skip|quit)</p>

<p style="margin-left:14%;">Conflicts can occur when
applying a commit to p4. When this happens, the default
behavior (&quot;ask&quot;) is to prompt whether to skip this
commit and continue, or quit. This option can be used to
bypass the prompt, causing conflicting commits to be
automatically skipped, or to quit trying to apply commits,
without prompting.</p>

<p style="margin-left:9%; margin-top: 1em">--branch
&lt;branch&gt;</p>

<p style="margin-left:14%;">After submitting, sync this
named branch instead of the default p4/master. See the
&quot;Sync options&quot; section above for more
information.</p>

<p style="margin-left:9%; margin-top: 1em">--commit
(&lt;sha1&gt;|&lt;sha1&gt;..&lt;sha1&gt;)</p>

<p style="margin-left:14%;">Submit only the specified
commit or range of commits, instead of the full list of
changes that are in the current Git branch.</p>


<p style="margin-left:9%; margin-top: 1em">--disable-rebase</p>

<p style="margin-left:14%;">Disable the automatic rebase
after all commits have been successfully submitted. Can also
be set with git-p4.disableRebase.</p>


<p style="margin-left:9%; margin-top: 1em">--disable-p4sync</p>

<p style="margin-left:14%;">Disable the automatic sync of
p4/master from Perforce after commits have been submitted.
Implies --disable-rebase. Can also be set with
git-p4.disableP4Sync. Sync with origin/master still goes
ahead if possible.</p>

<h2>HOOKS FOR SUBMIT
<a name="HOOKS FOR SUBMIT"></a>
</h2>


<h3>p4-pre-submit
<a name="p4-pre-submit"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The
<b>p4-pre-submit</b> hook is executed if it exists and is
executable. The hook takes no parameters and nothing from
standard input. Exiting with non-zero status from this
script prevents <b>git-p4 submit</b> from launching. It can
be bypassed with the <b>--no-verify</b> command line
option.</p>

<p style="margin-left:9%; margin-top: 1em">One usage
scenario is to run unit tests in the hook.</p>

<h3>p4-prepare-changelist
<a name="p4-prepare-changelist"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The
<b>p4-prepare-changelist</b> hook is executed right after
preparing the default changelist message and before the
editor is started. It takes one parameter, the name of the
file that contains the changelist text. Exiting with a
non-zero status from the script will abort the process.</p>

<p style="margin-left:9%; margin-top: 1em">The purpose of
the hook is to edit the message file in place, and it is not
suppressed by the <b>--no-verify</b> option. This hook is
called even if <b>--prepare-p4-only</b> is set.</p>

<h3>p4-changelist
<a name="p4-changelist"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The
<b>p4-changelist</b> hook is executed after the changelist
message has been edited by the user. It can be bypassed with
the <b>--no-verify</b> option. It takes a single parameter,
the name of the file that holds the proposed changelist
text. Exiting with a non-zero status causes the command to
abort.</p>

<p style="margin-left:9%; margin-top: 1em">The hook is
allowed to edit the changelist file and can be used to
normalize the text into some project standard format. It can
also be used to refuse the Submit after inspect the message
file.</p>

<h3>p4-post-changelist
<a name="p4-post-changelist"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">The
<b>p4-post-changelist</b> hook is invoked after the submit
has successfully occurred in P4. It takes no parameters and
is meant primarily for notification and cannot affect the
outcome of the git p4 submit action.</p>

<h3>Rebase options
<a name="Rebase options"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">These options
can be used to modify <i>git p4 rebase</i> behavior.</p>


<p style="margin-left:9%; margin-top: 1em">--import-labels</p>

<p style="margin-left:14%;">Import p4 labels.</p>

<h3>Unshelve options
<a name="Unshelve options"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">--origin</p>

<p style="margin-left:14%;">Sets the git refspec against
which the shelved P4 changelist is compared. Defaults to
p4/master.</p>

<h2>DEPOT PATH SYNTAX
<a name="DEPOT PATH SYNTAX"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The p4 depot
path argument to <i>git p4 sync</i> and <i>git p4 clone</i>
can be one or more space-separated p4 depot paths, with an
optional p4 revision specifier on the end:</p>


<p style="margin-left:9%; margin-top: 1em">&quot;//depot/my/project&quot;</p>

<p style="margin-left:14%;">Import one commit with all
files in the <i>#head</i> change under that tree.</p>


<p style="margin-left:9%; margin-top: 1em">&quot;//depot/my/project@all&quot;</p>

<p style="margin-left:14%;">Import one commit for each
change in the history of that depot path.</p>


<p style="margin-left:9%; margin-top: 1em">&quot;//depot/my/project@1,6&quot;</p>

<p style="margin-left:14%;">Import only changes 1 through
6.</p>


<p style="margin-left:9%; margin-top: 1em">&quot;//depot/proj1@all
//depot/proj2@all&quot;</p>

<p style="margin-left:14%;">Import all changes from both
named depot paths into a single repository. Only files below
these directories are included. There is not a subdirectory
in Git for each &quot;proj1&quot; and &quot;proj2&quot;. You
must use the <b>--destination</b> option when specifying
more than one depot path. The revision specifier must be
specified identically on each depot path. If there are files
in the depot paths with the same name, the path with the
most recently updated version of the file is the one that
appears in Git.</p>

<p style="margin-left:9%; margin-top: 1em">See <i>p4 help
revisions</i> for the full syntax of p4 revision
specifiers.</p>

<h2>CLIENT SPEC
<a name="CLIENT SPEC"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The p4 client
specification is maintained with the <i>p4 client</i>
command and contains among other fields, a View that
specifies how the depot is mapped into the client
repository. The <i>clone</i> and <i>sync</i> commands can
consult the client spec when given the
<b>--use-client-spec</b> option or when the useClientSpec
variable is true. After <i>git p4 clone</i>, the
useClientSpec variable is automatically set in the
repository configuration file. This allows future <i>git p4
submit</i> commands to work properly; the submit command
looks only at the variable and does not have a command-line
option.</p>

<p style="margin-left:9%; margin-top: 1em">The full syntax
for a p4 view is documented in <i>p4 help views</i>. <i>git
p4</i> knows only a subset of the view syntax. It
understands multi-line mappings, overlays with <i>+</i>,
exclusions with <i>-</i> and double-quotes around
whitespace. Of the possible wildcards, <i>git p4</i> only
handles <i>...</i>, and only when it is at the end of the
path. <i>git p4</i> will complain if it encounters an
unhandled wildcard.</p>

<p style="margin-left:9%; margin-top: 1em">Bugs in the
implementation of overlap mappings exist. If multiple depot
paths map through overlays to the same location in the
repository, <i>git p4</i> can choose the wrong one. This is
hard to solve without dedicating a client spec just for
<i>git p4</i>.</p>

<p style="margin-left:9%; margin-top: 1em">The name of the
client can be given to <i>git p4</i> in multiple ways. The
variable <i>git-p4.client</i> takes precedence if it exists.
Otherwise, normal p4 mechanisms of determining the client
are used: environment variable <b>P4CLIENT</b>, a file
referenced by <b>P4CONFIG</b>, or the local host name.</p>

<h2>BRANCH DETECTION
<a name="BRANCH DETECTION"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">P4 does not have
the same concept of a branch as Git. Instead, p4 organizes
its content as a directory tree, where by convention
different logical branches are in different locations in the
tree. The <i>p4 branch</i> command is used to maintain
mappings between different areas in the tree, and indicate
related content. <i>git p4</i> can use these mappings to
determine branch relationships.</p>

<p style="margin-left:9%; margin-top: 1em">If you have a
repository where all the branches of interest exist as
subdirectories of a single depot path, you can use
<b>--detect-branches</b> when cloning or syncing to have
<i>git p4</i> automatically find subdirectories in p4, and
to generate these as branches in Git.</p>

<p style="margin-left:9%; margin-top: 1em">For example, if
the P4 repository structure is:</p>


<p style="margin-left:14%; margin-top: 1em">//depot/main/...
<br>
//depot/branch1/...</p>

<p style="margin-left:9%; margin-top: 1em">And &quot;p4
branch -o branch1&quot; shows a View line that looks
like:</p>


<p style="margin-left:14%; margin-top: 1em">//depot/main/...
//depot/branch1/...</p>

<p style="margin-left:9%; margin-top: 1em">Then this <i>git
p4 clone</i> command:</p>

<p style="margin-left:14%; margin-top: 1em">git p4 clone
--detect-branches //depot@all</p>

<p style="margin-left:9%; margin-top: 1em">produces a
separate branch in <i>refs/remotes/p4/</i> for //depot/main,
called <i>master</i>, and one for //depot/branch1 called
<i>depot/branch1</i>.</p>

<p style="margin-left:9%; margin-top: 1em">However, it is
not necessary to create branches in p4 to be able to use
them like branches. Because it is difficult to infer branch
relationships automatically, a Git configuration setting
<i>git-p4.branchList</i> can be used to explicitly identify
branch relationships. It is a list of
&quot;source:destination&quot; pairs, like a simple p4
branch specification, where the &quot;source&quot; and
&quot;destination&quot; are the path elements in the p4
repository. The example above relied on the presence of the
p4 branch. Without p4 branches, the same result will occur
with:</p>

<p style="margin-left:14%; margin-top: 1em">git init depot
<br>
cd depot <br>
git config git-p4.branchList main:branch1 <br>
git p4 clone --detect-branches //depot@all .</p>

<h2>PERFORMANCE
<a name="PERFORMANCE"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The fast-import
mechanism used by <i>git p4</i> creates one pack file for
each invocation of <i>git p4 sync</i>. Normally, Git garbage
compression (<b>git-gc</b>(1)) automatically compresses
these to fewer pack files, but explicit invocation of <i>git
repack -adf</i> may improve performance.</p>

<h2>CONFIGURATION VARIABLES
<a name="CONFIGURATION VARIABLES"></a>
</h2>


<p style="margin-left:9%; margin-top: 1em">The following
config settings can be used to modify <i>git p4</i>
behavior. They all are in the <i>git-p4</i> section.</p>

<h3>General variables
<a name="General variables"></a>
</h3>


<p style="margin-left:9%; margin-top: 1em">git-p4.user</p>

<p style="margin-left:14%;">User specified as an option to
all p4 commands, with <i>-u &lt;user&gt;</i>. The
environment variable <b>P4USER</b> can be used instead.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.password</p>

<p style="margin-left:14%;">Password specified as an option
to all p4 commands, with <i>-P &lt;password&gt;</i>. The
environment variable <b>P4PASS</b> can be used instead.</p>

<p style="margin-left:9%; margin-top: 1em">git-p4.port</p>

<p style="margin-left:14%;">Port specified as an option to
all p4 commands, with <i>-p &lt;port&gt;</i>. The
environment variable <b>P4PORT</b> can be used instead.</p>

<p style="margin-left:9%; margin-top: 1em">git-p4.host</p>

<p style="margin-left:14%;">Host specified as an option to
all p4 commands, with <i>-h &lt;host&gt;</i>. The
environment variable <b>P4HOST</b> can be used instead.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.client</p>

<p style="margin-left:14%;">Client specified as an option
to all p4 commands, with <i>-c &lt;client&gt;</i>, including
the client spec.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.retries</p>

<p style="margin-left:14%;">Specifies the number of times
to retry a p4 command (notably, <i>p4 sync</i>) if the
network times out. The default value is 3. Set the value to
0 to disable retries or if your p4 version does not support
retries (pre 2012.2).</p>

<h3>Clone and sync variables
<a name="Clone and sync variables"></a>
</h3>



<p style="margin-left:9%; margin-top: 1em">git-p4.syncFromOrigin</p>

<p style="margin-left:14%;">Because importing commits from
other Git repositories is much faster than importing them
from p4, a mechanism exists to find p4 changes first in Git
remotes. If branches exist under
<i>refs/remote/origin/p4</i>, those will be fetched and used
when syncing from p4. This variable can be set to
<i>false</i> to disable this behavior.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.branchUser</p>

<p style="margin-left:14%;">One phase in branch detection
involves looking at p4 branches to find new ones to import.
By default, all branches are inspected. This option limits
the search to just those owned by the single user named in
the variable.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.branchList</p>

<p style="margin-left:14%;">List of branches to be imported
when branch detection is enabled. Each entry should be a
pair of branch names separated by a colon (:). This example
declares that both branchA and branchB were created from
main:</p>

<p style="margin-left:19%; margin-top: 1em">git config
git-p4.branchList main:branchA <br>
git config --add git-p4.branchList main:branchB</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.ignoredP4Labels</p>

<p style="margin-left:14%;">List of p4 labels to ignore.
This is built automatically as unimportable labels are
discovered.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.importLabels</p>

<p style="margin-left:14%;">Import p4 labels into git, as
per --import-labels.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.labelImportRegexp</p>

<p style="margin-left:14%;">Only p4 labels matching this
regular expression will be imported. The default value is
<i>[a-zA-Z0-9_\-.]+$</i>.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.useClientSpec</p>

<p style="margin-left:14%;">Specify that the p4 client spec
should be used to identify p4 depot paths of interest. This
is equivalent to specifying the option
<b>--use-client-spec</b>. See the &quot;CLIENT SPEC&quot;
section above. This variable is a boolean, not the name of a
p4 client.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.pathEncoding</p>

<p style="margin-left:14%;">Perforce keeps the encoding of
a path as given by the originating OS. Git expects paths
encoded as UTF-8. Use this config to tell git-p4 what
encoding Perforce had used for the paths. This encoding is
used to transcode the paths to UTF-8. As an example,
Perforce on Windows often uses &quot;cp1252&quot; to encode
path names. If this option is passed into a p4 clone
request, it is persisted in the resulting new git repo.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.metadataDecodingStrategy</p>

<p style="margin-left:14%;">Perforce keeps the encoding of
a changelist descriptions and user full names as stored by
the client on a given OS. The p4v client uses the OS-local
encoding, and so different users can end up storing
different changelist descriptions or user full names in
different encodings, in the same depot. Git tolerates
inconsistent/incorrect encodings in commit messages and
author names, but expects them to be specified in utf-8.
git-p4 can use three different decoding strategies in
handling the encoding uncertainty in Perforce:
<i>passthrough</i> simply passes the original bytes through
from Perforce to git, creating usable but
incorrectly-encoded data when the Perforce data is encoded
as anything other than utf-8. <i>strict</i> expects the
Perforce data to be encoded as utf-8, and fails to import
when this is not true. <i>fallback</i> attempts to interpret
the data as utf-8, and otherwise falls back to using a
secondary encoding - by default the common windows encoding
<i>cp-1252</i> - with upper-range bytes escaped if decoding
with the fallback encoding also fails. Under python2 the
default strategy is <i>passthrough</i> for historical
reasons, and under python3 the default is <i>fallback</i>.
When <i>strict</i> is selected and decoding fails, the error
message will propose changing this config parameter as a
workaround. If this option is passed into a p4 clone
request, it is persisted into the resulting new git
repo.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.metadataFallbackEncoding</p>

<p style="margin-left:14%;">Specify the fallback encoding
to use when decoding Perforce author names and changelists
descriptions using the <i>fallback</i> strategy (see
git-p4.metadataDecodingStrategy). The fallback encoding will
only be used when decoding as utf-8 fails. This option
defaults to cp1252, a common windows encoding. If this
option is passed into a p4 clone request, it is persisted
into the resulting new git repo.</p>


<p style="margin-left:9%; margin-top: 1em">git-p4.largeFileSystem</p>

<p style="margin-left:14%;">Specify the system that is used
for large (binary) files. Please note that large file
systems do not support the <i>git p4 submit</i> command.
Only Git LFS is implemented right now (see
<b><font color="#0000FF">https://git-lfs.github.com/</font></b>
<font color="#000000">for more information). Download and
install the Git LFS command line extension to use this
option and configure it like this:</font></p>


<p style="margin-left:19%; margin-top: 1em"><font color="#000000">git
config git-p4.largeFileSystem GitLFS</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.largeFileExtensions</font></p>

<p style="margin-left:14%;"><font color="#000000">All files
matching a file extension in the list will be processed by
the large file system. Do not prefix the extensions with
<i>.</i>.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.largeFileThreshold</font></p>

<p style="margin-left:14%;"><font color="#000000">All files
with an uncompressed size exceeding the threshold will be
processed by the large file system. By default the threshold
is defined in bytes. Add the suffix k, m, or g to change the
unit.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.largeFileCompressedThreshold</font></p>

<p style="margin-left:14%;"><font color="#000000">All files
with a compressed size exceeding the threshold will be
processed by the large file system. This option might slow
down your clone/sync process. By default the threshold is
defined in bytes. Add the suffix k, m, or g to change the
unit.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.largeFilePush</font></p>

<p style="margin-left:14%;"><font color="#000000">Boolean
variable which defines if large files are automatically
pushed to a server.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.keepEmptyCommits</font></p>

<p style="margin-left:14%;"><font color="#000000">A
changelist that contains only excluded files will be
imported as an empty commit if this boolean option is set to
true.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.mapUser</font></p>

<p style="margin-left:14%;"><font color="#000000">Map a P4
user to a name and email address in Git. Use a string with
the following format to create a mapping:</font></p>


<p style="margin-left:19%; margin-top: 1em"><font color="#000000">git
config --add git-p4.mapUser &quot;p4user = First Last
&lt;mail@address.com&gt;&quot;</font></p>


<p style="margin-left:14%; margin-top: 1em"><font color="#000000">A
mapping will override any user information from P4. Mappings
for multiple P4 user can be defined.</font></p>

<h3>Submit variables
<a name="Submit variables"></a>
</h3>



<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.detectRenames</font></p>

<p style="margin-left:14%;"><font color="#000000">Detect
renames. See <b>git-diff</b>(1). This can be true, false, or
a score as expected by <i>git diff -M</i>.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.detectCopies</font></p>

<p style="margin-left:14%;"><font color="#000000">Detect
copies. See <b>git-diff</b>(1). This can be true, false, or
a score as expected by <i>git diff -C</i>.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.detectCopiesHarder</font></p>

<p style="margin-left:14%;"><font color="#000000">Detect
copies harder. See <b>git-diff</b>(1). A boolean.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.preserveUser</font></p>

<p style="margin-left:14%;"><font color="#000000">On
submit, re-author changes to reflect the Git author,
regardless of who invokes <i>git p4 submit</i>.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.allowMissingP4Users</font></p>

<p style="margin-left:14%;"><font color="#000000">When
<i>preserveUser</i> is true, <i>git p4</i> normally dies if
it cannot find an author in the p4 user map. This setting
submits the change regardless.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.skipSubmitEdit</font></p>

<p style="margin-left:14%;"><font color="#000000">The
submit process invokes the editor before each p4 change is
submitted. If this setting is true, though, the editing step
is skipped.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.skipSubmitEditCheck</font></p>

<p style="margin-left:14%;"><font color="#000000">After
editing the p4 change message, <i>git p4</i> makes sure that
the description really was changed by looking at the file
modification time. This option disables that
test.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.allowSubmit</font></p>

<p style="margin-left:14%;"><font color="#000000">By
default, any branch can be used as the source for a <i>git
p4 submit</i> operation. This configuration variable, if
set, permits only the named branches to be used as submit
sources. Branch names must be the short names (no
&quot;refs/heads/&quot;), and should be separated by commas
(&quot;,&quot;), with no spaces.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.skipUserNameCheck</font></p>

<p style="margin-left:14%;"><font color="#000000">If the
user running <i>git p4 submit</i> does not exist in the p4
user map, <i>git p4</i> exits. This option can be used to
force submission regardless.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.attemptRCSCleanup</font></p>

<p style="margin-left:14%;"><font color="#000000">If
enabled, <i>git p4 submit</i> will attempt to cleanup RCS
keywords ($Header$, etc). These would otherwise cause merge
conflicts and prevent the submit going ahead. This option
should be considered experimental at present.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.exportLabels</font></p>

<p style="margin-left:14%;"><font color="#000000">Export
Git tags to p4 labels, as per --export-labels.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.labelExportRegexp</font></p>

<p style="margin-left:14%;"><font color="#000000">Only p4
labels matching this regular expression will be exported.
The default value is <i>[a-zA-Z0-9_\-.]+$</i>.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.conflict</font></p>

<p style="margin-left:14%;"><font color="#000000">Specify
submit behavior when a conflict with p4 is found, as per
--conflict. The default behavior is <i>ask</i>.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.disableRebase</font></p>

<p style="margin-left:14%;"><font color="#000000">Do not
rebase the tree against p4/master following a
submit.</font></p>


<p style="margin-left:9%; margin-top: 1em"><font color="#000000">git-p4.disableP4Sync</font></p>

<p style="margin-left:14%;"><font color="#000000">Do not
sync p4/master with Perforce following a submit. Implies
git-p4.disableRebase.</font></p>

<h2>IMPLEMENTATION DETAILS
<a name="IMPLEMENTATION DETAILS"></a>
</h2>



<p style="margin-left:14%; margin-top: 1em"><font color="#000000">&bull;
Changesets from p4 are imported using Git
fast-import.</font></p>


<p style="margin-left:14%; margin-top: 1em"><font color="#000000">&bull;
Cloning or syncing does not require a p4 client; file
contents are collected using <i>p4 print</i>.</font></p>


<p style="margin-left:14%; margin-top: 1em"><font color="#000000">&bull;
Submitting requires a p4 client, which is not in the same
location as the Git repository. Patches are applied, one at
a time, to this p4 client and submitted from
there.</font></p>


<p style="margin-left:14%; margin-top: 1em"><font color="#000000">&bull;
Each commit imported by <i>git p4</i> has a line at the end
of the log message indicating the p4 depot location and
change number. This line is used by later <i>git p4 sync</i>
operations to know which p4 changes are new.</font></p>

<h2>GIT
<a name="GIT"></a>
</h2>



<p style="margin-left:9%; margin-top: 1em"><font color="#000000">Part
of the <b>git</b>(1) suite</font></p>
<hr>
</body>
</html>
